{"version":3,"sources":["webpack://@cloudcare/rum-miniapp/webpack/bootstrap","webpack://@cloudcare/rum-miniapp/webpack/runtime/define property getters","webpack://@cloudcare/rum-miniapp/webpack/runtime/hasOwnProperty shorthand","webpack://@cloudcare/rum-miniapp/webpack/runtime/make namespace object","webpack://@cloudcare/rum-miniapp/./src/helper/enums.js","webpack://@cloudcare/rum-miniapp/./src/helper/utils.js","webpack://@cloudcare/rum-miniapp/./src/boot/buildEnv.js","webpack://@cloudcare/rum-miniapp/./src/core/lifeCycle.js","webpack://@cloudcare/rum-miniapp/./src/core/configuration.js","webpack://@cloudcare/rum-miniapp/./src/core/errorTools.js","webpack://@cloudcare/rum-miniapp/./src/core/sdk.js","webpack://@cloudcare/rum-miniapp/./src/helper/tracekit.js","webpack://@cloudcare/rum-miniapp/./src/core/xhrProxy.js","webpack://@cloudcare/rum-miniapp/./src/core/observable.js","webpack://@cloudcare/rum-miniapp/./src/core/downloadProxy.js","webpack://@cloudcare/rum-miniapp/./src/core/errorCollection.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/error/errorCollection.js","webpack://@cloudcare/rum-miniapp/./src/core/baseInfo.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/assembly.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/parentContexts.js","webpack://@cloudcare/rum-miniapp/./src/core/dataMap.js","webpack://@cloudcare/rum-miniapp/./src/core/transport.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/transport/batch.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/trackEventCounts.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/page/viewCollection.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/page/index.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/resource/resourceUtils.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/requestCollection.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/resource/resourceCollection.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/app/index.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/app/appCollection.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/trackPageActiveites.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/action/trackActions.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/action/actionCollection.js","webpack://@cloudcare/rum-miniapp/./src/boot/rum.js","webpack://@cloudcare/rum-miniapp/./src/boot/rum.entry.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/performanceCollection.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/setDataCollection.js"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","ONE_MINUTE","CLIENT_ID_TOKEN","RumEventType","RequestType","ActionType","tap","longpress","longtap","MpHook","data","onLoad","onShow","onReady","onPullDownRefresh","onReachBottom","onShareAppMessage","onPageScroll","onResize","onTabItemTap","onHide","onUnload","ArrayProto","Array","ObjProto","slice","toString","nativeForEach","forEach","each","iterator","context","length","i","l","values","results","msToNs","duration","toFixed","isString","isNumber","test","String","toArray","iterable","isArray","areInOrder","numbers","arguments","UUID","placeholder","parseInt","Math","random","replace","jsonStringify","replacer","space","JSON","stringify","originalToJSON","undefined","hasToJSON","toJSON","result","originalProtoToJSON","getPrototypeOf","e","getMethods","funcs","push","replaceNumberCharByPath","path","getStatusGroup","status","substr","getQueryParamsFromUrl","url","queryString","split","getURLSearchParams","extend","source","extend2Lev","now","Date","getTime","throttle","func","wait","options","timeout","args","previous","later","leading","apply","throttled","remaining","this","clearTimeout","trailing","setTimeout","cancel","noop","findByPath","pathArr","shift","withSnakeCaseKeys","candidate","keys","word","uppercaseLetter","index","toLowerCase","deepSnakeCase","map","escapeRowData","str","urlParse","para","URLParser","a","_fields","Username","Password","Port","Protocol","Host","Path","URL","QueryString","Fragment","_values","_regex","_parse","setUrl","_initValues","addQueryString","queryObj","query","RegExp","getParse","getUrl","Origin","b","exec","c","getOwnObjectKeys","isEnumerable","getOwnPropertySymbols","symbols","filter","t","getOwnPropertyDescriptor","defineObject","configurable","writable","buildEnv","sdkVersion","sdkName","LifeCycle","callbacks","eventType","eventCallbacks","callback","unsubscribe","other","LifeCycleEventType","PERFORMANCE_ENTRY_COLLECTED","AUTO_ACTION_CREATED","AUTO_ACTION_COMPLETED","AUTO_ACTION_DISCARDED","APP_HIDE","APP_UPDATE","PAGE_SET_DATA_UPDATE","PAGE_ALIAS_ACTION","VIEW_CREATED","VIEW_UPDATED","VIEW_ENDED","REQUEST_STARTED","REQUEST_COMPLETED","RAW_RUM_EVENT_COLLECTED","RUM_EVENT_COLLECTED","DEFAULT_CONFIGURATION","sampleRate","flushTimeout","maxErrorsByMinute","maxBatchSize","maxMessageSize","batchBytesLimit","datakitUrl","requestErrorResponseLengthLimit","trackInteractions","isIntakeRequest","configuration","url1","url2","parseUrl1","parseUrl2","haveSameOrigin","ErrorSource","toStackTraceString","stack","name","message","frame","join","line","column","instance","sdk","tracker","wx","request","targetObj","target","getOwnPropertyDescriptors","defineProperties","deepMixObject","err","getSDK","UNKNOWN_FUNCTION","has","object","xhrProxySingleton","onErrorHandlerInstalled","onUnhandledRejectionHandlerInstalled","onPageNotFoundHandlerInstalled","onOnMemoryWarningHandlerInstalled","handlers","notifyHandlers","isWindowError","error","exception","inner","traceKitWindowOnError","Error","msg","computeStackTrace","messages","groups","match","ERROR_TYPES_RE","traceKitWindowOnUnhandledRejection","reason","promise","doReport","ex","subscribe","handler","onError","installGlobalHandler","onUnhandledRejection","installGlobalUnhandledRejectionHandler","onPageNotFound","res","type","installGlobalOnPageNotFoundHandler","onMemoryWarning","level","levelMessage","installGlobalOnMemoryWarningHandler","splice","debug","computeStackTraceFromStackProp","isEval","submatch","parts","element","chrome","gecko","winjs","geckoEval","chromeEval","lines","j","isNative","indexOf","columnNumber","extractMessage","augmentStackTraceWithInitialElement","stackInfo","lineNo","initial","incompvare","unshift","partial","computeStackTraceByWalkingCallerChain","depth","item","functionName","recursion","curr","caller","input","substring","sourceURL","fileName","lineNumber","description","doComputeStackTrace","normalizedDepth","stacktrace","opera10Regex","opera11Regex","computeStackTraceFromStacktraceProp","lineRE1","lineRE2","lineRE3","scripts","window","document","getElementsByTagName","inlineScriptBlocks","s","src","location","href","computeStackTraceFromOperaMultiLineMessage","ofCaller","currentDepth","Observable","observers","f","observer","originalXhrRequest","downloadProxySingleton","beforeSendCallbacks","onRequestCompleteCallbacks","startXhrProxy","_this","dataflux_xhr","method","startTime","responseType","originalSuccess","success","reportXhr","originalFail","fail","hasBeenReported","response","header","profile","statusCode","beforeSend","onRequestComplete","originalDownloadRequest","originalConsoleError","traceKitReportHandler","filteredErrorsObservable","startDownloadProxy","downloadFile","filePath","tempFilePath","formatConsoleParameters","param","startRuntimeErrorTracking","errorObservable","stackTrace","_","errorObject","nonErrorPrefix","formatUnknownError","notify","startAutomaticErrorCollection","handleCompleteRequest","isRejected","isServerError","format","resource","truncateResponse","trackNetworkError","console","concat","startConsoleTracking","errorCount","filteredErrorObservable","setInterval","filterErrors","startErrorCollection","lifeCycle","observable","urlObj","statusGroup","urlHost","urlPath","urlPathGroup","rawRumEvent","date","starttime","processError","doStartErrorCollection","sessionId","getDeviceInfo","getNetWork","deviceInfo","getSystemInfoSync","osInfo","system","osVersion","osVersionMajor","deviceUUid","host","appId","screenSize","screenWidth","screenHeight","platform","platformVersion","version","os","brand","model","frameworkVersion","SDKVersion","pixelRatio","deviceUuid","clienetId","getStorageSync","setStorageSync","getNetworkType","network","networkType","onNetworkStatusChange","isTracked","threshold","startParentContexts","currentView","currentAction","previousViews","previousActions","currentContext","id","endTime","endClocks","buildCurrentViewContext","action","buildCurrentActionContext","startClocks","SESSION_RENEWED","clearOldContextsInterval","previousContexts","timeOutDelay","oldTimeThreshold","pop","clearOldContexts","userAction","page","referer","route","findContext","buildContext","flag","previousContext","findView","findAction","stop","clearInterval","commonTags","sdk_name","sdk_version","app_id","env","userid","session_id","is_signin","device","device_uuid","os_version","os_version_major","screen_size","network_type","platform_version","app_framework_version","view_id","view_name","view_referer","dataMap","view","tags","view_apdex_level","is_active","fields","page_fmp","first_paint_time","loading_time","onload_to_onshow","onshow_to_onready","time_spent","view_error_count","view_resource_count","view_long_task_count","view_action_count","view_setdata_count","resource_type","resource_status","resource_status_group","resource_method","resource_url","resource_url_host","resource_url_path","resource_url_path_group","resource_url_query","resource_size","resource_load","resource_dns","resource_tcp","resource_ssl","resource_ttfb","resource_trans","resource_first_byte","error_source","error_type","error_message","error_stack","long_task","action_id","action_name","action_type","HAS_MULTI_BYTES_CHARACTERS","httpRequest","endpointUrl","bytesLimit","send","addBatchPrecision","HttpRequest","batch","maxSize","flushOnVisibilityHidden","flushPeriodically","pushOnlyBuffer","upsertBuffer","bufferBytesSize","bufferMessageCount","add","addOrUpdate","upsert","flush","processSendData","rowStr","hasFileds","tagsStr","value_path","_key","_value","fieldsStr","_valueData","sizeInBytes","charCode","total","len","charCodeAt","process","processedMessage","messageBytesSize","hasMessageFor","remove","willReachedBytesLimitWith","isFull","removedMessage","Batch","startRumBatch","primaryBatch","createRumBatch","stopped","makeRumBatch","serverRumEvent","trackEventCounts","eventCounts","resourceCount","longTaskCount","userActionCount","subscription","startViewCollection","apdexLevel","fmp","Number","_dd","documentVersion","count","setdata","setdataCount","setdata_duration","setdataDuration","loadingTime","stayTime","onload2onshow","onload2onshowTime","onshow2onready","fpt","isActive","timeSpent","processViewUpdate","originPage","Page","rewritePage","computePerformanceResourceDuration","entry","responseEnd","computePerformanceResourceDetails","validEntry","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","requestStart","responseStart","hasRedirection","redirectStart","redirectEnd","toValidEntry","domainLookUpStart","domainLookUpEnd","SSLconnectionStart","SSLconnectionEnd","details","firstbyte","formatTiming","trans","ttfb","tcp","ssl","dns","redirect","origin","start","end","computeSize","receivedBytedCount","isAllowedRequestUrl","nextRequestIndex","startRequestCollection","xhrProxy","requestIndex","getNextRequestIndex","performance","trackXhr","dwonloadProxy","trackDownload","startResourceCollection","timing","correspondingTimingOverrides","load","size","computePerformanceEntryMetrics","resourceEvent","urlQuery","processRequest","startupTypes","rewriteApp","originApp","App","appInfo","isStartUp","app","methodName","userDefinedMethod","isHide","startupType","appUpdate","entitys","startupDuration","scriptLoadDuration","codeDownloadDuration","launchEntity","find","entity","entryType","navigationType","scriptentity","firstEntity","startPerformanceObservable","startAppCollection","appinfo","processAppUpdate","waitIdlePageActivity","completionCallback","_trackPageActivities","firstRequestIndex","subscriptions","pendingRequestsCount","notifyPageActivity","isBusy","startEvent","sub","trackPageActivities","pageActivitiesObservable","stopPageActivitiesTracking","stopWaitPageActivitiesCompletion","idleTimeoutId","hasCompleted","validationTimeoutId","complete","hadActivity","maxDurationTimeoutId","params","lastChangeTime","waitPageActivitiesCompletion","trackActions","currentIdlePageActivitySubscription","create","pendingAutoAction","PendingAutoAction","discard","discardCurrent","startActionManagement","clickProxy","_action","originComponent","Component","component","oirginMethod","currentTarget","dataset","actionType","content","title","text","pagePath","eventCountsSubscription","startActionCollection","autoActionProperties","counts","processAction","datafluxRum","startRumImpl","userConfiguration","transportConfiguration","applicationId","datakitOrigin","lastIndexOf","commonInit","parentContexts","viewContext","deviceContext","baseInfo","actionContext","rumContext","application","session","getSessionId","user","user_id","getClientID","startRumAssembly","getPerformance","createObserver","entryList","getEntries","observe","entryTypes","startPagePerformanceObservable","originPageOnLoad","setUpdatePerformanceListener","withDataPaths","originComponentAttached","startSetDataColloction","isAlreadyInitialized","init","canInitRum"],"mappings":"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","file":"dataflux-rum-miniapp.js","sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export const ONE_SECOND = 1000\nexport const ONE_MINUTE = 60 * ONE_SECOND\nexport const ONE_HOUR = 60 * ONE_MINUTE\nexport const ONE_KILO_BYTE = 1024\nexport const CLIENT_ID_TOKEN = 'datafluxRum:client:id'\nexport const RumEventType = {\n\tACTION: 'action',\n\tERROR: 'error',\n\tLONG_TASK: 'long_task',\n\tVIEW: 'view',\n\tRESOURCE: 'resource',\n\tAPP: 'app',\n\tACTION: 'action',\n}\n\nexport var RequestType = {\n\tXHR: 'network',\n\tDOWNLOAD: 'resource',\n}\n\nexport var ActionType = {\n\ttap: 'tap',\n\tlongpress: 'longpress',\n\tlongtap: 'longtap',\n}\nexport var MpHook = {\n\tdata: 1,\n\tonLoad: 1,\n\tonShow: 1,\n\tonReady: 1,\n\tonPullDownRefresh: 1,\n\tonReachBottom: 1,\n\tonShareAppMessage: 1,\n\tonPageScroll: 1,\n\tonResize: 1,\n\tonTabItemTap: 1,\n\tonHide: 1,\n\tonUnload: 1,\n}\n","import { MpHook } from './enums'\nvar ArrayProto = Array.prototype\nvar ObjProto = Object.prototype\nvar ObjProto = Object.prototype\nvar hasOwnProperty = ObjProto.hasOwnProperty\nvar slice = ArrayProto.slice\nvar toString = ObjProto.toString\nvar nativeForEach = ArrayProto.forEach\nvar breaker = false\nexport var isArguments = function (obj) {\n\treturn !!(obj && hasOwnProperty.call(obj, 'callee'))\n}\nexport var each = function (obj, iterator, context) {\n\tif (obj === null) return false\n\tif (nativeForEach && obj.forEach === nativeForEach) {\n\t\tobj.forEach(iterator, context)\n\t} else if (obj.length === +obj.length) {\n\t\tfor (var i = 0, l = obj.length; i < l; i++) {\n\t\t\tif (i in obj && iterator.call(context, obj[i], i, obj) === breaker) {\n\t\t\t\treturn false\n\t\t\t}\n\t\t}\n\t} else {\n\t\tfor (var key in obj) {\n\t\t\tif (hasOwnProperty.call(obj, key)) {\n\t\t\t\tif (iterator.call(context, obj[key], key, obj) === breaker) {\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\nexport var values = function (obj) {\n\tvar results = []\n\tif (obj === null) {\n\t\treturn results\n\t}\n\teach(obj, function (value) {\n\t\tresults[results.length] = value\n\t})\n\treturn results\n}\nexport function round(num, decimals) {\n\treturn +num.toFixed(decimals)\n}\n\nexport function msToNs(duration) {\n\tif (typeof duration !== 'number') {\n\t\treturn duration\n\t}\n\treturn round(duration * 1e6, 0)\n}\nexport var isUndefined = function (obj) {\n\treturn obj === void 0\n}\nexport var isString = function (obj) {\n\treturn toString.call(obj) === '[object String]'\n}\nexport var isDate = function (obj) {\n\treturn toString.call(obj) === '[object Date]'\n}\nexport var isBoolean = function (obj) {\n\treturn toString.call(obj) === '[object Boolean]'\n}\nexport var isNumber = function (obj) {\n\treturn toString.call(obj) === '[object Number]' && /[\\d\\.]+/.test(String(obj))\n}\n\nexport var toArray = function (iterable) {\n\tif (!iterable) return []\n\tif (iterable.toArray) {\n\t\treturn iterable.toArray()\n\t}\n\tif (Array.isArray(iterable)) {\n\t\treturn slice.call(iterable)\n\t}\n\tif (isArguments(iterable)) {\n\t\treturn slice.call(iterable)\n\t}\n\treturn values(iterable)\n}\nexport var areInOrder = function () {\n\tvar numbers = toArray(arguments)\n\tfor (var i = 1; i < numbers.length; i += 1) {\n\t\tif (numbers[i - 1] > numbers[i]) {\n\t\t\treturn false\n\t\t}\n\t}\n\treturn true\n}\n/**\n * UUID v4\n * from https://gist.github.com/jed/982883\n */\nexport function UUID(placeholder) {\n\treturn placeholder\n\t\t? // tslint:disable-next-line no-bitwise\n\t\t  (\n\t\t\t\tparseInt(placeholder, 10) ^\n\t\t\t\t((Math.random() * 16) >> (parseInt(placeholder, 10) / 4))\n\t\t  ).toString(16)\n\t\t: `${1e7}-${1e3}-${4e3}-${8e3}-${1e11}`.replace(/[018]/g, UUID)\n}\nexport function jsonStringify(value, replacer, space) {\n\tif (value === null || value === undefined) {\n\t\treturn JSON.stringify(value)\n\t}\n\tvar originalToJSON = [false, undefined]\n\tif (hasToJSON(value)) {\n\t\t// We need to add a flag and not rely on the truthiness of value.toJSON\n\t\t// because it can be set but undefined and that's actually significant.\n\t\toriginalToJSON = [true, value.toJSON]\n\t\tdelete value.toJSON\n\t}\n\n\tvar originalProtoToJSON = [false, undefined]\n\tvar prototype\n\tif (typeof value === 'object') {\n\t\tprototype = Object.getPrototypeOf(value)\n\t\tif (hasToJSON(prototype)) {\n\t\t\toriginalProtoToJSON = [true, prototype.toJSON]\n\t\t\tdelete prototype.toJSON\n\t\t}\n\t}\n\n\tvar result\n\ttry {\n\t\tresult = JSON.stringify(value, undefined, space)\n\t} catch (e) {\n\t\tresult = '<error: unable to serialize object>'\n\t} finally {\n\t\tif (originalToJSON[0]) {\n\t\t\tvalue.toJSON = originalToJSON[1]\n\t\t}\n\t\tif (originalProtoToJSON[0]) {\n\t\t\tprototype.toJSON = originalProtoToJSON[1]\n\t\t}\n\t}\n\treturn result\n}\nfunction hasToJSON(value) {\n\treturn (\n\t\ttypeof value === 'object' &&\n\t\tvalue !== null &&\n\t\tvalue.hasOwnProperty('toJSON')\n\t)\n}\nexport function elapsed(start, end) {\n\treturn end - start\n}\nexport function getMethods(obj) {\n\tvar funcs = []\n\tfor (var key in obj) {\n\t\tif (typeof obj[key] === 'function' && !MpHook[key]) {\n\t\t\tfuncs.push(key)\n\t\t}\n\t}\n\treturn funcs\n}\n// 替换url包含数字的路由\nexport function replaceNumberCharByPath(path) {\n\tif (path) {\n\t\treturn path.replace(/\\/([^\\/]*)\\d([^\\/]*)/g, '/?')\n\t} else {\n\t\treturn ''\n\t}\n}\nexport function getStatusGroup(status) {\n\tif (!status) return status\n\treturn (\n\t\tString(status).substr(0, 1) + String(status).substr(1).replace(/\\d*/g, 'x')\n\t)\n}\nexport var getQueryParamsFromUrl = function (url) {\n\tvar result = {}\n\tvar arr = url.split('?')\n\tvar queryString = arr[1] || ''\n\tif (queryString) {\n\t\tresult = getURLSearchParams('?' + queryString)\n\t}\n\treturn result\n}\nexport function isPercentage(value) {\n\treturn isNumber(value) && value >= 0 && value <= 100\n}\n\nexport var extend = function (obj) {\n\tslice.call(arguments, 1).forEach(function (source) {\n\t\tfor (var prop in source) {\n\t\t\tif (source[prop] !== void 0) {\n\t\t\t\tobj[prop] = source[prop]\n\t\t\t}\n\t\t}\n\t})\n\treturn obj\n}\nexport var extend2Lev = function (obj) {\n\tslice.call(arguments, 1).forEach(function (source) {\n\t\tfor (var prop in source) {\n\t\t\tif (source[prop] !== void 0) {\n\t\t\t\tif (isObject(source[prop]) && isObject(obj[prop])) {\n\t\t\t\t\textend(obj[prop], source[prop])\n\t\t\t\t} else {\n\t\t\t\t\tobj[prop] = source[prop]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t})\n\treturn obj\n}\n\nexport var trim = function (str) {\n\treturn str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '')\n}\nexport var isObject = function (obj) {\n\tif (obj === null) return false\n\treturn toString.call(obj) === '[object Object]'\n}\nexport var isEmptyObject = function (obj) {\n\tif (isObject(obj)) {\n\t\tfor (var key in obj) {\n\t\t\tif (hasOwnProperty.call(obj, key)) {\n\t\t\t\treturn false\n\t\t\t}\n\t\t}\n\t\treturn true\n\t} else {\n\t\treturn false\n\t}\n}\n\nexport var isJSONString = function (str) {\n\ttry {\n\t\tJSON.parse(str)\n\t} catch (e) {\n\t\treturn false\n\t}\n\treturn true\n}\nexport var safeJSONParse = function (str) {\n\tvar val = null\n\ttry {\n\t\tval = JSON.parse(str)\n\t} catch (e) {\n\t\treturn false\n\t}\n\treturn val\n}\nexport var now =\n\tDate.now ||\n\tfunction () {\n\t\treturn new Date().getTime()\n\t}\nexport var throttle = function (func, wait, options) {\n\tvar timeout, context, args, result\n\tvar previous = 0\n\tif (!options) options = {}\n\n\tvar later = function () {\n\t\tprevious = options.leading === false ? 0 : new Date().getTime()\n\t\ttimeout = null\n\t\tresult = func.apply(context, args)\n\t\tif (!timeout) context = args = null\n\t}\n\n\tvar throttled = function () {\n\t\targs = arguments\n\t\tvar now = new Date().getTime()\n\t\tif (!previous && options.leading === false) previous = now\n\t\t//下次触发 func 剩余的时间\n\t\tvar remaining = wait - (now - previous)\n\t\tcontext = this\n\t\t// 如果没有剩余的时间了或者你改了系统时间\n\t\tif (remaining <= 0 || remaining > wait) {\n\t\t\tif (timeout) {\n\t\t\t\tclearTimeout(timeout)\n\t\t\t\ttimeout = null\n\t\t\t}\n\t\t\tprevious = now\n\t\t\tresult = func.apply(context, args)\n\t\t\tif (!timeout) context = args = null\n\t\t} else if (!timeout && options.trailing !== false) {\n\t\t\ttimeout = setTimeout(later, remaining)\n\t\t}\n\t\treturn result\n\t}\n\tthrottled.cancel = function () {\n\t\tclearTimeout(timeout)\n\t\tprevious = 0\n\t\ttimeout = null\n\t}\n\treturn throttled\n}\nexport function noop() {}\n/**\n * Return true if the draw is successful\n * @param threshold between 0 and 100\n */\nexport function performDraw(threshold) {\n\treturn threshold !== 0 && Math.random() * 100 <= threshold\n}\nexport function findByPath(source, path) {\n\tvar pathArr = path.split('.')\n\twhile (pathArr.length) {\n\t\tvar key = pathArr.shift()\n\t\tif (source && key in source && hasOwnProperty.call(source, key)) {\n\t\t\tsource = source[key]\n\t\t} else {\n\t\t\treturn undefined\n\t\t}\n\t}\n\treturn source\n}\nexport function withSnakeCaseKeys(candidate) {\n\tconst result = {}\n\tObject.keys(candidate).forEach((key) => {\n\t\tresult[toSnakeCase(key)] = deepSnakeCase(candidate[key])\n\t})\n\treturn result\n}\n\nexport function deepSnakeCase(candidate) {\n\tif (Array.isArray(candidate)) {\n\t\treturn candidate.map((value) => deepSnakeCase(value))\n\t}\n\tif (typeof candidate === 'object' && candidate !== null) {\n\t\treturn withSnakeCaseKeys(candidate)\n\t}\n\treturn candidate\n}\n\nexport function toSnakeCase(word) {\n\treturn word\n\t\t.replace(/[A-Z]/g, function (uppercaseLetter, index) {\n\t\t\treturn (index !== 0 ? '_' : '') + uppercaseLetter.toLowerCase()\n\t\t})\n\t\t.replace(/-/g, '_')\n}\n\nexport function escapeRowData(str) {\n\tif (!isString(str)) return str\n\tvar reg = /[\\s=,\"]/g\n\treturn String(str).replace(reg, function (word) {\n\t\treturn '\\\\' + word\n\t})\n}\nexport var urlParse = function (para) {\n\tvar URLParser = function (a) {\n\t\tthis._fields = {\n\t\t\tUsername: 4,\n\t\t\tPassword: 5,\n\t\t\tPort: 7,\n\t\t\tProtocol: 2,\n\t\t\tHost: 6,\n\t\t\tPath: 8,\n\t\t\tURL: 0,\n\t\t\tQueryString: 9,\n\t\t\tFragment: 10,\n\t\t}\n\t\tthis._values = {}\n\t\tthis._regex = null\n\t\tthis._regex = /^((\\w+):\\/\\/)?((\\w+):?(\\w+)?@)?([^\\/\\?:]+):?(\\d+)?(\\/?[^\\?#]+)?\\??([^#]+)?#?(\\w*)/\n\n\t\tif (typeof a != 'undefined') {\n\t\t\tthis._parse(a)\n\t\t}\n\t}\n\tURLParser.prototype.setUrl = function (a) {\n\t\tthis._parse(a)\n\t}\n\tURLParser.prototype._initValues = function () {\n\t\tfor (var a in this._fields) {\n\t\t\tthis._values[a] = ''\n\t\t}\n\t}\n\tURLParser.prototype.addQueryString = function (queryObj) {\n\t\tif (typeof queryObj !== 'object') {\n\t\t\treturn false\n\t\t}\n\t\tvar query = this._values.QueryString || ''\n\t\tfor (var i in queryObj) {\n\t\t\tif (new RegExp(i + '[^&]+').test(query)) {\n\t\t\t\tquery = query.replace(new RegExp(i + '[^&]+'), i + '=' + queryObj[i])\n\t\t\t} else {\n\t\t\t\tif (query.slice(-1) === '&') {\n\t\t\t\t\tquery = query + i + '=' + queryObj[i]\n\t\t\t\t} else {\n\t\t\t\t\tif (query === '') {\n\t\t\t\t\t\tquery = i + '=' + queryObj[i]\n\t\t\t\t\t} else {\n\t\t\t\t\t\tquery = query + '&' + i + '=' + queryObj[i]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._values.QueryString = query\n\t}\n\tURLParser.prototype.getParse = function () {\n\t\treturn this._values\n\t}\n\tURLParser.prototype.getUrl = function () {\n\t\tvar url = ''\n\t\turl += this._values.Origin\n\t\turl += this._values.Port ? ':' + this._values.Port : ''\n\t\turl += this._values.Path\n\t\turl += this._values.QueryString ? '?' + this._values.QueryString : ''\n\t\treturn url\n\t}\n\tURLParser.prototype._parse = function (a) {\n\t\tthis._initValues()\n\t\tvar b = this._regex.exec(a)\n\t\tif (!b) {\n\t\t\tthrow 'DPURLParser::_parse -> Invalid URL'\n\t\t}\n\t\tfor (var c in this._fields) {\n\t\t\tif (typeof b[this._fields[c]] != 'undefined') {\n\t\t\t\tthis._values[c] = b[this._fields[c]]\n\t\t\t}\n\t\t}\n\t\tthis._values['Hostname'] = this._values['Host'].replace(/:\\d+$/, '')\n\t\tthis._values['Origin'] =\n\t\t\tthis._values['Protocol'] + '://' + this._values['Hostname']\n\t}\n\treturn new URLParser(para)\n}\nexport const getOwnObjectKeys = function (obj, isEnumerable) {\n\tvar keys = Object.keys(obj)\n\tif (Object.getOwnPropertySymbols) {\n\t\tvar symbols = Object.getOwnPropertySymbols(obj)\n\t\tif (isEnumerable) {\n\t\t\tsymbols = symbols.filter(function (t) {\n\t\t\t\treturn Object.getOwnPropertyDescriptor(obj, t).enumerable\n\t\t\t})\n\t\t}\n\t\tkeys.push.apply(keys, symbols)\n\t}\n\treturn keys\n}\nexport const defineObject = function (obj, key, value) {\n\tif (key in obj) {\n\t\tObject.defineProperty(obj, key, {\n\t\t\tvalue,\n\t\t\tenumerable: true,\n\t\t\tconfigurable: true,\n\t\t\twritable: true,\n\t\t})\n\t} else {\n\t\tobj[key] = value\n\t}\n\treturn obj\n}\nexport const deepMixObject = function (targetObj) {\n\tfor (var t = 1; t < arguments.length; t++) {\n\t\tvar target = arguments[t] != null ? arguments[t] : {}\n\t\tif (t % 2) {\n\t\t\tgetOwnObjectKeys(Object(target), true).forEach(function (t) {\n\t\t\t\tdefineObject(targetObj, t, target[t])\n\t\t\t})\n\t\t} else {\n\t\t\tif (Object.getOwnPropertyDescriptors) {\n\t\t\t\tObject.defineProperties(\n\t\t\t\t\ttargetObj,\n\t\t\t\t\tObject.getOwnPropertyDescriptors(target),\n\t\t\t\t)\n\t\t\t} else {\n\t\t\t\tgetOwnObjectKeys(Object(target)).forEach(function (t) {\n\t\t\t\t\tObject.defineProperty(\n\t\t\t\t\t\ttargetObj,\n\t\t\t\t\t\tt,\n\t\t\t\t\t\tObject.getOwnPropertyDescriptor(target, t),\n\t\t\t\t\t)\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\treturn targetObj\n}\n","export const buildEnv = {\n\tsdkVersion: '<<< SDK_VERSION >>>',\n\tsdkName: 'df_miniapp_rum_sdk',\n}\n","export class LifeCycle {\n\tconstructor() {\n\t\tthis.callbacks = {}\n\t}\n\tnotify(eventType, data) {\n\t\tconst eventCallbacks = this.callbacks[eventType]\n\t\tif (eventCallbacks) {\n\t\t\teventCallbacks.forEach((callback) => callback(data))\n\t\t}\n\t}\n\tsubscribe(eventType, callback) {\n\t\tif (!this.callbacks[eventType]) {\n\t\t\tthis.callbacks[eventType] = []\n\t\t}\n\t\tthis.callbacks[eventType].push(callback)\n\t\treturn {\n\t\t\tunsubscribe: () => {\n\t\t\t\tthis.callbacks[eventType] = this.callbacks[eventType].filter(\n\t\t\t\t\t(other) => callback !== other,\n\t\t\t\t)\n\t\t\t},\n\t\t}\n\t}\n}\n\nexport var LifeCycleEventType = {\n\tPERFORMANCE_ENTRY_COLLECTED: 'PERFORMANCE_ENTRY_COLLECTED',\n\tAUTO_ACTION_CREATED: 'AUTO_ACTION_CREATED',\n\tAUTO_ACTION_COMPLETED: 'AUTO_ACTION_COMPLETED',\n\tAUTO_ACTION_DISCARDED: 'AUTO_ACTION_DISCARDED',\n\tAPP_HIDE: 'APP_HIDE',\n\tAPP_UPDATE: 'APP_UPDATE',\n\tPAGE_SET_DATA_UPDATE: 'PAGE_SET_DATA_UPDATE',\n\tPAGE_ALIAS_ACTION: 'PAGE_ALIAS_ACTION',\n\tVIEW_CREATED: 'VIEW_CREATED',\n\tVIEW_UPDATED: 'VIEW_UPDATED',\n\tVIEW_ENDED: 'VIEW_ENDED',\n\tREQUEST_STARTED: 'REQUEST_STARTED',\n\tREQUEST_COMPLETED: 'REQUEST_COMPLETED',\n\tRAW_RUM_EVENT_COLLECTED: 'RAW_RUM_EVENT_COLLECTED',\n\tRUM_EVENT_COLLECTED: 'RUM_EVENT_COLLECTED',\n}\n","import { extend2Lev, urlParse } from '../helper/utils'\nimport { ONE_KILO_BYTE, ONE_SECOND } from '../helper/enums'\nexport var DEFAULT_CONFIGURATION = {\n\tsampleRate: 100,\n\tflushTimeout: 30 * ONE_SECOND,\n\tmaxErrorsByMinute: 3000,\n\t/**\n\t * Logs intake limit\n\t */\n\tmaxBatchSize: 50,\n\tmaxMessageSize: 256 * ONE_KILO_BYTE,\n\n\t/**\n\t * beacon payload max queue size implementation is 64kb\n\t * ensure that we leave room for logs, rum and potential other users\n\t */\n\tbatchBytesLimit: 16 * ONE_KILO_BYTE,\n\tdatakitUrl: '',\n\t/**\n\t * arbitrary value, byte precision not needed\n\t */\n\trequestErrorResponseLengthLimit: 32 * ONE_KILO_BYTE,\n\ttrackInteractions: false,\n}\n\nfunction getDatakitUrlUrl(url) {\n\tif (url && url.lastIndexOf('/') === url.length - 1)\n\t\treturn url + 'v1/write/rum'\n\treturn url + '/v1/write/rum'\n}\nexport function commonInit(userConfiguration, buildEnv) {\n\tvar transportConfiguration = {\n\t\tapplicationId: userConfiguration.applicationId,\n\t\tenv: userConfiguration.env || '',\n\t\tversion: userConfiguration.version || '',\n\t\tsdkVersion: buildEnv.sdkVersion,\n\t\tsdkName: buildEnv.sdkName,\n\t\tdatakitUrl: getDatakitUrlUrl(\n\t\t\tuserConfiguration.datakitUrl || userConfiguration.datakitOrigin,\n\t\t),\n\t\ttags: userConfiguration.tags || [],\n\t}\n\tif ('trackInteractions' in userConfiguration) {\n\t\ttransportConfiguration.trackInteractions = !!userConfiguration.trackInteractions\n\t}\n\treturn extend2Lev(DEFAULT_CONFIGURATION, transportConfiguration)\n}\nconst haveSameOrigin = function (url1, url2) {\n\tconst parseUrl1 = urlParse(url1).getParse()\n\tconst parseUrl2 = urlParse(url2).getParse()\n\treturn parseUrl1.Origin === parseUrl2.Origin\n}\nexport function isIntakeRequest(url, configuration) {\n\treturn haveSameOrigin(url, configuration.datakitUrl)\n}\n","export var ErrorSource = {\n\tAGENT: 'agent',\n\tCONSOLE: 'console',\n\tNETWORK: 'network',\n\tSOURCE: 'source',\n\tLOGGER: 'logger',\n}\nexport function formatUnknownError(stackTrace, errorObject, nonErrorPrefix) {\n\tif (\n\t\t!stackTrace ||\n\t\t(stackTrace.message === undefined && !(errorObject instanceof Error))\n\t) {\n\t\treturn {\n\t\t\tmessage: nonErrorPrefix + '' + JSON.stringify(errorObject),\n\t\t\tstack: 'No stack, consider using an instance of Error',\n\t\t\ttype: stackTrace && stackTrace.name,\n\t\t}\n\t}\n\treturn {\n\t\tmessage: stackTrace.message || 'Empty message',\n\t\tstack: toStackTraceString(stackTrace),\n\t\ttype: stackTrace.name,\n\t}\n}\n\nexport function toStackTraceString(stack) {\n\tvar result = stack.name || 'Error' + ': ' + stack.message\n\tstack.stack.forEach(function (frame) {\n\t\tvar func = frame.func === '?' ? '<anonymous>' : frame.func\n\t\tvar args =\n\t\t\tframe.args && frame.args.length > 0\n\t\t\t\t? '(' + frame.args.join(', ') + ')'\n\t\t\t\t: ''\n\t\tvar line = frame.line ? ':' + frame.line : ''\n\t\tvar column = frame.line && frame.column ? ':' + frame.column : ''\n\t\tresult += '\\n  at ' + func + args + ' @ ' + frame.url + line + column\n\t})\n\treturn result\n}\n","import { deepMixObject } from '../helper/utils'\n\nfunction getSDK() {\n\tvar sdk = null,\n\t\ttracker = ''\n\ttry {\n\t\tif (wx && typeof wx === 'object' && typeof wx.request === 'function') {\n\t\t\tsdk = deepMixObject({}, wx)\n\t\t\ttracker = 'wx'\n\t\t\twx = sdk\n\t\t}\n\t} catch (err) {\n\t\tconsole.warn('unsupport platform, Fail to start')\n\t}\n\tconsole.log('------get SDK-------')\n\treturn { sdk, tracker }\n}\nconst instance = getSDK()\n\nexport const sdk = instance.sdk\nexport const tracker = instance.tracker\n","import { sdk } from '../core/sdk'\n\nconst UNKNOWN_FUNCTION = '?'\nfunction has(object, key) {\n\treturn Object.prototype.hasOwnProperty.call(object, key)\n}\nfunction isUndefined(what) {\n\treturn typeof what === 'undefined'\n}\nexport function wrap(func) {\n\tvar _this = this\n\tfunction wrapped() {\n\t\ttry {\n\t\t\treturn func.apply(_this, arguments)\n\t\t} catch (e) {\n\t\t\treport(e)\n\t\t\tthrow e\n\t\t}\n\t}\n\treturn wrapped\n}\n/**\n * Cross-browser processing of unhandled exceptions\n *\n * Syntax:\n * ```js\n *   report.subscribe(function(stackInfo) { ... })\n *   report.unsubscribe(function(stackInfo) { ... })\n *   report(exception)\n *   try { ...code... } catch(ex) { report(ex); }\n * ```\n *\n * Supports:\n *   - Firefox: full stack trace with line numbers, plus column number\n *     on top frame; column number is not guaranteed\n *   - Opera: full stack trace with line and column numbers\n *   - Chrome: full stack trace with line and column numbers\n *   - Safari: line and column number for the top frame only; some frames\n *     may be missing, and column number is not guaranteed\n *   - IE: line and column number for the top frame only; some frames\n *     may be missing, and column number is not guaranteed\n *\n * In theory, TraceKit should work on all of the following versions:\n *   - IE5.5+ (only 8.0 tested)\n *   - Firefox 0.9+ (only 3.5+ tested)\n *   - Opera 7+ (only 10.50 tested; versions 9 and earlier may require\n *     Exceptions Have Stacktrace to be enabled in opera:config)\n *   - Safari 3+ (only 4+ tested)\n *   - Chrome 1+ (only 5+ tested)\n *   - Konqueror 3.5+ (untested)\n *\n * Requires computeStackTrace.\n *\n * Tries to catch all unhandled exceptions and report them to the\n * subscribed handlers. Please note that report will rethrow the\n * exception. This is REQUIRED in order to get a useful stack trace in IE.\n * If the exception does not reach the top of the browser, you will only\n * get a stack trace from the point where report was called.\n *\n * Handlers receive a StackTrace object as described in the\n * computeStackTrace docs.\n *\n * @memberof TraceKit\n * @namespace\n */\nexport var report = (function reportModuleWrapper() {\n\tvar handlers = []\n\n\t/**\n\t * Add a crash handler.\n\t * @param {Function} handler\n\t * @memberof report\n\t */\n\tfunction subscribe(handler) {\n\t\tinstallGlobalHandler()\n\t\tinstallGlobalUnhandledRejectionHandler()\n\t\tinstallGlobalOnPageNotFoundHandler()\n\t\tinstallGlobalOnMemoryWarningHandler()\n\t\thandlers.push(handler)\n\t}\n\n\t/**\n\t * Remove a crash handler.\n\t * @param {Function} handler\n\t * @memberof report\n\t */\n\tfunction unsubscribe(handler) {\n\t\tfor (var i = handlers.length - 1; i >= 0; i -= 1) {\n\t\t\tif (handlers[i] === handler) {\n\t\t\t\thandlers.splice(i, 1)\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Dispatch stack information to all handlers.\n\t * @param {StackTrace} stack\n\t * @param {boolean} isWindowError Is this a top-level window error?\n\t * @param {Error=} error The error that's being handled (if available, null otherwise)\n\t * @memberof report\n\t * @throws An exception if an error occurs while calling an handler.\n\t */\n\tfunction notifyHandlers(stack, isWindowError, error) {\n\t\tvar exception\n\t\tfor (var i in handlers) {\n\t\t\tif (has(handlers, i)) {\n\t\t\t\ttry {\n\t\t\t\t\thandlers[i](stack, isWindowError, error)\n\t\t\t\t} catch (inner) {\n\t\t\t\t\texception = inner\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (exception) {\n\t\t\tthrow exception\n\t\t}\n\t}\n\n\tvar onErrorHandlerInstalled\n\tvar onUnhandledRejectionHandlerInstalled\n\tvar onPageNotFoundHandlerInstalled\n\tvar onOnMemoryWarningHandlerInstalled\n\t/**\n\t * Ensures all global unhandled exceptions are recorded.\n\t * Supported by Gecko and IE.\n\t * @param {Event|string} message Error message.\n\t * @param {string=} url URL of script that generated the exception.\n\t * @param {(number|string)=} lineNo The line number at which the error occurred.\n\t * @param {(number|string)=} columnNo The column number at which the error occurred.\n\t * @param {Error=} errorObj The actual Error object.\n\t * @memberof report\n\t */\n\tfunction traceKitWindowOnError(err) {\n\t\tconst error = typeof err === 'string' ? new Error(err) : err\n\t\tvar stack\n\t\tvar name = ''\n\t\tvar msg = ''\n\t\tstack = computeStackTrace(error)\n\t\tif (\n\t\t\terror &&\n\t\t\terror.message &&\n\t\t\t{}.toString.call(error.message) === '[object String]'\n\t\t) {\n\t\t\tconst messages = error.message.split('\\n')\n\t\t\tif (messages.length >= 3) {\n\t\t\t\tmsg = messages[2]\n\t\t\t\tconst groups = msg.match(ERROR_TYPES_RE)\n\t\t\t\tif (groups) {\n\t\t\t\t\tname = groups[1]\n\t\t\t\t\tmsg = groups[2]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (msg) {\n\t\t\tstack.message = msg\n\t\t}\n\t\tif (name) {\n\t\t\tstack.name = name\n\t\t}\n\t\tnotifyHandlers(stack, true, error)\n\t}\n\n\t/**\n\t * Ensures all unhandled rejections are recorded.\n\t * @param {PromiseRejectionEvent} e event.\n\t * @memberof report\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onunhandledrejection\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/PromiseRejectionEvent\n\t */\n\tfunction traceKitWindowOnUnhandledRejection({ reason, promise }) {\n\t\tconst error = typeof reason === 'string' ? new Error(reason) : reason\n\t\tvar stack\n\t\tvar name = ''\n\t\tvar msg = ''\n\t\tstack = computeStackTrace(error)\n\t\tif (\n\t\t\terror &&\n\t\t\terror.message &&\n\t\t\t{}.toString.call(error.message) === '[object String]'\n\t\t) {\n\t\t\tconst messages = error.message.split('\\n')\n\t\t\tif (messages.length >= 3) {\n\t\t\t\tmsg = messages[2]\n\t\t\t\tconst groups = msg.match(ERROR_TYPES_RE)\n\t\t\t\tif (groups) {\n\t\t\t\t\tname = groups[1]\n\t\t\t\t\tmsg = groups[2]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (msg) {\n\t\t\tstack.message = msg\n\t\t}\n\t\tif (name) {\n\t\t\tstack.name = name\n\t\t}\n\t\tnotifyHandlers(stack, true, error)\n\t}\n\n\t/**\n\t * Install a global onerror handler\n\t * @memberof report\n\t */\n\tfunction installGlobalHandler() {\n\t\tif (onErrorHandlerInstalled || !sdk.onError) {\n\t\t\treturn\n\t\t}\n\t\tsdk.onError(traceKitWindowOnError)\n\t\tonErrorHandlerInstalled = true\n\t}\n\n\t/**\n\t * Install a global onunhandledrejection handler\n\t * @memberof report\n\t */\n\tfunction installGlobalUnhandledRejectionHandler() {\n\t\tif (onUnhandledRejectionHandlerInstalled || !sdk.onUnhandledRejection) {\n\t\t\treturn\n\t\t}\n\n\t\tsdk.onUnhandledRejection &&\n\t\t\tsdk.onUnhandledRejection(traceKitWindowOnUnhandledRejection)\n\t\tonUnhandledRejectionHandlerInstalled = true\n\t}\n\tfunction installGlobalOnPageNotFoundHandler() {\n\t\tif (onPageNotFoundHandlerInstalled || !sdk.onPageNotFound) {\n\t\t\treturn\n\t\t}\n\t\tsdk.onPageNotFound((res) => {\n\t\t\tconst url = res.path.split('?')[0]\n\t\t\tnotifyHandlers(\n\t\t\t\t{\n\t\t\t\t\tmessage: JSON.stringify(res),\n\t\t\t\t\ttype: 'pagenotfound',\n\t\t\t\t\tname: url + '页面无法找到',\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t\t{},\n\t\t\t)\n\t\t})\n\t\tonPageNotFoundHandlerInstalled = true\n\t}\n\tfunction installGlobalOnMemoryWarningHandler() {\n\t\tif (onOnMemoryWarningHandlerInstalled || !sdk.onMemoryWarning) {\n\t\t\treturn\n\t\t}\n\t\tsdk.onMemoryWarning(({ level = -1 }) => {\n\t\t\tlet levelMessage = '没有获取到告警级别信息'\n\n\t\t\tswitch (level) {\n\t\t\t\tcase 5:\n\t\t\t\t\tlevelMessage = 'TRIM_MEMORY_RUNNING_MODERATE'\n\t\t\t\t\tbreak\n\t\t\t\tcase 10:\n\t\t\t\t\tlevelMessage = 'TRIM_MEMORY_RUNNING_LOW'\n\t\t\t\t\tbreak\n\t\t\t\tcase 15:\n\t\t\t\t\tlevelMessage = 'TRIM_MEMORY_RUNNING_CRITICAL'\n\t\t\t\t\tbreak\n\t\t\t\tdefault:\n\t\t\t\t\treturn\n\t\t\t}\n\t\t\tnotifyHandlers(\n\t\t\t\t{\n\t\t\t\t\tmessage: levelMessage,\n\t\t\t\t\ttype: 'memorywarning',\n\t\t\t\t\tname: '内存不足告警',\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t\t{},\n\t\t\t)\n\t\t})\n\t\tonOnMemoryWarningHandlerInstalled = true\n\t}\n\t/**\n\t * Reports an unhandled Error.\n\t * @param {Error} ex\n\t * @memberof report\n\t * @throws An exception if an incompvare stack trace is detected (old IE browsers).\n\t */\n\tfunction doReport(ex) {}\n\n\tdoReport.subscribe = subscribe\n\tdoReport.unsubscribe = unsubscribe\n\tdoReport.traceKitWindowOnError = traceKitWindowOnError\n\n\treturn doReport\n})()\n\n/**\n * computeStackTrace: cross-browser stack traces in JavaScript\n *\n * Syntax:\n *   ```js\n *   s = computeStackTrace.ofCaller([depth])\n *   s = computeStackTrace(exception) // consider using report instead (see below)\n *   ```\n *\n * Supports:\n *   - Firefox:  full stack trace with line numbers and unreliable column\n *               number on top frame\n *   - Opera 10: full stack trace with line and column numbers\n *   - Opera 9-: full stack trace with line numbers\n *   - Chrome:   full stack trace with line and column numbers\n *   - Safari:   line and column number for the topmost stacktrace element\n *               only\n *   - IE:       no line numbers whatsoever\n *\n * Tries to guess names of anonymous functions by looking for assignments\n * in the source code. In IE and Safari, we have to guess source file names\n * by searching for function bodies inside all page scripts. This will not\n * work for scripts that are loaded cross-domain.\n * Here be dragons: some function names may be guessed incorrectly, and\n * duplicate functions may be mismatched.\n *\n * computeStackTrace should only be used for tracing purposes.\n * Logging of unhandled exceptions should be done with report,\n * which builds on top of computeStackTrace and provides better\n * IE support by utilizing the sdk.onError event to retrieve information\n * about the top of the stack.\n *\n * Note: In IE and Safari, no stack trace is recorded on the Error object,\n * so computeStackTrace instead walks its *own* chain of callers.\n * This means that:\n *  * in Safari, some methods may be missing from the stack trace;\n *  * in IE, the topmost function in the stack trace will always be the\n *    caller of computeStackTrace.\n *\n * This is okay for tracing (because you are likely to be calling\n * computeStackTrace from the function you want to be the topmost element\n * of the stack trace anyway), but not okay for logging unhandled\n * exceptions (because your catch block will likely be far away from the\n * inner function that actually caused the exception).\n *\n * Tracing example:\n *  ```js\n *     function trace(message) {\n *         var stackInfo = computeStackTrace.ofCaller();\n *         var data = message + \"\\n\";\n *         for(var i in stackInfo.stack) {\n *             var item = stackInfo.stack[i];\n *             data += (item.func || '[anonymous]') + \"() in \" + item.url + \":\" + (item.line || '0') + \"\\n\";\n *         }\n *         if (window.console)\n *             console.info(data);\n *         else\n *             alert(data);\n *     }\n * ```\n * @memberof TraceKit\n * @namespace\n */\nexport var computeStackTrace = (function computeStackTraceWrapper() {\n\tvar debug = false\n\n\t// Contents of Exception in various browsers.\n\t//\n\t// SAFARI:\n\t// ex.message = Can't find variable: qq\n\t// ex.line = 59\n\t// ex.sourceId = 580238192\n\t// ex.sourceURL = http://...\n\t// ex.expressionBeginOffset = 96\n\t// ex.expressionCaretOffset = 98\n\t// ex.expressionEndOffset = 98\n\t// ex.name = ReferenceError\n\t//\n\t// FIREFOX:\n\t// ex.message = qq is not defined\n\t// ex.fileName = http://...\n\t// ex.lineNumber = 59\n\t// ex.columnNumber = 69\n\t// ex.stack = ...stack trace... (see the example below)\n\t// ex.name = ReferenceError\n\t//\n\t// CHROME:\n\t// ex.message = qq is not defined\n\t// ex.name = ReferenceError\n\t// ex.type = not_defined\n\t// ex.arguments = ['aa']\n\t// ex.stack = ...stack trace...\n\t//\n\t// INTERNET EXPLORER:\n\t// ex.message = ...\n\t// ex.name = ReferenceError\n\t//\n\t// OPERA:\n\t// ex.message = ...message... (see the example below)\n\t// ex.name = ReferenceError\n\t// ex.opera#sourceloc = 11  (pretty much useless, duplicates the info in ex.message)\n\t// ex.stacktrace = n/a; see 'opera:config#UserPrefs|Exceptions Have Stacktrace'\n\n\t/**\n\t * Computes stack trace information from the stack property.\n\t * Chrome and Gecko use this property.\n\t * @param {Error} ex\n\t * @return {?StackTrace} Stack trace information.\n\t * @memberof computeStackTrace\n\t */\n\tfunction computeStackTraceFromStackProp(ex) {\n\t\tif (!ex.stack) {\n\t\t\treturn\n\t\t}\n\n\t\t// tslint:disable-next-line max-line-length\n\t\tvar chrome = /^\\s*at (.*?) ?\\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|\\/).*?)(?::(\\d+))?(?::(\\d+))?\\)?\\s*$/i\n\t\t// tslint:disable-next-line max-line-length\n\t\tvar gecko = /^\\s*(.*?)(?:\\((.*?)\\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\\[native).*?|[^@]*bundle)(?::(\\d+))?(?::(\\d+))?\\s*$/i\n\t\t// tslint:disable-next-line max-line-length\n\t\tvar winjs = /^\\s*at (?:((?:\\[object object\\])?.+) )?\\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\\d+)(?::(\\d+))?\\)?\\s*$/i\n\n\t\t// Used to additionally parse URL/line/column from eval frames\n\t\tvar isEval\n\t\tvar geckoEval = /(\\S+) line (\\d+)(?: > eval line \\d+)* > eval/i\n\t\tvar chromeEval = /\\((\\S*)(?::(\\d+))(?::(\\d+))\\)/\n\t\tvar lines = ex.stack.split('\\n')\n\t\tvar stack = []\n\t\tvar submatch\n\t\tvar parts\n\t\tvar element\n\n\t\tfor (var i = 0, j = lines.length; i < j; i += 1) {\n\t\t\tif (chrome.exec(lines[i])) {\n\t\t\t\tparts = chrome.exec(lines[i])\n\t\t\t\tvar isNative = parts[2] && parts[2].indexOf('native') === 0 // start of line\n\t\t\t\tisEval = parts[2] && parts[2].indexOf('eval') === 0 // start of line\n\t\t\t\tsubmatch = chromeEval.exec(parts[2])\n\t\t\t\tif (isEval && submatch) {\n\t\t\t\t\t// throw out eval line/column and use top-most line/column number\n\t\t\t\t\tparts[2] = submatch[1] // url\n\t\t\t\t\tparts[3] = submatch[2] // line\n\t\t\t\t\tparts[4] = submatch[3] // column\n\t\t\t\t}\n\t\t\t\telement = {\n\t\t\t\t\targs: isNative ? [parts[2]] : [],\n\t\t\t\t\tcolumn: parts[4] ? +parts[4] : undefined,\n\t\t\t\t\tfunc: parts[1] || UNKNOWN_FUNCTION,\n\t\t\t\t\tline: parts[3] ? +parts[3] : undefined,\n\t\t\t\t\turl: !isNative ? parts[2] : undefined,\n\t\t\t\t}\n\t\t\t} else if (winjs.exec(lines[i])) {\n\t\t\t\tparts = winjs.exec(lines[i])\n\t\t\t\telement = {\n\t\t\t\t\targs: [],\n\t\t\t\t\tcolumn: parts[4] ? +parts[4] : undefined,\n\t\t\t\t\tfunc: parts[1] || UNKNOWN_FUNCTION,\n\t\t\t\t\tline: +parts[3],\n\t\t\t\t\turl: parts[2],\n\t\t\t\t}\n\t\t\t} else if (gecko.exec(lines[i])) {\n\t\t\t\tparts = gecko.exec(lines[i])\n\t\t\t\tisEval = parts[3] && parts[3].indexOf(' > eval') > -1\n\t\t\t\tsubmatch = geckoEval.exec(parts[3])\n\t\t\t\tif (isEval && submatch) {\n\t\t\t\t\t// throw out eval line/column and use top-most line number\n\t\t\t\t\tparts[3] = submatch[1]\n\t\t\t\t\tparts[4] = submatch[2]\n\t\t\t\t\tparts[5] = undefined // no column when eval\n\t\t\t\t} else if (i === 0 && !parts[5] && !isUndefined(ex.columnNumber)) {\n\t\t\t\t\t// FireFox uses this awesome columnNumber property for its top frame\n\t\t\t\t\t// Also note, Firefox's column number is 0-based and everything else expects 1-based,\n\t\t\t\t\t// so adding 1\n\t\t\t\t\t// NOTE: this hack doesn't work if top-most frame is eval\n\t\t\t\t\tstack[0].column = ex.columnNumber + 1\n\t\t\t\t}\n\t\t\t\telement = {\n\t\t\t\t\targs: parts[2] ? parts[2].split(',') : [],\n\t\t\t\t\tcolumn: parts[5] ? +parts[5] : undefined,\n\t\t\t\t\tfunc: parts[1] || UNKNOWN_FUNCTION,\n\t\t\t\t\tline: parts[4] ? +parts[4] : undefined,\n\t\t\t\t\turl: parts[3],\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tif (!element.func && element.line) {\n\t\t\t\telement.func = UNKNOWN_FUNCTION\n\t\t\t}\n\t\t\tstack.push(element)\n\t\t}\n\n\t\tif (!stack.length) {\n\t\t\treturn\n\t\t}\n\n\t\treturn {\n\t\t\tstack,\n\t\t\tmessage: extractMessage(ex),\n\t\t\tname: ex.name,\n\t\t}\n\t}\n\n\t/**\n\t * Computes stack trace information from the stacktrace property.\n\t * Opera 10+ uses this property.\n\t * @param {Error} ex\n\t * @return {?StackTrace} Stack trace information.\n\t * @memberof computeStackTrace\n\t */\n\tfunction computeStackTraceFromStacktraceProp(ex) {\n\t\t// Access and store the stacktrace property before doing ANYTHING\n\t\t// else to it because Opera is not very good at providing it\n\t\t// reliably in other circumstances.\n\t\tvar stacktrace = ex.stacktrace\n\t\tif (!stacktrace) {\n\t\t\treturn\n\t\t}\n\n\t\tvar opera10Regex = / line (\\d+).*script (?:in )?(\\S+)(?:: in function (\\S+))?$/i\n\t\t// tslint:disable-next-line max-line-length\n\t\tvar opera11Regex = / line (\\d+), column (\\d+)\\s*(?:in (?:<anonymous function: ([^>]+)>|([^\\)]+))\\((.*)\\))? in (.*):\\s*$/i\n\t\tvar lines = stacktrace.split('\\n')\n\t\tvar stack = []\n\t\tvar parts\n\n\t\tfor (var line = 0; line < lines.length; line += 2) {\n\t\t\tvar element\n\t\t\tif (opera10Regex.exec(lines[line])) {\n\t\t\t\tparts = opera10Regex.exec(lines[line])\n\t\t\t\telement = {\n\t\t\t\t\targs: [],\n\t\t\t\t\tcolumn: undefined,\n\t\t\t\t\tfunc: parts[3],\n\t\t\t\t\tline: +parts[1],\n\t\t\t\t\turl: parts[2],\n\t\t\t\t}\n\t\t\t} else if (opera11Regex.exec(lines[line])) {\n\t\t\t\tparts = opera11Regex.exec(lines[line])\n\t\t\t\telement = {\n\t\t\t\t\targs: parts[5] ? parts[5].split(',') : [],\n\t\t\t\t\tcolumn: +parts[2],\n\t\t\t\t\tfunc: parts[3] || parts[4],\n\t\t\t\t\tline: +parts[1],\n\t\t\t\t\turl: parts[6],\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (element) {\n\t\t\t\tif (!element.func && element.line) {\n\t\t\t\t\telement.func = UNKNOWN_FUNCTION\n\t\t\t\t}\n\t\t\t\telement.context = [lines[line + 1]]\n\n\t\t\t\tstack.push(element)\n\t\t\t}\n\t\t}\n\n\t\tif (!stack.length) {\n\t\t\treturn\n\t\t}\n\n\t\treturn {\n\t\t\tstack,\n\t\t\tmessage: extractMessage(ex),\n\t\t\tname: ex.name,\n\t\t}\n\t}\n\n\t/**\n\t * NOT TESTED.\n\t * Computes stack trace information from an error message that includes\n\t * the stack trace.\n\t * Opera 9 and earlier use this method if the option to show stack\n\t * traces is turned on in opera:config.\n\t * @param {Error} ex\n\t * @return {?StackTrace} Stack information.\n\t * @memberof computeStackTrace\n\t */\n\tfunction computeStackTraceFromOperaMultiLineMessage(ex) {\n\t\t// TODO: Clean this function up\n\t\t// Opera includes a stack trace into the exception message. An example is:\n\t\t//\n\t\t// Statement on line 3: Undefined variable: undefinedFunc\n\t\t// Backtrace:\n\t\t//   Line 3 of linked script file://localhost/Users/andreyvit/Projects/TraceKit/javascript-client/sample.js:\n\t\t//   In function zzz\n\t\t//         undefinedFunc(a);\n\t\t//   Line 7 of inline#1 script in file://localhost/Users/andreyvit/Projects/TraceKit/javascript-client/sample.html:\n\t\t//   In function yyy\n\t\t//           zzz(x, y, z);\n\t\t//   Line 3 of inline#1 script in file://localhost/Users/andreyvit/Projects/TraceKit/javascript-client/sample.html:\n\t\t//   In function xxx\n\t\t//           yyy(a, a, a);\n\t\t//   Line 1 of function script\n\t\t//     try { xxx('hi'); return false; } catch(ex) { report(ex); }\n\t\t//   ...\n\n\t\tvar lines = ex.message.split('\\n')\n\t\tif (lines.length < 4) {\n\t\t\treturn\n\t\t}\n\n\t\tvar lineRE1 = /^\\s*Line (\\d+) of linked script ((?:file|https?|blob)\\S+)(?:: in function (\\S+))?\\s*$/i\n\t\tvar lineRE2 = /^\\s*Line (\\d+) of inline#(\\d+) script in ((?:file|https?|blob)\\S+)(?:: in function (\\S+))?\\s*$/i\n\t\tvar lineRE3 = /^\\s*Line (\\d+) of function script\\s*$/i\n\t\tvar stack = []\n\t\tvar scripts =\n\t\t\twindow &&\n\t\t\twindow.document &&\n\t\t\twindow.document.getElementsByTagName('script')\n\t\tvar inlineScriptBlocks = []\n\t\tvar parts\n\n\t\tfor (var s in scripts) {\n\t\t\tif (has(scripts, s) && !scripts[s].src) {\n\t\t\t\tinlineScriptBlocks.push(scripts[s])\n\t\t\t}\n\t\t}\n\n\t\tfor (var line = 2; line < lines.length; line += 2) {\n\t\t\tvar item\n\t\t\tif (lineRE1.exec(lines[line])) {\n\t\t\t\tparts = lineRE1.exec(lines[line])\n\t\t\t\titem = {\n\t\t\t\t\targs: [],\n\t\t\t\t\tcolumn: undefined,\n\t\t\t\t\tfunc: parts[3],\n\t\t\t\t\tline: +parts[1],\n\t\t\t\t\turl: parts[2],\n\t\t\t\t}\n\t\t\t} else if (lineRE2.exec(lines[line])) {\n\t\t\t\tparts = lineRE2.exec(lines[line])\n\t\t\t\titem = {\n\t\t\t\t\targs: [],\n\t\t\t\t\tcolumn: undefined, // TODO: Check to see if inline#1 (+parts[2]) points to the script number or column number.\n\t\t\t\t\tfunc: parts[4],\n\t\t\t\t\tline: +parts[1],\n\t\t\t\t\turl: parts[3],\n\t\t\t\t}\n\t\t\t} else if (lineRE3.exec(lines[line])) {\n\t\t\t\tparts = lineRE3.exec(lines[line])\n\t\t\t\tvar url = window.location.href.replace(/#.*$/, '')\n\t\t\t\titem = {\n\t\t\t\t\turl,\n\t\t\t\t\targs: [],\n\t\t\t\t\tcolumn: undefined,\n\t\t\t\t\tfunc: '',\n\t\t\t\t\tline: +parts[1],\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (item) {\n\t\t\t\tif (!item.func) {\n\t\t\t\t\titem.func = UNKNOWN_FUNCTION\n\t\t\t\t}\n\t\t\t\titem.context = [lines[line + 1]]\n\t\t\t\tstack.push(item)\n\t\t\t}\n\t\t}\n\t\tif (!stack.length) {\n\t\t\treturn // could not parse multiline exception message as Opera stack trace\n\t\t}\n\n\t\treturn {\n\t\t\tstack,\n\t\t\tmessage: lines[0],\n\t\t\tname: ex.name,\n\t\t}\n\t}\n\n\t/**\n\t * Adds information about the first frame to incompvare stack traces.\n\t * Safari and IE require this to get compvare data on the first frame.\n\t * @param {StackTrace} stackInfo Stack trace information from\n\t * one of the compute* methods.\n\t * @param {string=} url The URL of the script that caused an error.\n\t * @param {(number|string)=} lineNo The line number of the script that\n\t * caused an error.\n\t * @param {string=} message The error generated by the browser, which\n\t * hopefully contains the name of the object that caused the error.\n\t * @return {boolean} Whether or not the stack information was\n\t * augmented.\n\t * @memberof computeStackTrace\n\t */\n\tfunction augmentStackTraceWithInitialElement(\n\t\tstackInfo,\n\t\turl,\n\t\tlineNo,\n\t\tmessage,\n\t) {\n\t\tvar initial = {\n\t\t\turl,\n\t\t\tline: lineNo ? +lineNo : undefined,\n\t\t}\n\n\t\tif (initial.url && initial.line) {\n\t\t\tstackInfo.incompvare = false\n\n\t\t\tvar stack = stackInfo.stack\n\t\t\tif (stack.length > 0) {\n\t\t\t\tif (stack[0].url === initial.url) {\n\t\t\t\t\tif (stack[0].line === initial.line) {\n\t\t\t\t\t\treturn false // already in stack trace\n\t\t\t\t\t}\n\t\t\t\t\tif (!stack[0].line && stack[0].func === initial.func) {\n\t\t\t\t\t\tstack[0].line = initial.line\n\t\t\t\t\t\tstack[0].context = initial.context\n\t\t\t\t\t\treturn false\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tstack.unshift(initial)\n\t\t\tstackInfo.partial = true\n\t\t\treturn true\n\t\t}\n\t\tstackInfo.incompvare = true\n\n\t\treturn false\n\t}\n\n\t/**\n\t * Computes stack trace information by walking the arguments.caller\n\t * chain at the time the exception occurred. This will cause earlier\n\t * frames to be missed but is the only way to get any stack trace in\n\t * Safari and IE. The top frame is restored by\n\t * {@link augmentStackTraceWithInitialElement}.\n\t * @param {Error} ex\n\t * @param {number} depth\n\t * @return {StackTrace} Stack trace information.\n\t * @memberof computeStackTrace\n\t */\n\tfunction computeStackTraceByWalkingCallerChain(ex, depth) {\n\t\tvar functionName = /function\\s+([_$a-zA-Z\\xA0-\\uFFFF][_$a-zA-Z0-9\\xA0-\\uFFFF]*)?\\s*\\(/i\n\t\tvar stack = []\n\t\tvar funcs = {}\n\t\tvar recursion = false\n\t\tvar parts\n\t\tvar item\n\n\t\tfor (\n\t\t\tvar curr = computeStackTraceByWalkingCallerChain.caller;\n\t\t\tcurr && !recursion;\n\t\t\tcurr = curr.caller\n\t\t) {\n\t\t\tif (curr === computeStackTrace || curr === report) {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\titem = {\n\t\t\t\targs: [],\n\t\t\t\tcolumn: undefined,\n\t\t\t\tfunc: UNKNOWN_FUNCTION,\n\t\t\t\tline: undefined,\n\t\t\t\turl: undefined,\n\t\t\t}\n\n\t\t\tparts = functionName.exec(curr.toString())\n\t\t\tif (curr.name) {\n\t\t\t\titem.func = curr.name\n\t\t\t} else if (parts) {\n\t\t\t\titem.func = parts[1]\n\t\t\t}\n\n\t\t\tif (typeof item.func === 'undefined') {\n\t\t\t\titem.func = parts\n\t\t\t\t\t? parts.input.substring(0, parts.input.indexOf('{'))\n\t\t\t\t\t: undefined\n\t\t\t}\n\n\t\t\tif (funcs[curr + '']) {\n\t\t\t\trecursion = true\n\t\t\t} else {\n\t\t\t\tfuncs[curr + ''] = true\n\t\t\t}\n\n\t\t\tstack.push(item)\n\t\t}\n\n\t\tif (depth) {\n\t\t\tstack.splice(0, depth)\n\t\t}\n\n\t\tvar result = {\n\t\t\tstack,\n\t\t\tmessage: ex.message,\n\t\t\tname: ex.name,\n\t\t}\n\t\taugmentStackTraceWithInitialElement(\n\t\t\tresult,\n\t\t\tex.sourceURL || ex.fileName,\n\t\t\tex.line || ex.lineNumber,\n\t\t\tex.message || ex.description,\n\t\t)\n\t\treturn result\n\t}\n\n\t/**\n\t * Computes a stack trace for an exception.\n\t * @param {Error} ex\n\t * @param {(string|number)=} depth\n\t * @memberof computeStackTrace\n\t */\n\tfunction doComputeStackTrace(ex, depth) {\n\t\tvar stack\n\t\tvar normalizedDepth = depth === undefined ? 0 : +depth\n\n\t\ttry {\n\t\t\t// This must be tried first because Opera 10 *destroys*\n\t\t\t// its stacktrace property if you try to access the stack\n\t\t\t// property first!!\n\t\t\tstack = computeStackTraceFromStacktraceProp(ex)\n\t\t\tif (stack) {\n\t\t\t\treturn stack\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif (debug) {\n\t\t\t\tthrow e\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tstack = computeStackTraceFromStackProp(ex)\n\t\t\tif (stack) {\n\t\t\t\treturn stack\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif (debug) {\n\t\t\t\tthrow e\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tstack = computeStackTraceFromOperaMultiLineMessage(ex)\n\t\t\tif (stack) {\n\t\t\t\treturn stack\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif (debug) {\n\t\t\t\tthrow e\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tstack = computeStackTraceByWalkingCallerChain(ex, normalizedDepth + 1)\n\t\t\tif (stack) {\n\t\t\t\treturn stack\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif (debug) {\n\t\t\t\tthrow e\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tmessage: extractMessage(ex),\n\t\t\tname: ex.name,\n\t\t\tstack: [],\n\t\t}\n\t}\n\n\t/**\n\t * Logs a stacktrace starting from the previous call and working down.\n\t * @param {(number|string)=} depth How many frames deep to trace.\n\t * @return {StackTrace} Stack trace information.\n\t * @memberof computeStackTrace\n\t */\n\tfunction computeStackTraceOfCaller(depth) {\n\t\tvar currentDepth = (depth === undefined ? 0 : +depth) + 1 // \"+ 1\" because \"ofCaller\" should drop one frame\n\t\ttry {\n\t\t\tthrow new Error()\n\t\t} catch (ex) {\n\t\t\treturn computeStackTrace(ex, currentDepth + 1)\n\t\t}\n\t}\n\n\tdoComputeStackTrace.augmentStackTraceWithInitialElement = augmentStackTraceWithInitialElement\n\tdoComputeStackTrace.computeStackTraceFromStackProp = computeStackTraceFromStackProp\n\tdoComputeStackTrace.ofCaller = computeStackTraceOfCaller\n\n\treturn doComputeStackTrace\n})()\nvar ERROR_TYPES_RE = /^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/\nfunction extractMessage(ex) {\n\tconst message = ex && ex.message\n\t// console.log('message',message)\n\tif (!message) {\n\t\treturn 'No error message'\n\t}\n\tif (message.error && typeof message.error.message === 'string') {\n\t\treturn message.error.message\n\t}\n\n\treturn message\n}\n","import { sdk } from './sdk'\nimport { now } from '../helper/utils'\nimport { RequestType } from '../helper/enums'\nvar xhrProxySingleton\nvar beforeSendCallbacks = []\nvar onRequestCompleteCallbacks = []\nvar originalXhrRequest\nexport function startXhrProxy() {\n\tif (!xhrProxySingleton) {\n\t\tproxyXhr()\n\t\txhrProxySingleton = {\n\t\t\tbeforeSend: function (callback) {\n\t\t\t\tbeforeSendCallbacks.push(callback)\n\t\t\t},\n\t\t\tonRequestComplete: function (callback) {\n\t\t\t\tonRequestCompleteCallbacks.push(callback)\n\t\t\t},\n\t\t}\n\t}\n\treturn xhrProxySingleton\n}\n\nexport function resetXhrProxy() {\n\tif (xhrProxySingleton) {\n\t\txhrProxySingleton = undefined\n\t\tbeforeSendCallbacks.splice(0, beforeSendCallbacks.length)\n\t\tonRequestCompleteCallbacks.splice(0, onRequestCompleteCallbacks.length)\n\t\tsdk.request = originalXhrRequest\n\t}\n}\n\nfunction proxyXhr() {\n\toriginalXhrRequest = sdk.request\n\tsdk.request = function () {\n\t\tvar _this = this\n\t\tvar dataflux_xhr = {\n\t\t\tmethod: arguments[0].method || 'GET',\n\t\t\tstartTime: 0,\n\t\t\turl: arguments[0].url,\n\t\t\ttype: RequestType.XHR,\n\t\t\tresponseType: arguments[0].responseType || 'text',\n\t\t}\n\t\tdataflux_xhr.startTime = now()\n\n\t\tvar originalSuccess = arguments[0].success\n\n\t\targuments[0].success = function () {\n\t\t\treportXhr(arguments[0])\n\n\t\t\tif (originalSuccess) {\n\t\t\t\toriginalSuccess.apply(_this, arguments)\n\t\t\t}\n\t\t}\n\t\tvar originalFail = arguments[0].fail\n\t\targuments[0].fail = function () {\n\t\t\treportXhr(arguments[0])\n\t\t\tif (originalFail) {\n\t\t\t\toriginalFail.apply(_this, arguments)\n\t\t\t}\n\t\t}\n\t\tvar hasBeenReported = false\n\t\tvar reportXhr = function (res) {\n\t\t\tif (hasBeenReported) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\thasBeenReported = true\n\t\t\tdataflux_xhr.duration = now() - dataflux_xhr.startTime\n\t\t\tdataflux_xhr.response = JSON.stringify(res.data)\n\t\t\tdataflux_xhr.header = res.header || {}\n\t\t\tdataflux_xhr.profile = res.profile\n\t\t\tdataflux_xhr.status = res.statusCode || res.status || 0\n\t\t\tonRequestCompleteCallbacks.forEach(function (callback) {\n\t\t\t\tcallback(dataflux_xhr)\n\t\t\t})\n\t\t}\n\t\tbeforeSendCallbacks.forEach(function (callback) {\n\t\t\tcallback(dataflux_xhr)\n\t\t})\n\t\treturn originalXhrRequest.apply(this, arguments)\n\t}\n}\n","export class Observable {\n\tconstructor() {\n\t\tthis.observers = []\n\t}\n\tsubscribe(f) {\n\t\tthis.observers.push(f)\n\t}\n\tnotify(data) {\n\t\tthis.observers.forEach(function (observer) {\n\t\t\tobserver(data)\n\t\t})\n\t}\n}\n","import { sdk } from './sdk'\nimport { now } from '../helper/utils'\nimport { RequestType } from '../helper/enums'\nvar downloadProxySingleton\nvar beforeSendCallbacks = []\nvar onRequestCompleteCallbacks = []\nvar originalDownloadRequest\nexport function startDownloadProxy() {\n\tif (!downloadProxySingleton) {\n\t\tproxyDownload()\n\t\tdownloadProxySingleton = {\n\t\t\tbeforeSend: function (callback) {\n\t\t\t\tbeforeSendCallbacks.push(callback)\n\t\t\t},\n\t\t\tonRequestComplete: function (callback) {\n\t\t\t\tonRequestCompleteCallbacks.push(callback)\n\t\t\t},\n\t\t}\n\t}\n\treturn downloadProxySingleton\n}\n\nexport function resetDownloadProxy() {\n\tif (downloadProxySingleton) {\n\t\tdownloadProxySingleton = undefined\n\t\tbeforeSendCallbacks.splice(0, beforeSendCallbacks.length)\n\t\tonRequestCompleteCallbacks.splice(0, onRequestCompleteCallbacks.length)\n\t\tsdk.downloadFile = originalDownloadRequest\n\t}\n}\n\nfunction proxyDownload() {\n\toriginalDownloadRequest = sdk.downloadFile\n\tsdk.downloadFile = function () {\n\t\tvar _this = this\n\t\tvar dataflux_xhr = {\n\t\t\tmethod: 'GET',\n\t\t\tstartTime: 0,\n\t\t\turl: arguments[0].url,\n\t\t\ttype: RequestType.DOWNLOAD,\n\t\t\tresponseType: 'file',\n\t\t}\n\t\tdataflux_xhr.startTime = now()\n\n\t\tvar originalSuccess = arguments[0].success\n\n\t\targuments[0].success = function () {\n\t\t\treportXhr(arguments[0])\n\n\t\t\tif (originalSuccess) {\n\t\t\t\toriginalSuccess.apply(_this, arguments)\n\t\t\t}\n\t\t}\n\t\tvar originalFail = arguments[0].fail\n\t\targuments[0].fail = function () {\n\t\t\treportXhr(arguments[0])\n\t\t\tif (originalFail) {\n\t\t\t\toriginalFail.apply(_this, arguments)\n\t\t\t}\n\t\t}\n\t\tvar hasBeenReported = false\n\t\tvar reportXhr = function (res) {\n\t\t\tif (hasBeenReported) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\thasBeenReported = true\n\t\t\tdataflux_xhr.duration = now() - dataflux_xhr.startTime\n\t\t\tdataflux_xhr.response = JSON.stringify({\n\t\t\t\tfilePath: res.filePath,\n\t\t\t\ttempFilePath: res.tempFilePath,\n\t\t\t})\n\t\t\tdataflux_xhr.header = res.header || {}\n\t\t\tdataflux_xhr.profile = res.profile\n\t\t\tdataflux_xhr.status = res.statusCode || res.status || 0\n\t\t\tonRequestCompleteCallbacks.forEach(function (callback) {\n\t\t\t\tcallback(dataflux_xhr)\n\t\t\t})\n\t\t}\n\t\tbeforeSendCallbacks.forEach(function (callback) {\n\t\t\tcallback(dataflux_xhr)\n\t\t})\n\t\treturn originalDownloadRequest.apply(this, arguments)\n\t}\n}\n","import { toArray, now } from '../helper/utils'\nimport { ONE_MINUTE, RequestType } from '../helper/enums'\nimport {\n\tErrorSource,\n\tformatUnknownError,\n\ttoStackTraceString,\n} from './errorTools'\nimport { computeStackTrace, report } from '../helper/tracekit'\nimport { Observable } from './observable'\nimport { isIntakeRequest } from './configuration'\nimport { resetXhrProxy, startXhrProxy } from './xhrProxy'\nimport { resetDownloadProxy, startDownloadProxy } from './downloadProxy'\nvar originalConsoleError\n\nexport function startConsoleTracking(errorObservable) {\n\toriginalConsoleError = console.error\n\tconsole.error = function () {\n\t\toriginalConsoleError.apply(console, arguments)\n\t\tvar args = toArray(arguments)\n\t\tvar message = []\n\t\targs.concat(['console error:']).forEach(function (para) {\n\t\t\tmessage.push(formatConsoleParameters(para))\n\t\t})\n\n\t\terrorObservable.notify({\n\t\t\tmessage: message.join(' '),\n\t\t\tsource: ErrorSource.CONSOLE,\n\t\t\tstartTime: now(),\n\t\t})\n\t}\n}\n\nexport function stopConsoleTracking() {\n\tconsole.error = originalConsoleError\n}\n\nfunction formatConsoleParameters(param) {\n\tif (typeof param === 'string') {\n\t\treturn param\n\t}\n\tif (param instanceof Error) {\n\t\treturn toStackTraceString(computeStackTrace(param))\n\t}\n\treturn JSON.stringify(param, undefined, 2)\n}\nexport function filterErrors(configuration, errorObservable) {\n\tvar errorCount = 0\n\tvar filteredErrorObservable = new Observable()\n\terrorObservable.subscribe(function (error) {\n\t\tif (errorCount < configuration.maxErrorsByMinute) {\n\t\t\terrorCount += 1\n\t\t\tfilteredErrorObservable.notify(error)\n\t\t} else if (errorCount === configuration.maxErrorsByMinute) {\n\t\t\terrorCount += 1\n\t\t\tfilteredErrorObservable.notify({\n\t\t\t\tmessage:\n\t\t\t\t\t'Reached max number of errors by minute: ' +\n\t\t\t\t\tconfiguration.maxErrorsByMinute,\n\t\t\t\tsource: ErrorSource.AGENT,\n\t\t\t\tstartTime: now(),\n\t\t\t})\n\t\t}\n\t})\n\tsetInterval(function () {\n\t\terrorCount = 0\n\t}, ONE_MINUTE)\n\treturn filteredErrorObservable\n}\nvar traceKitReportHandler\n\nexport function startRuntimeErrorTracking(errorObservable) {\n\ttraceKitReportHandler = function (stackTrace, _, errorObject) {\n\t\tvar error = formatUnknownError(stackTrace, errorObject, 'Uncaught')\n\t\terrorObservable.notify({\n\t\t\tmessage: error.message,\n\t\t\tstack: error.stack,\n\t\t\ttype: error.type,\n\t\t\tsource: ErrorSource.SOURCE,\n\t\t\tstartTime: now(),\n\t\t})\n\t}\n\treport.subscribe(traceKitReportHandler)\n}\n\nexport function stopRuntimeErrorTracking() {\n\treport.unsubscribe(traceKitReportHandler)\n}\nvar filteredErrorsObservable\n\nexport function startAutomaticErrorCollection(configuration) {\n\tif (!filteredErrorsObservable) {\n\t\tvar errorObservable = new Observable()\n\t\ttrackNetworkError(configuration, errorObservable)\n\t\tstartConsoleTracking(errorObservable)\n\t\tstartRuntimeErrorTracking(errorObservable)\n\t\tfilteredErrorsObservable = filterErrors(configuration, errorObservable)\n\t}\n\treturn filteredErrorsObservable\n}\n\nexport function trackNetworkError(configuration, errorObservable) {\n\tstartXhrProxy().onRequestComplete(function (context) {\n\t\treturn handleCompleteRequest(context.type, context)\n\t})\n\tstartDownloadProxy().onRequestComplete(function (context) {\n\t\treturn handleCompleteRequest(context.type, context)\n\t})\n\n\tfunction handleCompleteRequest(type, request) {\n\t\tif (\n\t\t\t!isIntakeRequest(request.url, configuration) &&\n\t\t\t(isRejected(request) || isServerError(request))\n\t\t) {\n\t\t\terrorObservable.notify({\n\t\t\t\tmessage: format(type) + 'error' + request.method + ' ' + request.url,\n\t\t\t\tresource: {\n\t\t\t\t\tmethod: request.method,\n\t\t\t\t\tstatusCode: request.status,\n\t\t\t\t\turl: request.url,\n\t\t\t\t},\n\t\t\t\ttype: ErrorSource.NETWORK,\n\t\t\t\tsource: ErrorSource.NETWORK,\n\t\t\t\tstack:\n\t\t\t\t\ttruncateResponse(request.response, configuration) || 'Failed to load',\n\t\t\t\tstartTime: request.startTime,\n\t\t\t})\n\t\t}\n\t}\n\n\treturn {\n\t\tstop: function () {\n\t\t\tresetXhrProxy()\n\t\t\tresetDownloadProxy()\n\t\t},\n\t}\n}\nfunction isRejected(request) {\n\treturn request.status === 0 && request.responseType !== 'opaque'\n}\n\nfunction isServerError(request) {\n\treturn request.status >= 500\n}\n\nfunction truncateResponse(response, configuration) {\n\tif (\n\t\tresponse &&\n\t\tresponse.length > configuration.requestErrorResponseLengthLimit\n\t) {\n\t\treturn (\n\t\t\tresponse.substring(0, configuration.requestErrorResponseLengthLimit) +\n\t\t\t'...'\n\t\t)\n\t}\n\treturn response\n}\n\nfunction format(type) {\n\tif (RequestType.XHR === type) {\n\t\treturn 'XHR'\n\t}\n\treturn RequestType.DOWNLOAD\n}\n","import { startAutomaticErrorCollection } from '../../core/errorCollection'\nimport { RumEventType } from '../../helper/enums'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\nimport {\n\turlParse,\n\treplaceNumberCharByPath,\n\tgetStatusGroup,\n} from '../../helper/utils'\nexport function startErrorCollection(lifeCycle, configuration) {\n\treturn doStartErrorCollection(\n\t\tlifeCycle,\n\t\tconfiguration,\n\t\tstartAutomaticErrorCollection(configuration),\n\t)\n}\n\nexport function doStartErrorCollection(lifeCycle, configuration, observable) {\n\tobservable.subscribe(function (error) {\n\t\tlifeCycle.notify(\n\t\t\tLifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n\t\t\tprocessError(error),\n\t\t)\n\t})\n}\n\nfunction processError(error) {\n\tvar resource = error.resource\n\tif (resource) {\n\t\tvar urlObj = urlParse(error.resource.url).getParse()\n\t\tresource = {\n\t\t\tmethod: error.resource.method,\n\t\t\tstatus: error.resource.statusCode,\n\t\t\tstatusGroup: getStatusGroup(error.resource.statusCode),\n\t\t\turl: error.resource.url,\n\t\t\turlHost: urlObj.Host,\n\t\t\turlPath: urlObj.Path,\n\t\t\turlPathGroup: replaceNumberCharByPath(urlObj.Path),\n\t\t}\n\t}\n\tvar rawRumEvent = {\n\t\tdate: error.startTime,\n\t\terror: {\n\t\t\tmessage: error.message,\n\t\t\tresource: resource,\n\t\t\tsource: error.source,\n\t\t\tstack: error.stack,\n\t\t\ttype: error.type,\n\t\t\tstarttime: error.startTime,\n\t\t},\n\t\ttype: RumEventType.ERROR,\n\t}\n\treturn {\n\t\trawRumEvent: rawRumEvent,\n\t\tstartTime: error.startTime,\n\t}\n}\n","import { sdk } from '../core/sdk'\nimport { UUID } from '../helper/utils'\nimport { CLIENT_ID_TOKEN } from '../helper/enums'\nclass BaseInfo {\n\tconstructor() {\n\t\tthis.sessionId = UUID()\n\t\tthis.getDeviceInfo()\n\t\tthis.getNetWork()\n\t}\n\tgetDeviceInfo() {\n\t\ttry {\n\t\t\tconst deviceInfo = sdk.getSystemInfoSync()\n\t\t\tvar osInfo = deviceInfo.system.split(' ')\n\t\t\tvar osVersion = osInfo.length > 1 && osInfo[1]\n\t\t\tvar osVersionMajor =\n\t\t\t\tosVersion.split('.').length && osVersion.split('.')[0]\n\t\t\tvar deviceUUid = ''\n\t\t\tif (deviceInfo.host) {\n\t\t\t\tdeviceUUid = deviceInfo.host.appId\n\t\t\t}\n\t\t\tthis.deviceInfo = {\n\t\t\t\tscreenSize: `${deviceInfo.screenWidth}*${deviceInfo.screenHeight} `,\n\t\t\t\tplatform: deviceInfo.platform,\n\t\t\t\tplatformVersion: deviceInfo.version,\n\t\t\t\tosVersion: osVersion,\n\t\t\t\tosVersionMajor: osVersionMajor,\n\t\t\t\tos: osInfo.length > 1 && osInfo[0],\n\t\t\t\tbrand: deviceInfo.brand,\n\t\t\t\tmodel: deviceInfo.model,\n\t\t\t\tframeworkVersion: deviceInfo.SDKVersion,\n\t\t\t\tpixelRatio: deviceInfo.pixelRatio,\n\t\t\t\tdeviceUuid: deviceUUid,\n\t\t\t}\n\t\t} catch (e) {}\n\t}\n\tgetClientID() {\n\t\tvar clienetId = sdk.getStorageSync(CLIENT_ID_TOKEN)\n\t\tif (!clienetId) {\n\t\t\tclienetId = UUID()\n\t\t\tsdk.setStorageSync(CLIENT_ID_TOKEN, clienetId)\n\t\t}\n\t\treturn clienetId\n\t}\n\tgetNetWork() {\n\t\tsdk.getNetworkType({\n\t\t\tsuccess: (e) => {\n\t\t\t\tthis.deviceInfo.network = e.networkType ? e.networkType : 'unknown'\n\t\t\t},\n\t\t})\n\t\tsdk.onNetworkStatusChange((e) => {\n\t\t\tthis.deviceInfo.network = e.networkType ? e.networkType : 'unknown'\n\t\t})\n\t}\n\tgetSessionId() {\n\t\treturn this.sessionId\n\t}\n}\n\nexport default new BaseInfo()\n","import { extend2Lev, withSnakeCaseKeys, performDraw } from '../helper/utils'\nimport { LifeCycleEventType } from '../core/lifeCycle'\nimport baseInfo from '../core/baseInfo'\nfunction isTracked(configuration) {\n\treturn performDraw(configuration.sampleRate)\n}\nexport function startRumAssembly(\n\tapplicationId,\n\tconfiguration,\n\tlifeCycle,\n\tparentContexts,\n) {\n\tlifeCycle.subscribe(\n\t\tLifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n\t\tfunction (data) {\n\t\t\tvar startTime = data.startTime\n\t\t\tvar rawRumEvent = data.rawRumEvent\n\t\t\tvar viewContext = parentContexts.findView(startTime)\n\t\t\t// console.log(\n\t\t\t// \tviewContext,\n\t\t\t// \tviewContext && viewContext.page && viewContext.page.route,\n\t\t\t// \t'viewContent====',\n\t\t\t// )\n\t\t\tif (rawRumEvent.type === 'view') {\n\t\t\t\t// console.log(\n\t\t\t\t// \tviewContext,\n\t\t\t\t// \tviewContext.page && viewContext.page.route,\n\t\t\t\t// \t'viewContextviewContext====',\n\t\t\t\t// )\n\t\t\t}\n\n\t\t\tvar deviceContext = {\n\t\t\t\tdevice: baseInfo.deviceInfo,\n\t\t\t}\n\t\t\tif (\n\t\t\t\tisTracked(configuration) &&\n\t\t\t\t(viewContext || rawRumEvent.type === 'app')\n\t\t\t) {\n\t\t\t\tvar actionContext = parentContexts.findAction(startTime)\n\t\t\t\tvar rumContext = {\n\t\t\t\t\t_dd: {\n\t\t\t\t\t\tsdkName: configuration.sdkName,\n\t\t\t\t\t\tsdkVersion: configuration.sdkVersion,\n\t\t\t\t\t\tenv: configuration.env,\n\t\t\t\t\t\tversion: configuration.version,\n\t\t\t\t\t},\n\t\t\t\t\ttags: configuration.tags,\n\t\t\t\t\tapplication: {\n\t\t\t\t\t\tid: applicationId,\n\t\t\t\t\t},\n\t\t\t\t\tdevice: {},\n\t\t\t\t\tdate: new Date().getTime(),\n\t\t\t\t\tsession: {\n\t\t\t\t\t\tid: baseInfo.getSessionId(),\n\t\t\t\t\t},\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tuser_id: configuration.user_id || baseInfo.getClientID(),\n\t\t\t\t\t\tis_signin: configuration.user_id ? 'T' : 'F',\n\t\t\t\t\t},\n\t\t\t\t}\n\n\t\t\t\tvar rumEvent = extend2Lev(\n\t\t\t\t\trumContext,\n\t\t\t\t\tdeviceContext,\n\t\t\t\t\tviewContext,\n\t\t\t\t\tactionContext,\n\t\t\t\t\trawRumEvent,\n\t\t\t\t)\n\n\t\t\t\tvar serverRumEvent = withSnakeCaseKeys(rumEvent)\n\t\t\t\t// if (\n\t\t\t\t// \tserverRumEvent.type === 'view' ||\n\t\t\t\t// \tserverRumEvent.type === 'action'\n\t\t\t\t// ) {\n\t\t\t\t// \tconsole.log(serverRumEvent, 'serverRumEvent')\n\t\t\t\t// }\n\n\t\t\t\tlifeCycle.notify(LifeCycleEventType.RUM_EVENT_COLLECTED, serverRumEvent)\n\t\t\t}\n\t\t},\n\t)\n}\n","import { ONE_MINUTE, ONE_HOUR } from '../helper/enums'\nimport { each, now } from '../helper/utils'\nimport { LifeCycleEventType } from '../core/lifeCycle'\nexport var VIEW_CONTEXT_TIME_OUT_DELAY = 4 * ONE_HOUR\nexport var CLEAR_OLD_CONTEXTS_INTERVAL = ONE_MINUTE\n\nexport function startParentContexts(lifeCycle) {\n\tvar currentView\n\tvar currentAction\n\tvar previousViews = []\n\tvar previousActions = []\n\tlifeCycle.subscribe(\n\t\tLifeCycleEventType.VIEW_CREATED,\n\t\tfunction (currentContext) {\n\t\t\tcurrentView = currentContext\n\t\t},\n\t)\n\n\tlifeCycle.subscribe(\n\t\tLifeCycleEventType.VIEW_UPDATED,\n\t\tfunction (currentContext) {\n\t\t\t// A view can be updated after its end.  We have to ensure that the view being updated is the\n\t\t\t// most recently created.\n\t\t\tif (currentView && currentView.id === currentContext.id) {\n\t\t\t\tcurrentView = currentContext\n\t\t\t}\n\t\t},\n\t)\n\tlifeCycle.subscribe(LifeCycleEventType.VIEW_ENDED, function (data) {\n\t\tif (currentView) {\n\t\t\tpreviousViews.unshift({\n\t\t\t\tendTime: data.endClocks,\n\t\t\t\tcontext: buildCurrentViewContext(),\n\t\t\t\tstartTime: currentView.startTime,\n\t\t\t})\n\t\t\tcurrentView = undefined\n\t\t}\n\t})\n\tlifeCycle.subscribe(\n\t\tLifeCycleEventType.AUTO_ACTION_CREATED,\n\t\tfunction (currentContext) {\n\t\t\tcurrentAction = currentContext\n\t\t},\n\t)\n\n\tlifeCycle.subscribe(\n\t\tLifeCycleEventType.AUTO_ACTION_COMPLETED,\n\t\tfunction (action) {\n\t\t\tif (currentAction) {\n\t\t\t\tpreviousActions.unshift({\n\t\t\t\t\tcontext: buildCurrentActionContext(),\n\t\t\t\t\tendTime: currentAction.startClocks + action.duration,\n\t\t\t\t\tstartTime: currentAction.startClocks,\n\t\t\t\t})\n\t\t\t}\n\t\t\tcurrentAction = undefined\n\t\t},\n\t)\n\n\tlifeCycle.subscribe(LifeCycleEventType.AUTO_ACTION_DISCARDED, function () {\n\t\tcurrentAction = undefined\n\t})\n\tlifeCycle.subscribe(LifeCycleEventType.SESSION_RENEWED, function () {\n\t\tpreviousViews = []\n\t\tpreviousActions = []\n\t\tcurrentView = undefined\n\t\tcurrentAction = undefined\n\t})\n\tvar clearOldContextsInterval = setInterval(function () {\n\t\tclearOldContexts(previousViews, VIEW_CONTEXT_TIME_OUT_DELAY)\n\t}, CLEAR_OLD_CONTEXTS_INTERVAL)\n\n\tfunction clearOldContexts(previousContexts, timeOutDelay) {\n\t\tvar oldTimeThreshold = now() - timeOutDelay\n\t\twhile (\n\t\t\tpreviousContexts.length > 0 &&\n\t\t\tpreviousContexts[previousContexts.length - 1].startTime < oldTimeThreshold\n\t\t) {\n\t\t\tpreviousContexts.pop()\n\t\t}\n\t}\n\tfunction buildCurrentActionContext() {\n\t\treturn { userAction: { id: currentAction.id } }\n\t}\n\tfunction buildCurrentViewContext() {\n\t\treturn {\n\t\t\tpage: {\n\t\t\t\tid: currentView.id,\n\t\t\t\treferer:\n\t\t\t\t\t(previousViews.length &&\n\t\t\t\t\t\tpreviousViews[previousViews.length - 1].context.page.route) ||\n\t\t\t\t\tundefined,\n\t\t\t\troute: currentView.route,\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction findContext(\n\t\tbuildContext,\n\t\tpreviousContexts,\n\t\tcurrentContext,\n\t\tstartTime,\n\t) {\n\t\tif (startTime === undefined) {\n\t\t\treturn currentContext ? buildContext() : undefined\n\t\t}\n\t\tif (currentContext && startTime >= currentContext.startTime) {\n\t\t\treturn buildContext()\n\t\t}\n\t\tvar flag = undefined\n\t\teach(previousContexts, function (previousContext) {\n\t\t\tif (startTime > previousContext.endTime) {\n\t\t\t\treturn false\n\t\t\t}\n\t\t\tif (startTime >= previousContext.startTime) {\n\t\t\t\tflag = previousContext.context\n\t\t\t\treturn false\n\t\t\t}\n\t\t})\n\n\t\treturn flag\n\t}\n\n\tvar parentContexts = {\n\t\tfindView: function (startTime) {\n\t\t\treturn findContext(\n\t\t\t\tbuildCurrentViewContext,\n\t\t\t\tpreviousViews,\n\t\t\t\tcurrentView,\n\t\t\t\tstartTime,\n\t\t\t)\n\t\t},\n\t\tfindAction: function (startTime) {\n\t\t\treturn findContext(\n\t\t\t\tbuildCurrentActionContext,\n\t\t\t\tpreviousActions,\n\t\t\t\tcurrentAction,\n\t\t\t\tstartTime,\n\t\t\t)\n\t\t},\n\n\t\tstop: function () {\n\t\t\tclearInterval(clearOldContextsInterval)\n\t\t},\n\t}\n\treturn parentContexts\n}\n","import { RumEventType } from '../helper/enums'\n// 需要用双引号将字符串类型的field value括起来， 这里有数组标示[string, path]\nexport var commonTags = {\n\tsdk_name: '_dd.sdk_name',\n\tsdk_version: '_dd.sdk_version',\n\tapp_id: 'application.id',\n\tenv: '_dd.env',\n\tversion: '_dd.version',\n\tuserid: 'user.user_id',\n\tsession_id: 'session.id',\n\tis_signin: 'user.is_signin',\n\tdevice: 'device.brand',\n\tmodel: 'device.model',\n\tdevice_uuid: 'device.device_uuid',\n\tos: 'device.os',\n\tos_version: 'device.os_version',\n\tos_version_major: 'device.os_version_major',\n\tscreen_size: 'device.screen_size',\n\tnetwork_type: 'device.network_type',\n\tplatform: 'device.platform',\n\tplatform_version: 'device.platform_version',\n\tapp_framework_version: 'device.framework_version',\n\tview_id: 'page.id',\n\tview_name: 'page.route',\n\tview_referer: 'page.referer',\n}\nexport var dataMap = {\n\tview: {\n\t\ttype: RumEventType.VIEW,\n\t\ttags: {\n\t\t\tview_apdex_level: 'page.apdex_level',\n\t\t\tis_active: 'page.is_active',\n\t\t},\n\t\tfields: {\n\t\t\tpage_fmp: 'page.fmp',\n\t\t\tfirst_paint_time: 'page.fpt',\n\t\t\tloading_time: 'page.loading_time',\n\t\t\tonload_to_onshow: 'page.onload2onshow',\n\t\t\tonshow_to_onready: 'page.onshow2onready',\n\t\t\ttime_spent: 'page.time_spent',\n\t\t\tview_error_count: 'page.error.count',\n\t\t\tview_resource_count: 'page.error.count',\n\t\t\tview_long_task_count: 'page.long_task.count',\n\t\t\tview_action_count: 'page.action.count',\n\t\t\tview_setdata_count: 'page.setdata.count',\n\t\t},\n\t},\n\tresource: {\n\t\ttype: RumEventType.RESOURCE,\n\t\ttags: {\n\t\t\tresource_type: 'resource.type',\n\t\t\tresource_status: 'resource.status',\n\t\t\tresource_status_group: 'resource.status_group',\n\t\t\tresource_method: 'resource.method',\n\t\t\tresource_url: 'resource.url',\n\t\t\tresource_url_host: 'resource.url_host',\n\t\t\tresource_url_path: 'resource.url_path',\n\t\t\tresource_url_path_group: 'resource.url_path_group',\n\t\t\tresource_url_query: 'resource.url_query',\n\t\t},\n\t\tfields: {\n\t\t\tresource_size: 'resource.size',\n\t\t\tresource_load: 'resource.load',\n\t\t\tresource_dns: 'resource.dns',\n\t\t\tresource_tcp: 'resource.tcp',\n\t\t\tresource_ssl: 'resource.ssl',\n\t\t\tresource_ttfb: 'resource.ttfb',\n\t\t\tresource_trans: 'resource.trans',\n\t\t\tresource_first_byte: 'resource.firstbyte',\n\t\t\tduration: 'resource.duration',\n\t\t},\n\t},\n\terror: {\n\t\ttype: RumEventType.ERROR,\n\t\ttags: {\n\t\t\terror_source: 'error.source',\n\t\t\terror_type: 'error.type',\n\t\t\tresource_url: 'error.resource.url',\n\t\t\tresource_url_host: 'error.resource.url_host',\n\t\t\tresource_url_path: 'error.resource.url_path',\n\t\t\tresource_url_path_group: 'error.resource.url_path_group',\n\t\t\tresource_status: 'error.resource.status',\n\t\t\tresource_status_group: 'error.resource.status_group',\n\t\t\tresource_method: 'error.resource.method',\n\t\t},\n\t\tfields: {\n\t\t\terror_message: ['string', 'error.message'],\n\t\t\terror_stack: ['string', 'error.stack'],\n\t\t},\n\t},\n\tlong_task: {\n\t\ttype: RumEventType.LONG_TASK,\n\t\ttags: {},\n\t\tfields: {\n\t\t\tduration: 'long_task.duration',\n\t\t},\n\t},\n\taction: {\n\t\ttype: RumEventType.ACTION,\n\t\ttags: {\n\t\t\taction_id: 'action.id',\n\t\t\taction_name: 'action.target.name',\n\t\t\taction_type: 'action.type',\n\t\t},\n\t\tfields: {\n\t\t\tduration: 'action.loading_time',\n\t\t},\n\t},\n}\n","import {\n\tfindByPath,\n\tescapeRowData,\n\tisNumber,\n\teach,\n\tisString,\n\tvalues,\n\textend,\n} from '../helper/utils'\nimport { sdk } from '../core/sdk'\nimport { LifeCycleEventType } from '../core/lifeCycle'\nimport { commonTags, dataMap } from './dataMap'\n// https://en.wikipedia.org/wiki/UTF-8\nvar HAS_MULTI_BYTES_CHARACTERS = /[^\\u0000-\\u007F]/\nfunction addBatchPrecision(url) {\n\tif (!url) return url\n\treturn url + (url.indexOf('?') === -1 ? '?' : '&') + 'precision=ms'\n}\nvar httpRequest = function (endpointUrl, bytesLimit) {\n\tthis.endpointUrl = endpointUrl\n\tthis.bytesLimit = bytesLimit\n}\nhttpRequest.prototype = {\n\tsend: function (data) {\n\t\tvar url = addBatchPrecision(this.endpointUrl)\n\t\tsdk.request({\n\t\t\tmethod: 'POST',\n\t\t\theader: {\n\t\t\t\t'content-type': 'text/plain;charset=UTF-8',\n\t\t\t},\n\t\t\turl,\n\t\t\tdata,\n\t\t})\n\t},\n}\n\nexport var HttpRequest = httpRequest\n\nfunction batch(\n\trequest,\n\tmaxSize,\n\tbytesLimit,\n\tmaxMessageSize,\n\tflushTimeout,\n\tlifeCycle,\n) {\n\tthis.request = request\n\tthis.maxSize = maxSize\n\tthis.bytesLimit = bytesLimit\n\tthis.maxMessageSize = maxMessageSize\n\tthis.flushTimeout = flushTimeout\n\tthis.lifeCycle = lifeCycle\n\tthis.flushOnVisibilityHidden()\n\tthis.flushPeriodically()\n}\nbatch.prototype = {\n\tpushOnlyBuffer: [],\n\tupsertBuffer: {},\n\tbufferBytesSize: 0,\n\tbufferMessageCount: 0,\n\tadd: function (message) {\n\t\tthis.addOrUpdate(message)\n\t},\n\n\tupsert: function (message, key) {\n\t\tthis.addOrUpdate(message, key)\n\t},\n\n\tflush: function () {\n\t\tif (this.bufferMessageCount !== 0) {\n\t\t\tvar messages = this.pushOnlyBuffer.concat(values(this.upsertBuffer))\n\t\t\tthis.request.send(messages.join('\\n'), this.bufferBytesSize)\n\t\t\tthis.pushOnlyBuffer = []\n\t\t\tthis.upsertBuffer = {}\n\t\t\tthis.bufferBytesSize = 0\n\t\t\tthis.bufferMessageCount = 0\n\t\t}\n\t},\n\n\tprocessSendData: function (message) {\n\t\t// var data = safeJSONParse(message)\n\t\tif (!message || !message.type) return ''\n\t\tvar rowStr = ''\n\t\tvar hasFileds = false\n\t\teach(dataMap, function (value, key) {\n\t\t\tif (value.type === message.type) {\n\t\t\t\trowStr += key + ','\n\t\t\t\tvar tagsStr = []\n\t\t\t\tvar tags = extend({}, commonTags, value.tags)\n\t\t\t\teach(tags, function (value_path, _key) {\n\t\t\t\t\tvar _value = findByPath(message, value_path)\n\t\t\t\t\tif (_value || isNumber(_value)) {\n\t\t\t\t\t\ttagsStr.push(escapeRowData(_key) + '=' + escapeRowData(_value))\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tif (message.tags.length) {\n\t\t\t\t\t// 自定义tag\n\t\t\t\t\teach(message.tags, function (_value, _key) {\n\t\t\t\t\t\tif (_value || isNumber(_value)) {\n\t\t\t\t\t\t\ttagsStr.push(escapeRowData(_key) + '=' + escapeRowData(_value))\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tvar fieldsStr = []\n\t\t\t\teach(value.fields, function (_value, _key) {\n\t\t\t\t\tif (Array.isArray(_value) && _value.length === 2) {\n\t\t\t\t\t\tvar type = _value[0],\n\t\t\t\t\t\t\tvalue_path = _value[1]\n\t\t\t\t\t\tvar _valueData = findByPath(message, value_path)\n\t\t\t\t\t\tif (_valueData || isNumber(_valueData)) {\n\t\t\t\t\t\t\t_valueData =\n\t\t\t\t\t\t\t\ttype === 'string'\n\t\t\t\t\t\t\t\t\t? '\"' +\n\t\t\t\t\t\t\t\t\t  String(_valueData)\n\t\t\t\t\t\t\t\t\t\t\t.replace(/[\\\\]*\"/g, '\"')\n\t\t\t\t\t\t\t\t\t\t\t.replace(/\"/g, '\\\\\"') +\n\t\t\t\t\t\t\t\t\t  '\"'\n\t\t\t\t\t\t\t\t\t: escapeRowData(_valueData)\n\t\t\t\t\t\t\tfieldsStr.push(escapeRowData(_key) + '=' + _valueData)\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (isString(_value)) {\n\t\t\t\t\t\tvar _valueData = findByPath(message, _value)\n\t\t\t\t\t\tif (_valueData || isNumber(_valueData)) {\n\t\t\t\t\t\t\t_valueData = escapeRowData(_valueData)\n\t\t\t\t\t\t\tfieldsStr.push(escapeRowData(_key) + '=' + _valueData)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tif (tagsStr.length) {\n\t\t\t\t\trowStr += tagsStr.join(',')\n\t\t\t\t}\n\t\t\t\tif (fieldsStr.length) {\n\t\t\t\t\trowStr += ' '\n\t\t\t\t\trowStr += fieldsStr.join(',')\n\t\t\t\t\thasFileds = true\n\t\t\t\t}\n\t\t\t\trowStr = rowStr + ' ' + message.date\n\t\t\t}\n\t\t})\n\t\treturn hasFileds ? rowStr : ''\n\t},\n\tsizeInBytes: function (candidate) {\n\t\t// Accurate byte size computations can degrade performances when there is a lot of events to process\n\t\tif (!HAS_MULTI_BYTES_CHARACTERS.test(candidate)) {\n\t\t\treturn candidate.length\n\t\t}\n\t\tvar total = 0,\n\t\t\tcharCode\n\t\t// utf-8编码\n\t\tfor (var i = 0, len = candidate.length; i < len; i++) {\n\t\t\tcharCode = candidate.charCodeAt(i)\n\t\t\tif (charCode <= 0x007f) {\n\t\t\t\ttotal += 1\n\t\t\t} else if (charCode <= 0x07ff) {\n\t\t\t\ttotal += 2\n\t\t\t} else if (charCode <= 0xffff) {\n\t\t\t\ttotal += 3\n\t\t\t} else {\n\t\t\t\ttotal += 4\n\t\t\t}\n\t\t}\n\t\treturn total\n\t},\n\n\taddOrUpdate: function (message, key) {\n\t\tvar process = this.process(message)\n\t\tif (!process.processedMessage || process.processedMessage === '') return\n\t\tif (process.messageBytesSize >= this.maxMessageSize) {\n\t\t\tconsole.warn(\n\t\t\t\t'Discarded a message whose size was bigger than the maximum allowed size' +\n\t\t\t\t\tthis.maxMessageSize +\n\t\t\t\t\t'KB.',\n\t\t\t)\n\t\t\treturn\n\t\t}\n\t\tif (this.hasMessageFor(key)) {\n\t\t\tthis.remove(key)\n\t\t}\n\t\tif (this.willReachedBytesLimitWith(process.messageBytesSize)) {\n\t\t\tthis.flush()\n\t\t}\n\t\tthis.push(process.processedMessage, process.messageBytesSize, key)\n\t\tif (this.isFull()) {\n\t\t\tthis.flush()\n\t\t}\n\t},\n\tprocess: function (message) {\n\t\tvar processedMessage = this.processSendData(message)\n\t\tvar messageBytesSize = this.sizeInBytes(processedMessage)\n\t\treturn {\n\t\t\tprocessedMessage: processedMessage,\n\t\t\tmessageBytesSize: messageBytesSize,\n\t\t}\n\t},\n\n\tpush: function (processedMessage, messageBytesSize, key) {\n\t\tif (this.bufferMessageCount > 0) {\n\t\t\t// \\n separator at serialization\n\t\t\tthis.bufferBytesSize += 1\n\t\t}\n\t\tif (key !== undefined) {\n\t\t\tthis.upsertBuffer[key] = processedMessage\n\t\t} else {\n\t\t\tthis.pushOnlyBuffer.push(processedMessage)\n\t\t}\n\t\tthis.bufferBytesSize += messageBytesSize\n\t\tthis.bufferMessageCount += 1\n\t},\n\n\tremove: function (key) {\n\t\tvar removedMessage = this.upsertBuffer[key]\n\t\tdelete this.upsertBuffer[key]\n\t\tvar messageBytesSize = this.sizeInBytes(removedMessage)\n\t\tthis.bufferBytesSize -= messageBytesSize\n\t\tthis.bufferMessageCount -= 1\n\t\tif (this.bufferMessageCount > 0) {\n\t\t\tthis.bufferBytesSize -= 1\n\t\t}\n\t},\n\n\thasMessageFor: function (key) {\n\t\treturn key !== undefined && this.upsertBuffer[key] !== undefined\n\t},\n\n\twillReachedBytesLimitWith: function (messageBytesSize) {\n\t\t// byte of the separator at the end of the message\n\t\treturn this.bufferBytesSize + messageBytesSize + 1 >= this.bytesLimit\n\t},\n\n\tisFull: function () {\n\t\treturn (\n\t\t\tthis.bufferMessageCount === this.maxSize ||\n\t\t\tthis.bufferBytesSize >= this.bytesLimit\n\t\t)\n\t},\n\n\tflushPeriodically: function () {\n\t\tvar _this = this\n\t\tsetTimeout(function () {\n\t\t\t_this.flush()\n\t\t\t_this.flushPeriodically()\n\t\t}, _this.flushTimeout)\n\t},\n\n\tflushOnVisibilityHidden: function () {\n\t\tvar _this = this\n\t\t/**\n\t\t * With sendBeacon, requests are guaranteed to be successfully sent during document unload\n\t\t */\n\t\t// @ts-ignore this function is not always defined\n\t\tthis.lifeCycle.subscribe(LifeCycleEventType.APP_HIDE, function () {\n\t\t\t_this.flush()\n\t\t})\n\t},\n}\n\nexport var Batch = batch\n","import { LifeCycleEventType } from '../../core/lifeCycle'\nimport { Batch, HttpRequest } from '../../core/transport'\nimport { RumEventType } from '../../helper/enums'\nexport function startRumBatch(configuration, lifeCycle) {\n\tvar batch = makeRumBatch(configuration, lifeCycle)\n\tlifeCycle.subscribe(\n\t\tLifeCycleEventType.RUM_EVENT_COLLECTED,\n\t\tfunction (serverRumEvent) {\n\t\t\tif (serverRumEvent.type === RumEventType.VIEW) {\n\t\t\t\tbatch.upsert(serverRumEvent, serverRumEvent.page.id)\n\t\t\t} else {\n\t\t\t\tbatch.add(serverRumEvent)\n\t\t\t}\n\t\t},\n\t)\n\treturn {\n\t\tstop: function () {\n\t\t\tbatch.stop()\n\t\t},\n\t}\n}\n\nfunction makeRumBatch(configuration, lifeCycle) {\n\tvar primaryBatch = createRumBatch(configuration.datakitUrl, lifeCycle)\n\n\tfunction createRumBatch(endpointUrl, lifeCycle) {\n\t\treturn new Batch(\n\t\t\tnew HttpRequest(endpointUrl, configuration.batchBytesLimit),\n\t\t\tconfiguration.maxBatchSize,\n\t\t\tconfiguration.batchBytesLimit,\n\t\t\tconfiguration.maxMessageSize,\n\t\t\tconfiguration.flushTimeout,\n\t\t\tlifeCycle,\n\t\t)\n\t}\n\n\tvar stopped = false\n\treturn {\n\t\tadd: function (message) {\n\t\t\tif (stopped) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tprimaryBatch.add(message)\n\t\t},\n\t\tstop: function () {\n\t\t\tstopped = true\n\t\t},\n\t\tupsert: function (message, key) {\n\t\t\tif (stopped) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tprimaryBatch.upsert(message, key)\n\t\t},\n\t}\n}\n","import { noop } from '../helper/utils'\nimport { RumEventType } from '../helper/enums'\nimport { LifeCycleEventType } from '../core/lifeCycle'\n\nexport function trackEventCounts(lifeCycle, callback) {\n\tif (typeof callback === 'undefined') {\n\t\tcallback = noop\n\t}\n\tvar eventCounts = {\n\t\terrorCount: 0,\n\t\tresourceCount: 0,\n\t\tlongTaskCount: 0,\n\t\tuserActionCount: 0,\n\t}\n\n\tvar subscription = lifeCycle.subscribe(\n\t\tLifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n\t\tfunction (data) {\n\t\t\tvar rawRumEvent = data.rawRumEvent\n\t\t\tswitch (rawRumEvent.type) {\n\t\t\t\tcase RumEventType.ERROR:\n\t\t\t\t\teventCounts.errorCount += 1\n\t\t\t\t\tcallback(eventCounts)\n\t\t\t\t\tbreak\n\t\t\t\tcase RumEventType.RESOURCE:\n\t\t\t\t\teventCounts.resourceCount += 1\n\t\t\t\t\tcallback(eventCounts)\n\t\t\t\t\tbreak\n\t\t\t\tcase RumEventType.ACTION:\n\t\t\t\t\teventCounts.userActionCount += 1\n\t\t\t\t\tcallback(eventCounts)\n\t\t\t\t\tbreak\n\t\t\t}\n\t\t},\n\t)\n\n\treturn {\n\t\tstop: function () {\n\t\t\tsubscription.unsubscribe()\n\t\t},\n\t\teventCounts: eventCounts,\n\t}\n}\n","import { rewritePage } from './index'\nimport { RumEventType } from '../../helper/enums'\nimport { msToNs } from '../../helper/utils'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\nexport function startViewCollection(lifeCycle, configuration) {\n\tlifeCycle.subscribe(LifeCycleEventType.VIEW_UPDATED, function (view) {\n\t\tlifeCycle.notify(\n\t\t\tLifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n\t\t\tprocessViewUpdate(view),\n\t\t)\n\t})\n\n\treturn rewritePage(configuration, lifeCycle)\n}\nfunction processViewUpdate(view) {\n\tvar apdexLevel\n\tif (view.fmp) {\n\t\tapdexLevel = parseInt(Number(view.fmp) / 1000)\n\t\tapdexLevel = apdexLevel > 9 ? 9 : apdexLevel\n\t}\n\tvar viewEvent = {\n\t\t_dd: {\n\t\t\tdocumentVersion: view.documentVersion,\n\t\t},\n\t\tdate: view.startTime,\n\t\ttype: RumEventType.VIEW,\n\t\tpage: {\n\t\t\taction: {\n\t\t\t\tcount: view.eventCounts.userActionCount,\n\t\t\t},\n\t\t\terror: {\n\t\t\t\tcount: view.eventCounts.errorCount,\n\t\t\t},\n\t\t\tsetdata: {\n\t\t\t\tcount: view.setdataCount,\n\t\t\t},\n\t\t\tsetdata_duration: msToNs(view.setdataDuration),\n\t\t\tloadingTime: msToNs(view.loadingTime),\n\t\t\tstayTime: msToNs(view.stayTime),\n\t\t\tonload2onshow: msToNs(view.onload2onshowTime),\n\t\t\tonshow2onready: msToNs(view.onshow2onready),\n\t\t\tfpt: msToNs(view.fpt),\n\t\t\tfmp: msToNs(view.fmp),\n\t\t\tisActive: view.isActive,\n\t\t\tapdexLevel,\n\t\t\t// longTask: {\n\t\t\t//   count: view.eventCounts.longTaskCount\n\t\t\t// },\n\t\t\tresource: {\n\t\t\t\tcount: view.eventCounts.resourceCount,\n\t\t\t},\n\t\t\ttimeSpent: msToNs(view.duration),\n\t\t},\n\t}\n\treturn {\n\t\trawRumEvent: viewEvent,\n\t\tstartTime: view.startTime,\n\t}\n}\n","import { extend, now, throttle, UUID, isNumber } from '../../helper/utils'\nimport { trackEventCounts } from '../trackEventCounts'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\n// 劫持原小程序App方法\nexport var THROTTLE_VIEW_UPDATE_PERIOD = 3000\n\nexport function rewritePage(configuration, lifeCycle) {\n\tconst originPage = Page\n\tconsole.log(originPage, 'originPage=====')\n\tPage = function (page) {\n\t\t// 合并方法，插入记录脚本\n\t\tvar currentView,\n\t\t\tstartTime = now()\n\t\tconsole\n\t\t\t.log(page, 'page======')\n\t\t\t[('onReady', 'onShow', 'onLoad', 'onUnload', 'onHide')].forEach(\n\t\t\t\t(methodName) => {\n\t\t\t\t\tconst userDefinedMethod = page[methodName]\n\t\t\t\t\tpage[methodName] = function () {\n\t\t\t\t\t\tconsole.log(methodName, 'methodName page')\n\t\t\t\t\t\tif (methodName === 'onShow' || methodName === 'onLoad') {\n\t\t\t\t\t\t\tif (typeof currentView === 'undefined') {\n\t\t\t\t\t\t\t\tconst activePage = getActivePage()\n\t\t\t\t\t\t\t\tcurrentView = newView(\n\t\t\t\t\t\t\t\t\tlifeCycle,\n\t\t\t\t\t\t\t\t\tactivePage && activePage.route,\n\t\t\t\t\t\t\t\t\tstartTime,\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcurrentView && currentView.setLoadEventEnd(methodName)\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t(methodName === 'onUnload' ||\n\t\t\t\t\t\t\t\tmethodName === 'onHide' ||\n\t\t\t\t\t\t\t\tmethodName === 'onShow') &&\n\t\t\t\t\t\t\tcurrentView\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tcurrentView.triggerUpdate()\n\t\t\t\t\t\t\tif (methodName === 'onUnload' || methodName === 'onHide') {\n\t\t\t\t\t\t\t\tcurrentView.end()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn userDefinedMethod && userDefinedMethod.apply(this, arguments)\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t)\n\t\treturn originPage(page)\n\t}\n}\nfunction newView(lifeCycle, route, startTime) {\n\tif (typeof startTime === 'undefined') {\n\t\tstartTime = now()\n\t}\n\tvar id = UUID()\n\tvar isActive = true\n\tvar eventCounts = {\n\t\terrorCount: 0,\n\t\tresourceCount: 0,\n\t\tuserActionCount: 0,\n\t}\n\tvar setdataCount = 0\n\n\tvar documentVersion = 0\n\tvar setdataDuration = 0\n\tvar loadingDuration = 0\n\tvar loadingTime\n\tvar showTime\n\tvar onload2onshowTime\n\tvar onshow2onready\n\tvar stayTime\n\tvar fpt, fmp\n\tlifeCycle.notify(LifeCycleEventType.VIEW_CREATED, {\n\t\tid,\n\t\tstartTime,\n\t\troute,\n\t})\n\tvar scheduleViewUpdate = throttle(\n\t\ttriggerViewUpdate,\n\t\tTHROTTLE_VIEW_UPDATE_PERIOD,\n\t\t{\n\t\t\tleading: false,\n\t\t},\n\t)\n\tvar cancelScheduleViewUpdate = scheduleViewUpdate.cancel\n\tvar _trackEventCounts = trackEventCounts(\n\t\tlifeCycle,\n\t\tfunction (newEventCounts) {\n\t\t\teventCounts = newEventCounts\n\t\t\tscheduleViewUpdate()\n\t\t},\n\t)\n\tvar stopEventCountsTracking = _trackEventCounts.stop\n\tvar _trackFptTime = trackFptTime(lifeCycle, function (duration) {\n\t\tfpt = duration\n\t\tscheduleViewUpdate()\n\t})\n\tvar stopFptTracking = _trackFptTime.stop\n\tvar _trackSetDataTime = trackSetDataTime(lifeCycle, function (duration) {\n\t\tif (isNumber(duration)) {\n\t\t\tsetdataDuration += duration\n\t\t\tsetdataCount++\n\t\t\tscheduleViewUpdate()\n\t\t}\n\t})\n\tvar stopSetDataTracking = _trackSetDataTime.stop\n\tvar _trackLoadingTime = trackLoadingTime(lifeCycle, function (duration) {\n\t\tif (isNumber(duration)) {\n\t\t\tloadingDuration = duration\n\t\t\tscheduleViewUpdate()\n\t\t}\n\t})\n\tvar stopLoadingTimeTracking = _trackLoadingTime.stop\n\n\tvar setLoadEventEnd = function (type) {\n\t\tif (type === 'onLoad') {\n\t\t\tloadingTime = now()\n\t\t} else if (type === 'onShow') {\n\t\t\tshowTime = now()\n\t\t\tif (\n\t\t\t\ttypeof onload2onshowTime === 'undefined' &&\n\t\t\t\ttypeof loadingTime !== 'undefined'\n\t\t\t) {\n\t\t\t\tonload2onshowTime = showTime - loadingTime\n\t\t\t}\n\t\t} else if (type === 'onReady') {\n\t\t\tif (\n\t\t\t\ttypeof onshow2onready === 'undefined' &&\n\t\t\t\ttypeof showTime !== 'undefined'\n\t\t\t) {\n\t\t\t\tonshow2onready = now() - showTime\n\t\t\t}\n\t\t\tif (typeof fmp === 'undefined') {\n\t\t\t\tfmp = now() - startTime // 从开发者角度看，小程序首屏渲染完成的标志是首页 Page.onReady 事件触发。\n\t\t\t}\n\t\t} else if (type === 'onHide' || type === 'onUnload') {\n\t\t\tif (typeof showTime !== 'undefined') {\n\t\t\t\tstayTime = now() - showTime\n\t\t\t}\n\t\t\tisActive = false\n\t\t}\n\t\ttriggerViewUpdate()\n\t}\n\tfunction triggerViewUpdate() {\n\t\tdocumentVersion += 1\n\t\tlifeCycle.notify(LifeCycleEventType.VIEW_UPDATED, {\n\t\t\tdocumentVersion: documentVersion,\n\t\t\teventCounts: eventCounts,\n\t\t\tid: id,\n\t\t\tloadingTime: loadingDuration,\n\t\t\tstayTime,\n\t\t\tonload2onshowTime,\n\t\t\tonshow2onready,\n\t\t\tsetdataDuration,\n\t\t\tsetdataCount,\n\t\t\tfmp,\n\t\t\tfpt,\n\t\t\tstartTime: startTime,\n\t\t\troute: route,\n\t\t\tduration: now() - startTime,\n\t\t\tisActive: isActive,\n\t\t})\n\t}\n\treturn {\n\t\tscheduleUpdate: scheduleViewUpdate,\n\t\tsetLoadEventEnd,\n\t\ttriggerUpdate: function () {\n\t\t\tcancelScheduleViewUpdate()\n\t\t\ttriggerViewUpdate()\n\t\t},\n\t\tend: function () {\n\t\t\tstopEventCountsTracking()\n\t\t\tstopFptTracking()\n\t\t\tcancelScheduleViewUpdate()\n\t\t\tstopSetDataTracking()\n\t\t\tstopLoadingTimeTracking()\n\t\t\tlifeCycle.notify(LifeCycleEventType.VIEW_ENDED, { endClocks: now() })\n\t\t},\n\t}\n}\nfunction trackFptTime(lifeCycle, callback) {\n\tvar subscribe = lifeCycle.subscribe(\n\t\tLifeCycleEventType.PERFORMANCE_ENTRY_COLLECTED,\n\t\tfunction (entitys) {\n\t\t\tconst firstRenderEntity = entitys.find(\n\t\t\t\t(entity) =>\n\t\t\t\t\tentity.entryType === 'render' && entity.name === 'firstRender',\n\t\t\t)\n\n\t\t\tif (typeof firstRenderEntity !== 'undefined') {\n\t\t\t\tcallback(firstRenderEntity.duration)\n\t\t\t}\n\t\t},\n\t)\n\treturn {\n\t\tstop: subscribe.unsubscribe,\n\t}\n}\nfunction trackLoadingTime(lifeCycle, callback) {\n\tvar subscribe = lifeCycle.subscribe(\n\t\tLifeCycleEventType.PERFORMANCE_ENTRY_COLLECTED,\n\t\tfunction (entitys) {\n\t\t\tconst navigationEnity = entitys.find(\n\t\t\t\t(entity) => entity.entryType === 'navigation',\n\t\t\t)\n\t\t\tif (typeof navigationEnity !== 'undefined') {\n\t\t\t\tcallback(navigationEnity.duration)\n\t\t\t}\n\t\t},\n\t)\n\treturn {\n\t\tstop: subscribe.unsubscribe,\n\t}\n}\nfunction trackSetDataTime(lifeCycle, callback) {\n\tvar subscribe = lifeCycle.subscribe(\n\t\tLifeCycleEventType.PAGE_SET_DATA_UPDATE,\n\t\tfunction (data) {\n\t\t\tif (!data) return\n\t\t\tcallback(data.updateEndTimestamp - data.pendingStartTimestamp)\n\t\t},\n\t)\n\treturn {\n\t\tstop: subscribe.unsubscribe,\n\t}\n}\nfunction getActivePage() {\n\tconst curPages = getCurrentPages()\n\tif (curPages.length) {\n\t\treturn curPages[curPages.length - 1]\n\t}\n\treturn {}\n}\n","import { msToNs, toArray, extend } from '../../helper/utils'\nimport { isIntakeRequest } from '../../core/configuration'\n\nfunction areInOrder() {\n\tvar numbers = toArray(arguments)\n\tfor (var i = 1; i < numbers.length; i += 1) {\n\t\tif (numbers[i - 1] > numbers[i]) {\n\t\t\treturn false\n\t\t}\n\t}\n\treturn true\n}\n\nexport function computePerformanceResourceDuration(entry) {\n\t// Safari duration is always 0 on timings blocked by cross origin policies.\n\tif (entry.startTime < entry.responseEnd) {\n\t\treturn msToNs(entry.responseEnd - entry.startTime)\n\t}\n}\n\n//  interface PerformanceResourceDetails {\n//   redirect?: PerformanceResourceDetailsElement\n//   dns?: PerformanceResourceDetailsElement\n//   connect?: PerformanceResourceDetailsElement\n//   ssl?: PerformanceResourceDetailsElement\n//   firstByte: PerformanceResourceDetailsElement\n//   download: PerformanceResourceDetailsElement\n//   fmp:\n// }\n// page_fmp\tfloat\t\t首屏时间(用于衡量用户什么时候看到页面的主要内容)，跟FCP的时长非常接近，这里我们就用FCP的时间作为首屏时间\tfirstPaintContentEnd - firstPaintContentStart\n// page_fpt\tfloat\t\t首次渲染时间，即白屏时间(从请求开始到浏览器开始解析第一批HTML文档字节的时间差。)\tresponseEnd - fetchStart\n// page_tti\tfloat\t\t首次可交互时间(浏览器完成所有HTML解析并且完成DOM构建，此时浏览器开始加载资源。)\tdomInteractive - fetchStart\n// page_firstbyte\tfloat\t\t首包时间\tresponseStart - domainLookupStart\n// page_dom_ready\tfloat\t\tDOM Ready时间(如果页面有同步执行的JS，则同步JS执行时间=ready-tti。)\tdomContentLoadEventEnd - fetchStart\n// page_load\tfloat\t\t页面完全加载时间(load=首次渲染时间+DOM解析耗时+同步JS执行+资源加载耗时。)\tloadEventStart - fetchStart\n// page_dns\tfloat\t\tdns解析时间\tdomainLookupEnd - domainLookupStart\n// page_tcp\tfloat\t\ttcp连接时间\tconnectEnd - connectStart\n// page_ssl\tfloat\t\tssl安全连接时间(仅适用于https)\tconnectEnd - secureConnectionStart\n// page_ttfb\tfloat\t\t请求响应耗时\tresponseStart - requestStart\n// page_trans\tfloat\t\t内容传输时间\tresponseEnd - responseStart\n// page_dom\tfloat\t\tDOM解析耗时\tdomInteractive - responseEnd\n// page_resource_load_time\tfloat\t\t资源加载时间\tloadEventStart - domContentLoadedEventEnd\n\n//  navigationStart：当前浏览器窗口的前一个网页关闭，发生unload事件时的Unix毫秒时间戳。如果没有前一个网页，则等于fetchStart属性。\n\n// ·   unloadEventStart：如果前一个网页与当前网页属于同一个域名，则返回前一个网页的unload事件发生时的Unix毫秒时间戳。如果没有前一个网页，或者之前的网页跳转不是在同一个域名内，则返回值为0。\n\n// ·   unloadEventEnd：如果前一个网页与当前网页属于同一个域名，则返回前一个网页unload事件的回调函数结束时的Unix毫秒时间戳。如果没有前一个网页，或者之前的网页跳转不是在同一个域名内，则返回值为0。\n\n// ·   redirectStart：返回第一个HTTP跳转开始时的Unix毫秒时间戳。如果没有跳转，或者不是同一个域名内部的跳转，则返回值为0。\n\n// ·   redirectEnd：返回最后一个HTTP跳转结束时（即跳转回应的最后一个字节接受完成时）的Unix毫秒时间戳。如果没有跳转，或者不是同一个域名内部的跳转，则返回值为0。\n\n// ·   fetchStart：返回浏览器准备使用HTTP请求读取文档时的Unix毫秒时间戳。该事件在网页查询本地缓存之前发生。\n\n// ·   domainLookupStart：返回域名查询开始时的Unix毫秒时间戳。如果使用持久连接，或者信息是从本地缓存获取的，则返回值等同于fetchStart属性的值。\n\n// ·   domainLookupEnd：返回域名查询结束时的Unix毫秒时间戳。如果使用持久连接，或者信息是从本地缓存获取的，则返回值等同于fetchStart属性的值。\n\n// ·   connectStart：返回HTTP请求开始向服务器发送时的Unix毫秒时间戳。如果使用持久连接（persistent connection），则返回值等同于fetchStart属性的值。\n\n// ·   connectEnd：返回浏览器与服务器之间的连接建立时的Unix毫秒时间戳。如果建立的是持久连接，则返回值等同于fetchStart属性的值。连接建立指的是所有握手和认证过程全部结束。\n\n// ·   secureConnectionStart：返回浏览器与服务器开始安全链接的握手时的Unix毫秒时间戳。如果当前网页不要求安全连接，则返回0。\n\n// ·   requestStart：返回浏览器向服务器发出HTTP请求时（或开始读取本地缓存时）的Unix毫秒时间戳。\n\n// ·   responseStart：返回浏览器从服务器收到（或从本地缓存读取）第一个字节时的Unix毫秒时间戳。\n\n// ·   responseEnd：返回浏览器从服务器收到（或从本地缓存读取）最后一个字节时（如果在此之前HTTP连接已经关闭，则返回关闭时）的Unix毫秒时间戳。\n\n// ·   domLoading：返回当前网页DOM结构开始解析时（即Document.readyState属性变为“loading”、相应的readystatechange事件触发时）的Unix毫秒时间戳。\n\n// ·   domInteractive：返回当前网页DOM结构结束解析、开始加载内嵌资源时（即Document.readyState属性变为“interactive”、相应的readystatechange事件触发时）的Unix毫秒时间戳。\n\n// ·   domContentLoadedEventStart：返回当前网页DOMContentLoaded事件发生时（即DOM结构解析完毕、所有脚本开始运行时）的Unix毫秒时间戳。\n\n// ·   domContentLoadedEventEnd：返回当前网页所有需要执行的脚本执行完成时的Unix毫秒时间戳。\n\n// ·   domComplete：返回当前网页DOM结构生成时（即Document.readyState属性变为“complete”，以及相应的readystatechange事件发生时）的Unix毫秒时间戳。\n\n// ·   loadEventStart：返回当前网页load事件的回调函数开始时的Unix毫秒时间戳。如果该事件还没有发生，返回0。\n\n// ·   loadEventEnd：返回当前网页load事件的回调函数运行结束时的Unix毫秒时间戳。如果该事件还没有发生，返回0\nexport function computePerformanceResourceDetails(entry) {\n\tvar validEntry = toValidEntry(entry)\n\n\tif (!validEntry) {\n\t\treturn undefined\n\t}\n\n\tvar startTime = validEntry.startTime,\n\t\tfetchStart = validEntry.fetchStart,\n\t\tredirectStart = validEntry.redirectStart,\n\t\tredirectEnd = validEntry.redirectEnd,\n\t\tdomainLookupStart =\n\t\t\tvalidEntry.domainLookupStart || validEntry.domainLookUpStart,\n\t\tdomainLookupEnd = validEntry.domainLookupEnd || validEntry.domainLookUpEnd,\n\t\tconnectStart = validEntry.connectStart,\n\t\tSSLconnectionStart = validEntry.SSLconnectionStart,\n\t\tSSLconnectionEnd = validEntry.SSLconnectionEnd,\n\t\tconnectEnd = validEntry.connectEnd,\n\t\trequestStart = validEntry.requestStart,\n\t\tresponseStart = validEntry.responseStart,\n\t\tresponseEnd = validEntry.responseEnd\n\tvar details = {\n\t\tfirstbyte: formatTiming(startTime, domainLookupStart, responseStart),\n\t\ttrans: formatTiming(startTime, responseStart, responseEnd),\n\t\tttfb: formatTiming(startTime, requestStart, responseStart),\n\t}\n\t// Make sure a connection occurred\n\tif (connectEnd !== fetchStart) {\n\t\tdetails.tcp = formatTiming(startTime, connectStart, connectEnd)\n\n\t\t// Make sure a secure connection occurred\n\t\tif (areInOrder(connectStart, SSLconnectionStart, SSLconnectionEnd)) {\n\t\t\tdetails.ssl = formatTiming(\n\t\t\t\tstartTime,\n\t\t\t\tSSLconnectionStart,\n\t\t\t\tSSLconnectionEnd,\n\t\t\t)\n\t\t}\n\t}\n\n\t// Make sure a domain lookup occurred\n\tif (domainLookupEnd !== fetchStart) {\n\t\tdetails.dns = formatTiming(startTime, domainLookupStart, domainLookupEnd)\n\t}\n\n\tif (hasRedirection(entry)) {\n\t\tdetails.redirect = formatTiming(startTime, redirectStart, redirectEnd)\n\t}\n\n\treturn details\n}\n\nexport function toValidEntry(entry) {\n\t// Ensure timings are in the right order. On top of filtering out potential invalid\n\t// RumPerformanceResourceTiming, it will ignore entries from requests where timings cannot be\n\t// collected, for example cross origin requests without a \"Timing-Allow-Origin\" header allowing\n\t// it.\n\t// page_fmp\tfloat\t\t首屏时间(用于衡量用户什么时候看到页面的主要内容)，跟FCP的时长非常接近，这里我们就用FCP的时间作为首屏时间\tfirstPaintContentEnd - firstPaintContentStart\n\t// page_fpt\tfloat\t\t首次渲染时间，即白屏时间(从请求开始到浏览器开始解析第一批HTML文档字节的时间差。)\tresponseEnd - fetchStart\n\t// page_tti\tfloat\t\t首次可交互时间(浏览器完成所有HTML解析并且完成DOM构建，此时浏览器开始加载资源。)\tdomInteractive - fetchStart\n\t// page_firstbyte\tfloat\t\t首包时间\tresponseStart - domainLookupStart\n\t// page_dom_ready\tfloat\t\tDOM Ready时间(如果页面有同步执行的JS，则同步JS执行时间=ready-tti。)\tdomContentLoadEventEnd - fetchStart\n\t// page_load\tfloat\t\t页面完全加载时间(load=首次渲染时间+DOM解析耗时+同步JS执行+资源加载耗时。)\tloadEventStart - fetchStart\n\t// page_dns\tfloat\t\tdns解析时间\tdomainLookupEnd - domainLookupStart\n\t// page_tcp\tfloat\t\ttcp连接时间\tconnectEnd - connectStart\n\t// page_ssl\tfloat\t\tssl安全连接时间(仅适用于https)\tconnectEnd - secureConnectionStart\n\t// page_ttfb\tfloat\t\t请求响应耗时\tresponseStart - requestStart\n\t// page_trans\tfloat\t\t内容传输时间\tresponseEnd - responseStart\n\t// page_dom\tfloat\t\tDOM解析耗时\tdomInteractive - responseEnd\n\t// page_resource_load_time\tfloat\t\t资源加载时间\tloadEventStart - domContentLoadedEventEnd\n\tif (\n\t\t!areInOrder(\n\t\t\tentry.startTime,\n\t\t\tentry.fetchStart,\n\t\t\tentry.domainLookupStart,\n\t\t\tentry.domainLookupEnd,\n\t\t\tentry.connectStart,\n\t\t\tentry.connectEnd,\n\t\t\tentry.requestStart,\n\t\t\tentry.responseStart,\n\t\t\tentry.responseEnd,\n\t\t)\n\t) {\n\t\treturn undefined\n\t}\n\n\tif (!hasRedirection(entry)) {\n\t\treturn entry\n\t}\n\n\tvar redirectStart = entry.redirectStart\n\tvar redirectEnd = entry.redirectEnd\n\t// Firefox doesn't provide redirect timings on cross origin requests.\n\t// Provide a default for those.\n\tif (redirectStart < entry.startTime) {\n\t\tredirectStart = entry.startTime\n\t}\n\tif (redirectEnd < entry.startTime) {\n\t\tredirectEnd = entry.fetchStart\n\t}\n\n\t// Make sure redirect timings are in order\n\tif (\n\t\t!areInOrder(entry.startTime, redirectStart, redirectEnd, entry.fetchStart)\n\t) {\n\t\treturn undefined\n\t}\n\treturn extend({}, entry, {\n\t\tredirectEnd: redirectEnd,\n\t\tredirectStart: redirectStart,\n\t})\n\t// return {\n\t//   ...entry,\n\t//   redirectEnd,\n\t//   redirectStart\n\t// }\n}\n\nfunction hasRedirection(entry) {\n\t// The only time fetchStart is different than startTime is if a redirection occurred.\n\treturn entry.fetchStart !== entry.startTime\n}\n\nfunction formatTiming(origin, start, end) {\n\treturn msToNs(end - start)\n}\n\nexport function computeSize(entry) {\n\t// Make sure a request actually occurred\n\tif (entry.startTime < entry.responseStart) {\n\t\treturn entry.receivedBytedCount\n\t}\n\treturn undefined\n}\n\nexport function isAllowedRequestUrl(configuration, url) {\n\treturn url && !isIntakeRequest(url, configuration)\n}\n","import { startXhrProxy } from '../core/xhrProxy'\nimport { startDownloadProxy } from '../core/downloadProxy'\nimport { LifeCycleEventType } from '../core/lifeCycle'\nimport { isObject } from '../helper/utils'\nimport { isAllowedRequestUrl } from '../rumEventsCollection/resource/resourceUtils'\nvar nextRequestIndex = 1\n\nexport function startRequestCollection(lifeCycle, configuration) {\n\ttrackXhr(lifeCycle, configuration)\n\ttrackDownload(lifeCycle, configuration)\n}\nfunction parseHeader(header) {\n\t// 大小写兼容\n\tif (!isObject(header)) return header\n\tvar res = {}\n\tObject.keys(header).forEach(function (key) {\n\t\tres[key.toLowerCase()] = header[key]\n\t})\n\treturn res\n}\nfunction getHeaderString(header) {\n\tif (!isObject(header)) return header\n\tvar headerStr = ''\n\tObject.keys(header).forEach(function (key) {\n\t\theaderStr += key + ':' + header[key] + ';'\n\t})\n\treturn headerStr\n}\nexport function trackXhr(lifeCycle, configuration) {\n\tvar xhrProxy = startXhrProxy()\n\txhrProxy.beforeSend(function (context) {\n\t\tif (isAllowedRequestUrl(configuration, context.url)) {\n\t\t\tcontext.requestIndex = getNextRequestIndex()\n\t\t\tlifeCycle.notify(LifeCycleEventType.REQUEST_STARTED, {\n\t\t\t\trequestIndex: context.requestIndex,\n\t\t\t})\n\t\t}\n\t})\n\txhrProxy.onRequestComplete(function (context) {\n\t\tif (isAllowedRequestUrl(configuration, context.url)) {\n\t\t\tlifeCycle.notify(LifeCycleEventType.REQUEST_COMPLETED, {\n\t\t\t\tduration: context.duration,\n\t\t\t\tmethod: context.method,\n\t\t\t\trequestIndex: context.requestIndex,\n\t\t\t\tperformance: context.profile,\n\t\t\t\tresponse: context.response,\n\t\t\t\tstartTime: context.startTime,\n\t\t\t\tstatus: context.status,\n\t\t\t\ttype: context.type,\n\t\t\t\turl: context.url,\n\t\t\t})\n\t\t}\n\t})\n\treturn xhrProxy\n}\nexport function trackDownload(lifeCycle, configuration) {\n\tvar dwonloadProxy = startDownloadProxy()\n\tdwonloadProxy.beforeSend(function (context) {\n\t\tif (isAllowedRequestUrl(configuration, context.url)) {\n\t\t\tcontext.requestIndex = getNextRequestIndex()\n\t\t\tlifeCycle.notify(LifeCycleEventType.REQUEST_STARTED, {\n\t\t\t\trequestIndex: context.requestIndex,\n\t\t\t})\n\t\t}\n\t})\n\tdwonloadProxy.onRequestComplete(function (context) {\n\t\tif (isAllowedRequestUrl(configuration, context.url)) {\n\t\t\tlifeCycle.notify(LifeCycleEventType.REQUEST_COMPLETED, {\n\t\t\t\tduration: context.duration,\n\t\t\t\tmethod: context.method,\n\t\t\t\trequestIndex: context.requestIndex,\n\t\t\t\tperformance: context.profile,\n\t\t\t\tresponse: context.response,\n\t\t\t\tstartTime: context.startTime,\n\t\t\t\tstatus: context.status,\n\t\t\t\ttype: context.type,\n\t\t\t\turl: context.url,\n\t\t\t})\n\t\t}\n\t})\n\treturn dwonloadProxy\n}\nfunction getNextRequestIndex() {\n\tvar result = nextRequestIndex\n\tnextRequestIndex += 1\n\treturn result\n}\n","import {\n\tcomputePerformanceResourceDuration,\n\tcomputePerformanceResourceDetails,\n\tcomputeSize,\n} from './resourceUtils'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\nimport {\n\tmsToNs,\n\textend2Lev,\n\turlParse,\n\tgetQueryParamsFromUrl,\n\treplaceNumberCharByPath,\n\tjsonStringify,\n\tgetStatusGroup,\n} from '../../helper/utils'\nimport { RumEventType } from '../../helper/enums'\nexport function startResourceCollection(lifeCycle, configuration) {\n\tlifeCycle.subscribe(LifeCycleEventType.REQUEST_COMPLETED, function (request) {\n\t\tlifeCycle.notify(\n\t\t\tLifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n\t\t\tprocessRequest(request),\n\t\t)\n\t})\n}\n\nfunction processRequest(request) {\n\tvar type = request.type\n\tvar timing = request.performance\n\tvar correspondingTimingOverrides = timing\n\t\t? computePerformanceEntryMetrics(timing)\n\t\t: undefined\n\tvar urlObj = urlParse(request.url).getParse()\n\tvar startTime = request.startTime\n\tvar resourceEvent = extend2Lev(\n\t\t{\n\t\t\tdate: startTime,\n\t\t\tresource: {\n\t\t\t\ttype: type,\n\t\t\t\tduration: msToNs(request.duration),\n\t\t\t\tmethod: request.method,\n\t\t\t\tstatus: request.status,\n\t\t\t\tstatusGroup: getStatusGroup(request.status),\n\t\t\t\turl: request.url,\n\t\t\t\turlHost: urlObj.Host,\n\t\t\t\turlPath: urlObj.Path,\n\t\t\t\turlPathGroup: replaceNumberCharByPath(urlObj.Path),\n\t\t\t\turlQuery: jsonStringify(getQueryParamsFromUrl(request.url)),\n\t\t\t},\n\t\t\ttype: RumEventType.RESOURCE,\n\t\t},\n\t\tcorrespondingTimingOverrides,\n\t)\n\treturn { startTime: startTime, rawRumEvent: resourceEvent }\n}\nfunction computePerformanceEntryMetrics(timing) {\n\treturn {\n\t\tresource: extend2Lev(\n\t\t\t{},\n\t\t\t{\n\t\t\t\tload: computePerformanceResourceDuration(timing),\n\t\t\t\tsize: computeSize(timing),\n\t\t\t},\n\t\t\tcomputePerformanceResourceDetails(timing),\n\t\t),\n\t}\n}\n","import { throttle, now, areInOrder } from '../../helper/utils'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\n\n// 劫持原小程序App方法\nexport var THROTTLE_VIEW_UPDATE_PERIOD = 3000\nexport const startupTypes = {\n\tCOLD: 'cold',\n\tHOT: 'hot',\n}\nexport function rewriteApp(configuration, lifeCycle) {\n\tconst originApp = App\n\tvar appInfo = {\n\t\tisStartUp: false, // 是否启动\n\t}\n\tvar startTime\n\tApp = function (app) {\n\t\tstartTime = now()\n\t\t// 合并方法，插入记录脚本\n\t\t;['onLaunch', 'onShow', 'onHide'].forEach((methodName) => {\n\t\t\tconst userDefinedMethod = app[methodName] // 暂存用户定义的方法\n\t\t\tapp[methodName] = function (options) {\n\t\t\t\tconsole.log(methodName, 'methodName app')\n\t\t\t\tif (methodName === 'onLaunch') {\n\t\t\t\t\tappInfo.isStartUp = true\n\t\t\t\t\tappInfo.isHide = false\n\t\t\t\t\tappInfo.startupType = startupTypes.COLD\n\t\t\t\t} else if (methodName === 'onShow') {\n\t\t\t\t\tif (appInfo.isStartUp && appInfo.isHide) {\n\t\t\t\t\t\t// 判断是热启动\n\t\t\t\t\t\tappInfo.startupType = startupTypes.HOT\n\t\t\t\t\t\tappUpdate()\n\t\t\t\t\t}\n\t\t\t\t} else if (methodName === 'onHide') {\n\t\t\t\t\tlifeCycle.notify(LifeCycleEventType.APP_HIDE)\n\t\t\t\t\tappInfo.isHide = true\n\t\t\t\t}\n\t\t\t\treturn userDefinedMethod && userDefinedMethod.call(this, options)\n\t\t\t}\n\t\t})\n\t\treturn originApp(app)\n\t}\n\tstartPerformanceObservable(lifeCycle, function (data) {\n\t\tappInfo = {\n\t\t\t...appInfo,\n\t\t\t...data,\n\t\t}\n\t\tappUpdate()\n\t})\n\tvar scheduleAppUpdate = throttle(appUpdate, THROTTLE_VIEW_UPDATE_PERIOD, {\n\t\tleading: false,\n\t})\n\tfunction appUpdate() {\n\t\tlifeCycle.notify(LifeCycleEventType.APP_UPDATE, {\n\t\t\tstartupDuration: appInfo.startupDuration,\n\t\t\tscriptLoadDuration: appInfo.scriptLoadDuration,\n\t\t\tcodeDownloadDuration: appInfo.codeDownloadDuration,\n\t\t\tstartupType: appInfo.startupType,\n\t\t\tstartTime,\n\t\t\tduration: now() - startTime,\n\t\t})\n\t}\n}\n\nfunction startPerformanceObservable(lifeCycle, callback) {\n\tvar subscribe = lifeCycle.subscribe(\n\t\tLifeCycleEventType.PERFORMANCE_ENTRY_COLLECTED,\n\t\tfunction (entitys) {\n\t\t\t// 过滤掉其他页面监听，只保留首次启动\n\t\t\tvar startupDuration, scriptLoadDuration, codeDownloadDuration\n\t\t\tconst launchEntity = entitys.find(\n\t\t\t\t(entity) =>\n\t\t\t\t\tentity.entryType === 'navigation' &&\n\t\t\t\t\tentity.navigationType === 'appLaunch',\n\t\t\t)\n\t\t\tif (typeof launchEntity !== 'undefined') {\n\t\t\t\tstartupDuration = launchEntity.duration\n\t\t\t}\n\t\t\tconst scriptentity = entitys.find(\n\t\t\t\t(entity) =>\n\t\t\t\t\tentity.entryType === 'script' && entity.name === 'evaluateScript',\n\t\t\t)\n\t\t\tif (typeof scriptentity !== 'undefined') {\n\t\t\t\tscriptLoadDuration = scriptentity.duration\n\t\t\t}\n\t\t\tconst firstEntity = entitys.find(\n\t\t\t\t(entity) =>\n\t\t\t\t\tentity.entryType === 'render' && entity.name === 'firstRender',\n\t\t\t)\n\t\t\tif (firstEntity && scriptentity && launchEntity) {\n\t\t\t\tif (\n\t\t\t\t\t!areInOrder(firstEntity.duration, launchEntity.duration) ||\n\t\t\t\t\t!areInOrder(scriptentity.duration, launchEntity.duration)\n\t\t\t\t) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tcodeDownloadDuration =\n\t\t\t\t\tlaunchEntity.duration - firstEntity.duration - scriptentity.duration\n\t\t\t\t// 资源下载时间暂时定为：首次启动时间-脚本加载时间-初次渲染时间\n\t\t\t}\n\t\t\tcallback({\n\t\t\t\tstartupDuration,\n\t\t\t\tscriptLoadDuration,\n\t\t\t\tcodeDownloadDuration,\n\t\t\t})\n\t\t},\n\t)\n\treturn {\n\t\tstop: subscribe.unsubscribe,\n\t}\n}\n","import { rewriteApp } from './index'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\nimport { RumEventType } from '../../helper/enums'\nimport { msToNs } from '../../helper/utils'\nexport function startAppCollection(lifeCycle, configuration) {\n\tlifeCycle.subscribe(LifeCycleEventType.APP_UPDATE, function (appinfo) {\n\t\tlifeCycle.notify(\n\t\t\tLifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n\t\t\tprocessAppUpdate(appinfo),\n\t\t)\n\t})\n\n\treturn rewriteApp(configuration, lifeCycle)\n}\n\nfunction processAppUpdate(appinfo) {\n\tvar appEvent = {\n\t\tdate: appinfo.startTime,\n\t\ttype: RumEventType.APP,\n\t\tapp: {\n\t\t\tstartupDuration: msToNs(appinfo.startupDuration),\n\t\t\tscriptLoadDuration: msToNs(appinfo.scriptLoadDuration),\n\t\t\tcodeDownloadDuration: msToNs(appinfo.codeDownloadDuration),\n\t\t\tstartupType: appinfo.startupType,\n\t\t\ttimeSpent: msToNs(appinfo.duration),\n\t\t},\n\t}\n\treturn {\n\t\trawRumEvent: appEvent,\n\t\tstartTime: appinfo.startTime,\n\t}\n}\n","import { each, now } from '../helper/utils'\nimport { LifeCycleEventType } from '../core/lifeCycle'\nimport { Observable } from '../core/observable'\n// Delay to wait for a page activity to validate the tracking process\nexport var PAGE_ACTIVITY_VALIDATION_DELAY = 100\n// Delay to wait after a page activity to end the tracking process\nexport var PAGE_ACTIVITY_END_DELAY = 100\n// Maximum duration of the tracking process\nexport var PAGE_ACTIVITY_MAX_DURATION = 10000\n\nexport function waitIdlePageActivity(lifeCycle, completionCallback) {\n\tvar _trackPageActivities = trackPageActivities(lifeCycle)\n\tvar pageActivitiesObservable = _trackPageActivities.observable\n\tvar stopPageActivitiesTracking = _trackPageActivities.stop\n\tvar _waitPageActivitiesCompletion = waitPageActivitiesCompletion(\n\t\tpageActivitiesObservable,\n\t\tstopPageActivitiesTracking,\n\t\tcompletionCallback,\n\t)\n\n\tvar stopWaitPageActivitiesCompletion = _waitPageActivitiesCompletion.stop\n\tfunction stop() {\n\t\tstopWaitPageActivitiesCompletion()\n\t\tstopPageActivitiesTracking()\n\t}\n\n\treturn { stop: stop }\n}\n\n// Automatic action collection lifecycle overview:\n//                      (Start new trackPageActivities)\n//              .-------------------'--------------------.\n//              v                                        v\n//     [Wait for a page activity ]          [Wait for a maximum duration]\n//     [timeout: VALIDATION_DELAY]          [  timeout: MAX_DURATION    ]\n//          /                  \\                           |\n//         v                    v                          |\n//  [No page activity]   [Page activity]                   |\n//         |                   |,----------------------.   |\n//         v                   v                       |   |\n//     (Discard)     [Wait for a page activity]        |   |\n//                   [   timeout: END_DELAY   ]        |   |\n//                       /                \\            |   |\n//                      v                  v           |   |\n//             [No page activity]    [Page activity]   |   |\n//                      |                 |            |   |\n//                      |                 '------------'   |\n//                      '-----------. ,--------------------'\n//                                   v\n//                                 (End)\n//\n// Note: because MAX_DURATION > VALIDATION_DELAY, we are sure that if the process is still alive\n// after MAX_DURATION, it has been validated.\nexport function trackPageActivities(lifeCycle) {\n\tvar observable = new Observable()\n\tvar subscriptions = []\n\tvar firstRequestIndex\n\tvar pendingRequestsCount = 0\n\n\tsubscriptions.push(\n\t\tlifeCycle.subscribe(LifeCycleEventType.PAGE_SET_DATA_UPDATE, function () {\n\t\t\tnotifyPageActivity()\n\t\t}),\n\t\tlifeCycle.subscribe(LifeCycleEventType.PAGE_ALIAS_ACTION, function () {\n\t\t\tnotifyPageActivity()\n\t\t}),\n\t)\n\n\tsubscriptions.push(\n\t\tlifeCycle.subscribe(\n\t\t\tLifeCycleEventType.REQUEST_STARTED,\n\t\t\tfunction (startEvent) {\n\t\t\t\tif (firstRequestIndex === undefined) {\n\t\t\t\t\tfirstRequestIndex = startEvent.requestIndex\n\t\t\t\t}\n\n\t\t\t\tpendingRequestsCount += 1\n\t\t\t\tnotifyPageActivity()\n\t\t\t},\n\t\t),\n\t)\n\n\tsubscriptions.push(\n\t\tlifeCycle.subscribe(\n\t\t\tLifeCycleEventType.REQUEST_COMPLETED,\n\t\t\tfunction (request) {\n\t\t\t\t// If the request started before the tracking start, ignore it\n\t\t\t\tif (\n\t\t\t\t\tfirstRequestIndex === undefined ||\n\t\t\t\t\trequest.requestIndex < firstRequestIndex\n\t\t\t\t) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tpendingRequestsCount -= 1\n\t\t\t\tnotifyPageActivity()\n\t\t\t},\n\t\t),\n\t)\n\n\tfunction notifyPageActivity() {\n\t\tobservable.notify({ isBusy: pendingRequestsCount > 0 })\n\t}\n\n\treturn {\n\t\tobservable: observable,\n\t\tstop: function () {\n\t\t\teach(subscriptions, function (sub) {\n\t\t\t\tsub.unsubscribe()\n\t\t\t})\n\t\t},\n\t}\n}\n\nexport function waitPageActivitiesCompletion(\n\tpageActivitiesObservable,\n\tstopPageActivitiesTracking,\n\tcompletionCallback,\n) {\n\tvar idleTimeoutId\n\tvar hasCompleted = false\n\n\tvar validationTimeoutId = setTimeout(function () {\n\t\tcomplete({ hadActivity: false })\n\t}, PAGE_ACTIVITY_VALIDATION_DELAY)\n\tvar maxDurationTimeoutId = setTimeout(function () {\n\t\tcomplete({ hadActivity: true, endTime: now() })\n\t}, PAGE_ACTIVITY_MAX_DURATION)\n\tpageActivitiesObservable.subscribe(function (data) {\n\t\tvar isBusy = data.isBusy\n\t\tclearTimeout(validationTimeoutId)\n\t\tclearTimeout(idleTimeoutId)\n\t\tvar lastChangeTime = now()\n\t\tif (!isBusy) {\n\t\t\tidleTimeoutId = setTimeout(function () {\n\t\t\t\tcomplete({ hadActivity: true, endTime: lastChangeTime })\n\t\t\t}, PAGE_ACTIVITY_END_DELAY)\n\t\t}\n\t})\n\n\tfunction stop() {\n\t\thasCompleted = true\n\t\tclearTimeout(validationTimeoutId)\n\t\tclearTimeout(idleTimeoutId)\n\t\tclearTimeout(maxDurationTimeoutId)\n\t\tstopPageActivitiesTracking()\n\t}\n\n\tfunction complete(params) {\n\t\tif (hasCompleted) {\n\t\t\treturn\n\t\t}\n\t\tstop()\n\t\tcompletionCallback(params)\n\t}\n\n\treturn { stop: stop }\n}\n","import { elapsed, now, UUID, getMethods, isObject } from '../../helper/utils'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\nimport { MinaTouch } from '../../core/miniaTouch'\nimport { trackEventCounts } from '../trackEventCounts'\nimport { waitIdlePageActivity } from '../trackPageActiveites'\nimport { ActionType } from '../../helper/enums'\nexport function trackActions(lifeCycle) {\n\tvar action = startActionManagement(lifeCycle)\n\n\t// New views trigger the discard of the current pending Action\n\tlifeCycle.subscribe(LifeCycleEventType.VIEW_CREATED, function () {\n\t\taction.discardCurrent()\n\t})\n\tvar originPage = Page\n\tPage = function (page) {\n\t\tconst methods = getMethods(page)\n\t\tmethods.forEach((methodName) => {\n\t\t\tclickProxy(\n\t\t\t\tpage,\n\t\t\t\tmethodName,\n\t\t\t\tfunction (_action) {\n\t\t\t\t\taction.create(_action.type, _action.name)\n\t\t\t\t},\n\t\t\t\tlifeCycle,\n\t\t\t)\n\t\t})\n\t\treturn originPage(page)\n\t}\n\tvar originComponent = Component\n\tComponent = function (component) {\n\t\tconst methods = getMethods(component)\n\t\tmethods.forEach((methodName) => {\n\t\t\tclickProxy(component, methodName, function (_action) {\n\t\t\t\taction.create(_action.type, _action.name)\n\t\t\t})\n\t\t})\n\t\treturn originComponent(component)\n\t}\n\treturn {\n\t\tstop: function () {\n\t\t\taction.discardCurrent()\n\t\t\t// stopListener()\n\t\t},\n\t}\n}\nfunction clickProxy(page, methodName, callback, lifeCycle) {\n\tvar oirginMethod = page[methodName]\n\n\tpage[methodName] = function () {\n\t\tconst result = oirginMethod.apply(this, arguments)\n\t\tvar action = {}\n\t\tif (isObject(arguments[0])) {\n\t\t\tvar currentTarget = arguments[0].currentTarget || {}\n\t\t\tvar dataset = currentTarget.dataset || {}\n\t\t\tvar actionType = arguments[0].type\n\t\t\tif (actionType && ActionType[actionType]) {\n\t\t\t\taction.type = actionType\n\t\t\t\taction.name = dataset.name || dataset.content || dataset.type\n\t\t\t\tcallback(action)\n\t\t\t} else if (methodName === 'onAddToFavorites') {\n\t\t\t\taction.type = 'click'\n\t\t\t\taction.name =\n\t\t\t\t\t'收藏 ' +\n\t\t\t\t\t'标题: ' +\n\t\t\t\t\tresult.title +\n\t\t\t\t\t(result.query ? ' query: ' + result.query : '')\n\t\t\t\tcallback(action)\n\t\t\t\tlifeCycle.notify(LifeCycleEventType.PAGE_ALIAS_ACTION, true)\n\t\t\t} else if (methodName === 'onShareAppMessage') {\n\t\t\t\taction.type = 'click'\n\t\t\t\taction.name =\n\t\t\t\t\t'转发 ' +\n\t\t\t\t\t'标题: ' +\n\t\t\t\t\tresult.title +\n\t\t\t\t\t(result.path ? ' path: ' + result.path : '')\n\t\t\t\tcallback(action)\n\t\t\t\tlifeCycle.notify(LifeCycleEventType.PAGE_ALIAS_ACTION, true)\n\t\t\t} else if (methodName === 'onShareTimeline') {\n\t\t\t\taction.type = 'click'\n\t\t\t\taction.name =\n\t\t\t\t\t'分享到朋友圈 ' +\n\t\t\t\t\t'标题: ' +\n\t\t\t\t\tresult.title +\n\t\t\t\t\t(result.query ? ' query: ' + result.query : '')\n\t\t\t\tcallback(action)\n\t\t\t\tlifeCycle.notify(LifeCycleEventType.PAGE_ALIAS_ACTION, true)\n\t\t\t} else if (methodName === 'onTabItemTap') {\n\t\t\t\tvar item = arguments.length && arguments[0]\n\t\t\t\taction.type = 'click'\n\t\t\t\taction.name =\n\t\t\t\t\t'tab ' +\n\t\t\t\t\t'名称: ' +\n\t\t\t\t\titem.text +\n\t\t\t\t\t(item.pagePath ? ' 跳转到: ' + item.pagePath : '')\n\t\t\t\tcallback(action)\n\t\t\t\tlifeCycle.notify(LifeCycleEventType.PAGE_ALIAS_ACTION, true)\n\t\t\t}\n\t\t}\n\t\treturn result\n\t}\n}\nfunction startActionManagement(lifeCycle) {\n\tvar currentAction\n\tvar currentIdlePageActivitySubscription\n\n\treturn {\n\t\tcreate: function (type, name) {\n\t\t\tif (currentAction) {\n\t\t\t\t// Ignore any new action if another one is already occurring.\n\t\t\t\treturn\n\t\t\t}\n\t\t\tvar pendingAutoAction = new PendingAutoAction(lifeCycle, type, name)\n\n\t\t\tcurrentAction = pendingAutoAction\n\t\t\tcurrentIdlePageActivitySubscription = waitIdlePageActivity(\n\t\t\t\tlifeCycle,\n\t\t\t\tfunction (params) {\n\t\t\t\t\tif (params.hadActivity) {\n\t\t\t\t\t\tpendingAutoAction.complete(params.endTime)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpendingAutoAction.discard()\n\t\t\t\t\t}\n\t\t\t\t\tcurrentAction = undefined\n\t\t\t\t},\n\t\t\t)\n\t\t},\n\t\tdiscardCurrent: function () {\n\t\t\tif (currentAction) {\n\t\t\t\tcurrentIdlePageActivitySubscription.stop()\n\t\t\t\tcurrentAction.discard()\n\t\t\t\tcurrentAction = undefined\n\t\t\t}\n\t\t},\n\t}\n}\nvar PendingAutoAction = function (lifeCycle, type, name) {\n\tthis.id = UUID()\n\tthis.startClocks = now()\n\tthis.name = name\n\tthis.type = type\n\tthis.lifeCycle = lifeCycle\n\tthis.eventCountsSubscription = trackEventCounts(lifeCycle)\n\tthis.lifeCycle.notify(LifeCycleEventType.AUTO_ACTION_CREATED, {\n\t\tid: this.id,\n\t\tstartClocks: this.startClocks,\n\t})\n}\nPendingAutoAction.prototype = {\n\tcomplete: function (endTime) {\n\t\tvar eventCounts = this.eventCountsSubscription.eventCounts\n\t\tthis.lifeCycle.notify(LifeCycleEventType.AUTO_ACTION_COMPLETED, {\n\t\t\tcounts: {\n\t\t\t\terrorCount: eventCounts.errorCount,\n\t\t\t\tlongTaskCount: eventCounts.longTaskCount,\n\t\t\t\tresourceCount: eventCounts.resourceCount,\n\t\t\t},\n\t\t\tduration: elapsed(this.startClocks, endTime),\n\t\t\tid: this.id,\n\t\t\tname: this.name,\n\t\t\tstartClocks: this.startClocks,\n\t\t\ttype: this.type,\n\t\t})\n\t\tthis.eventCountsSubscription.stop()\n\t},\n\tdiscard: function () {\n\t\tthis.lifeCycle.notify(LifeCycleEventType.AUTO_ACTION_DISCARDED)\n\t\tthis.eventCountsSubscription.stop()\n\t},\n}\n","import { msToNs, extend2Lev } from '../../helper/utils'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\nimport { RumEventType } from '../../helper/enums'\nimport { trackActions } from './trackActions'\n\nexport function startActionCollection(lifeCycle, configuration) {\n\tlifeCycle.subscribe(\n\t\tLifeCycleEventType.AUTO_ACTION_COMPLETED,\n\t\tfunction (action) {\n\t\t\tlifeCycle.notify(\n\t\t\t\tLifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n\t\t\t\tprocessAction(action),\n\t\t\t)\n\t\t},\n\t)\n\tif (configuration.trackInteractions) {\n\t\ttrackActions(lifeCycle)\n\t}\n}\n\nfunction processAction(action) {\n\tvar autoActionProperties = {\n\t\taction: {\n\t\t\terror: {\n\t\t\t\tcount: action.counts.errorCount,\n\t\t\t},\n\t\t\tid: action.id,\n\t\t\tloadingTime: msToNs(action.duration),\n\t\t\tlong_task: {\n\t\t\t\tcount: action.counts.longTaskCount,\n\t\t\t},\n\t\t\tresource: {\n\t\t\t\tcount: action.counts.resourceCount,\n\t\t\t},\n\t\t},\n\t}\n\tvar actionEvent = extend2Lev(\n\t\t{\n\t\t\taction: {\n\t\t\t\ttarget: {\n\t\t\t\t\tname: action.name,\n\t\t\t\t},\n\t\t\t\ttype: action.type,\n\t\t\t},\n\t\t\tdate: action.startClocks,\n\t\t\ttype: RumEventType.ACTION,\n\t\t},\n\t\tautoActionProperties,\n\t)\n\treturn {\n\t\trawRumEvent: actionEvent,\n\t\tstartTime: action.startClocks,\n\t}\n}\n","import { buildEnv } from './buildEnv'\nimport { LifeCycle } from '../core/lifeCycle'\nimport { commonInit } from '../core/configuration'\nimport { startErrorCollection } from '../rumEventsCollection/error/errorCollection'\nimport { startRumAssembly } from '../rumEventsCollection/assembly'\nimport { startParentContexts } from '../rumEventsCollection/parentContexts'\nimport { startRumBatch } from '../rumEventsCollection/transport/batch'\nimport { startViewCollection } from '../rumEventsCollection/page/viewCollection'\nimport { startRequestCollection } from '../rumEventsCollection/requestCollection'\nimport { startResourceCollection } from '../rumEventsCollection/resource/resourceCollection'\nimport { startAppCollection } from '../rumEventsCollection/app/appCollection'\nimport { startPagePerformanceObservable } from '../rumEventsCollection/performanceCollection'\nimport { startSetDataColloction } from '../rumEventsCollection/setDataCollection'\nimport { startActionCollection } from '../rumEventsCollection/action/actionCollection'\n\nimport { sdk } from '../core/sdk'\nexport const startRum = function (userConfiguration) {\n\tconst configuration = commonInit(userConfiguration, buildEnv)\n\tconst lifeCycle = new LifeCycle()\n\tvar parentContexts = startParentContexts(lifeCycle)\n\tvar batch = startRumBatch(configuration, lifeCycle)\n\tstartRumAssembly(\n\t\tuserConfiguration.applicationId,\n\t\tconfiguration,\n\t\tlifeCycle,\n\t\tparentContexts,\n\t)\n\tstartAppCollection(lifeCycle, configuration)\n\tstartResourceCollection(lifeCycle, configuration)\n\tstartViewCollection(lifeCycle, configuration)\n\tstartErrorCollection(lifeCycle, configuration)\n\tstartRequestCollection(lifeCycle, configuration)\n\tstartPagePerformanceObservable(lifeCycle, configuration)\n\tstartSetDataColloction(lifeCycle)\n\tstartActionCollection(lifeCycle, configuration)\n}\n","import { isPercentage } from '../helper/utils'\nimport { startRum } from './rum'\nexport const makeRum = function (startRumImpl) {\n\tvar isAlreadyInitialized = false\n\tvar rumGlobal = {\n\t\tinit: function (userConfiguration) {\n\t\t\tif (typeof userConfiguration === 'undefined') {\n\t\t\t\tuserConfiguration = {}\n\t\t\t}\n\t\t\tif (!canInitRum(userConfiguration)) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tstartRumImpl(userConfiguration)\n\n\t\t\tisAlreadyInitialized = true\n\t\t},\n\t}\n\treturn rumGlobal\n\tfunction canInitRum(userConfiguration) {\n\t\tif (isAlreadyInitialized) {\n\t\t\tconsole.error('DATAFLUX_RUM is already initialized.')\n\t\t\treturn false\n\t\t}\n\n\t\tif (!userConfiguration.applicationId) {\n\t\t\tconsole.error(\n\t\t\t\t'Application ID is not configured, no RUM data will be collected.',\n\t\t\t)\n\t\t\treturn false\n\t\t}\n\t\tif (!userConfiguration.datakitOrigin) {\n\t\t\tconsole.error(\n\t\t\t\t'datakitOrigin is not configured, no RUM data will be collected.',\n\t\t\t)\n\t\t\treturn false\n\t\t}\n\t\tif (\n\t\t\tuserConfiguration.sampleRate !== undefined &&\n\t\t\t!isPercentage(userConfiguration.sampleRate)\n\t\t) {\n\t\t\tconsole.error('Sample Rate should be a number between 0 and 100')\n\t\t\treturn false\n\t\t}\n\t\treturn true\n\t}\n}\nexport const datafluxRum = makeRum(startRum)\n","import { LifeCycleEventType } from '../core/lifeCycle'\nimport { sdk } from '../core/sdk'\nexport function startPagePerformanceObservable(lifeCycle, configuration) {\n\tif (!!sdk.getPerformance) {\n\t\tconst performance = sdk.getPerformance()\n\t\tconst observer = performance.createObserver((entryList) => {\n\t\t\tlifeCycle.notify(\n\t\t\t\tLifeCycleEventType.PERFORMANCE_ENTRY_COLLECTED,\n\t\t\t\tentryList.getEntries(),\n\t\t\t)\n\t\t})\n\t\tobserver.observe({ entryTypes: ['render', 'script', 'navigation'] })\n\t}\n}\n","import { LifeCycleEventType } from '../core/lifeCycle'\n\nexport function startSetDataColloction(lifeCycle) {\n\tconst originPage = Page\n\tconst originComponent = Component\n\tPage = function (page) {\n\t\tconst originPageOnLoad = page['onLoad']\n\t\tpage['onLoad'] = function () {\n\t\t\tthis.setUpdatePerformanceListener &&\n\t\t\t\tthis.setUpdatePerformanceListener({ withDataPaths: true }, (res) => {\n\t\t\t\t\tlifeCycle.notify(LifeCycleEventType.PAGE_SET_DATA_UPDATE, res)\n\t\t\t\t})\n\t\t\treturn originPageOnLoad.apply(this, arguments)\n\t\t}\n\t\treturn originPage(page)\n\t}\n\tComponent = function (component) {\n\t\tconst originComponentAttached = component['attached']\n\t\tcomponent['attached'] = function () {\n\t\t\tthis.setUpdatePerformanceListener &&\n\t\t\t\tthis.setUpdatePerformanceListener({ withDataPaths: true }, (res) => {\n\t\t\t\t\tlifeCycle.notify(LifeCycleEventType.PAGE_SET_DATA_UPDATE, res)\n\t\t\t\t})\n\t\t\treturn originComponentAttached.apply(this, arguments)\n\t\t}\n\t\treturn originComponent(component)\n\t}\n}\n"],"sourceRoot":""}