(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{datafluxRum:()=>ft});const r=6e4,n="datafluxRum:client:id",o="error",i="long_task",s="view",a="resource",u="app",c="action";var f="network",l="resource",p={tap:"tap",longpress:"longpress",longtap:"longtap"},d={data:1,onLoad:1,onShow:1,onReady:1,onPullDownRefresh:1,onReachBottom:1,onShareAppMessage:1,onPageScroll:1,onResize:1,onTabItemTap:1,onHide:1,onUnload:1},h=Array.prototype,m=Object.prototype,v=(m=Object.prototype).hasOwnProperty,g=h.slice,_=m.toString,y=h.forEach,E=function(e,t,r){if(null===e)return!1;if(y&&e.forEach===y)e.forEach(t,r);else if(e.length===+e.length){for(var n=0,o=e.length;n<o;n++)if(n in e&&false===t.call(r,e[n],n,e))return!1}else for(var i in e)if(v.call(e,i)&&false===t.call(r,e[i],i,e))return!1},T=function(e){var t=[];return null===e||E(e,(function(e){t[t.length]=e})),t};function b(e){return"number"!=typeof e?e:+(1e6*e).toFixed(0)}var S=function(e){return"[object String]"===_.call(e)},C=function(e){return"[object Number]"===_.call(e)&&/[\d\.]+/.test(String(e))},A=function(e){return e?e.toArray?e.toArray():Array.isArray(e)?g.call(e):(t=e)&&v.call(t,"callee")?g.call(e):T(e):[];var t},O=function(){for(var e=A(arguments),t=1;t<e.length;t+=1)if(e[t-1]>e[t])return!1;return!0};function D(e){return e?(parseInt(e,10)^16*Math.random()>>parseInt(e,10)/4).toString(16):"10000000-1000-4000-8000-100000000000".replace(/[018]/g,D)}function P(e,t,r){if(null==e)return JSON.stringify(e);var n=[!1,void 0];k(e)&&(n=[!0,e.toJSON],delete e.toJSON);var o,i,s=[!1,void 0];"object"==typeof e&&k(o=Object.getPrototypeOf(e))&&(s=[!0,o.toJSON],delete o.toJSON);try{i=JSON.stringify(e,void 0,r)}catch(e){i="<error: unable to serialize object>"}finally{n[0]&&(e.toJSON=n[1]),s[0]&&(o.toJSON=s[1])}return i}function k(e){return"object"==typeof e&&null!==e&&e.hasOwnProperty("toJSON")}function w(e){var t=[];for(var r in e)"function"!=typeof e[r]||d[r]||t.push(r);return t}function R(e){return e?e.replace(/\/([^\/]*)\d([^\/]*)/g,"/?"):""}function I(e){return e?String(e).substr(0,1)+String(e).substr(1).replace(/\d*/g,"x"):e}var L=function(e){var t={},r=e.split("?")[1]||"";return r&&(t=getURLSearchParams("?"+r)),t};var N=function(e){return g.call(arguments,1).forEach((function(t){for(var r in t)void 0!==t[r]&&(e[r]=t[r])})),e},x=function(e){return g.call(arguments,1).forEach((function(t){for(var r in t)void 0!==t[r]&&(U(t[r])&&U(e[r])?N(e[r],t[r]):e[r]=t[r])})),e},U=function(e){return null!==e&&"[object Object]"===_.call(e)},M=Date.now||function(){return(new Date).getTime()},j=function(e,t,r){var n,o,i,s,a=0;r||(r={});var u=function(){a=!1===r.leading?0:(new Date).getTime(),n=null,s=e.apply(o,i),n||(o=i=null)},c=function(){i=arguments;var c=(new Date).getTime();a||!1!==r.leading||(a=c);var f=t-(c-a);return o=this,f<=0||f>t?(n&&(clearTimeout(n),n=null),a=c,s=e.apply(o,i),n||(o=i=null)):n||!1===r.trailing||(n=setTimeout(u,f)),s};return c.cancel=function(){clearTimeout(n),a=0,n=null},c};function B(){}function V(e,t){for(var r=t.split(".");r.length;){var n=r.shift();if(!(e&&n in e&&v.call(e,n)))return;e=e[n]}return e}function q(e){const t={};return Object.keys(e).forEach((r=>{var n;t[(n=r,n.replace(/[A-Z]/g,(function(e,t){return(0!==t?"_":"")+e.toLowerCase()})).replace(/-/g,"_"))]=z(e[r])})),t}function z(e){return Array.isArray(e)?e.map((e=>z(e))):"object"==typeof e&&null!==e?q(e):e}function W(e){if(!S(e))return e;return String(e).replace(/[\s=,"]/g,(function(e){return"\\"+e}))}var F=function(e){var t=function(e){this._fields={Username:4,Password:5,Port:7,Protocol:2,Host:6,Path:8,URL:0,QueryString:9,Fragment:10},this._values={},this._regex=null,this._regex=/^((\w+):\/\/)?((\w+):?(\w+)?@)?([^\/\?:]+):?(\d+)?(\/?[^\?#]+)?\??([^#]+)?#?(\w*)/,void 0!==e&&this._parse(e)};return t.prototype.setUrl=function(e){this._parse(e)},t.prototype._initValues=function(){for(var e in this._fields)this._values[e]=""},t.prototype.addQueryString=function(e){if("object"!=typeof e)return!1;var t=this._values.QueryString||"";for(var r in e)t=new RegExp(r+"[^&]+").test(t)?t.replace(new RegExp(r+"[^&]+"),r+"="+e[r]):"&"===t.slice(-1)?t+r+"="+e[r]:""===t?r+"="+e[r]:t+"&"+r+"="+e[r];this._values.QueryString=t},t.prototype.getParse=function(){return this._values},t.prototype.getUrl=function(){var e="";return e+=this._values.Origin,e+=this._values.Port?":"+this._values.Port:"",e+=this._values.Path,e+=this._values.QueryString?"?"+this._values.QueryString:""},t.prototype._parse=function(e){this._initValues();var t=this._regex.exec(e);if(!t)throw"DPURLParser::_parse -> Invalid URL";for(var r in this._fields)void 0!==t[this._fields[r]]&&(this._values[r]=t[this._fields[r]]);this._values.Hostname=this._values.Host.replace(/:\d+$/,""),this._values.Origin=this._values.Protocol+"://"+this._values.Hostname},new t(e)};const H=function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r},G=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},Q={sdkVersion:"<<< SDK_VERSION >>>",sdkName:"df_miniapp_rum_sdk"};class ${constructor(){this.callbacks={}}notify(e,t){const r=this.callbacks[e];r&&r.forEach((e=>e(t)))}subscribe(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),{unsubscribe:()=>{this.callbacks[e]=this.callbacks[e].filter((e=>t!==e))}}}}var J={PERFORMANCE_ENTRY_COLLECTED:"PERFORMANCE_ENTRY_COLLECTED",AUTO_ACTION_CREATED:"AUTO_ACTION_CREATED",AUTO_ACTION_COMPLETED:"AUTO_ACTION_COMPLETED",AUTO_ACTION_DISCARDED:"AUTO_ACTION_DISCARDED",APP_HIDE:"APP_HIDE",APP_UPDATE:"APP_UPDATE",PAGE_SET_DATA_UPDATE:"PAGE_SET_DATA_UPDATE",PAGE_ALIAS_ACTION:"PAGE_ALIAS_ACTION",VIEW_CREATED:"VIEW_CREATED",VIEW_UPDATED:"VIEW_UPDATED",VIEW_ENDED:"VIEW_ENDED",REQUEST_STARTED:"REQUEST_STARTED",REQUEST_COMPLETED:"REQUEST_COMPLETED",RAW_RUM_EVENT_COLLECTED:"RAW_RUM_EVENT_COLLECTED",RUM_EVENT_COLLECTED:"RUM_EVENT_COLLECTED"},Y={sampleRate:100,flushTimeout:3e4,maxErrorsByMinute:3e3,maxBatchSize:50,maxMessageSize:262144,batchBytesLimit:16384,datakitUrl:"",requestErrorResponseLengthLimit:32768,trackInteractions:!1};function K(e,t){return function(e,t){const r=F(e).getParse(),n=F(t).getParse();return r.Origin===n.Origin}(e,t.datakitUrl)}var Z="agent",X="console",ee="network",te="source";function re(e){var t=e.name||"Error: "+e.message;return e.stack.forEach((function(e){var r="?"===e.func?"<anonymous>":e.func,n=e.args&&e.args.length>0?"("+e.args.join(", ")+")":"",o=e.line?":"+e.line:"",i=e.line&&e.column?":"+e.column:"";t+="\n  at "+r+n+" @ "+e.url+o+i})),t}const ne=function(){var e=null,t="";try{wx&&"object"==typeof wx&&"function"==typeof wx.request&&(e=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?H(Object(r),!0).forEach((function(t){G(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},wx),t="wx",wx=e)}catch(e){}return{sdk:e,tracker:t}}(),oe=ne.sdk,ie=(ne.tracker,"?");function se(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var ae,ue=function(){var e,t,r,n,o=[];function i(e,t,r){var n;for(var i in o)if(se(o,i))try{o[i](e,t,r)}catch(e){n=e}if(n)throw n}function s(e){const t="string"==typeof e?new Error(e):e;var r,n="",o="";if(r=ce(t),t&&t.message&&"[object String]"==={}.toString.call(t.message)){const e=t.message.split("\n");if(e.length>=3){const t=(o=e[2]).match(fe);t&&(n=t[1],o=t[2])}}o&&(r.message=o),n&&(r.name=n),i(r,!0,t)}function a({reason:e,promise:t}){const r="string"==typeof e?new Error(e):e;var n,o="",s="";if(n=ce(r),r&&r.message&&"[object String]"==={}.toString.call(r.message)){const e=r.message.split("\n");if(e.length>=3){const t=(s=e[2]).match(fe);t&&(o=t[1],s=t[2])}}s&&(n.message=s),o&&(n.name=o),i(n,!0,r)}function u(e){}return u.subscribe=function(u){!function(){if(e||!oe.onError)return;oe.onError(s),e=!0}(),function(){if(t||!oe.onUnhandledRejection)return;oe.onUnhandledRejection&&oe.onUnhandledRejection(a),t=!0}(),function(){if(r||!oe.onPageNotFound)return;oe.onPageNotFound((e=>{const t=e.path.split("?")[0];i({message:JSON.stringify(e),type:"pagenotfound",name:t+"页面无法找到"},!0,{})})),r=!0}(),function(){if(n||!oe.onMemoryWarning)return;oe.onMemoryWarning((({level:e=-1})=>{let t="没有获取到告警级别信息";switch(e){case 5:t="TRIM_MEMORY_RUNNING_MODERATE";break;case 10:t="TRIM_MEMORY_RUNNING_LOW";break;case 15:t="TRIM_MEMORY_RUNNING_CRITICAL";break;default:return}i({message:t,type:"memorywarning",name:"内存不足告警"},!0,{})})),n=!0}(),o.push(u)},u.unsubscribe=function(e){for(var t=o.length-1;t>=0;t-=1)o[t]===e&&o.splice(t,1)},u.traceKitWindowOnError=s,u}(),ce=function(){var e=!1;function t(e){if(e.stack){for(var t,r,n,o,i=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,s=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\[native).*?|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,a=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,u=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,c=/\((\S*)(?::(\d+))(?::(\d+))\)/,f=e.stack.split("\n"),l=[],p=0,d=f.length;p<d;p+=1){if(i.exec(f[p])){var h=(n=i.exec(f[p]))[2]&&0===n[2].indexOf("native");t=n[2]&&0===n[2].indexOf("eval"),r=c.exec(n[2]),t&&r&&(n[2]=r[1],n[3]=r[2],n[4]=r[3]),o={args:h?[n[2]]:[],column:n[4]?+n[4]:void 0,func:n[1]||ie,line:n[3]?+n[3]:void 0,url:h?void 0:n[2]}}else if(a.exec(f[p]))o={args:[],column:(n=a.exec(f[p]))[4]?+n[4]:void 0,func:n[1]||ie,line:+n[3],url:n[2]};else{if(!s.exec(f[p]))continue;t=(n=s.exec(f[p]))[3]&&n[3].indexOf(" > eval")>-1,r=u.exec(n[3]),t&&r?(n[3]=r[1],n[4]=r[2],n[5]=void 0):0!==p||n[5]||void 0===e.columnNumber||(l[0].column=e.columnNumber+1),o={args:n[2]?n[2].split(","):[],column:n[5]?+n[5]:void 0,func:n[1]||ie,line:n[4]?+n[4]:void 0,url:n[3]}}!o.func&&o.line&&(o.func=ie),l.push(o)}if(l.length)return{stack:l,message:le(e),name:e.name}}}function r(e,t,r,n){var o={url:t,line:r?+r:void 0};if(o.url&&o.line){e.incompvare=!1;var i=e.stack;if(i.length>0&&i[0].url===o.url){if(i[0].line===o.line)return!1;if(!i[0].line&&i[0].func===o.func)return i[0].line=o.line,i[0].context=o.context,!1}return i.unshift(o),e.partial=!0,!0}return e.incompvare=!0,!1}function n(e,t){for(var o,i,s=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,a=[],u={},c=!1,f=n.caller;f&&!c;f=f.caller)f!==ce&&f!==ue&&(i={args:[],column:void 0,func:ie,line:void 0,url:void 0},o=s.exec(f.toString()),f.name?i.func=f.name:o&&(i.func=o[1]),void 0===i.func&&(i.func=o?o.input.substring(0,o.input.indexOf("{")):void 0),u[f+""]?c=!0:u[f+""]=!0,a.push(i));t&&a.splice(0,t);var l={stack:a,message:e.message,name:e.name};return r(l,e.sourceURL||e.fileName,e.line||e.lineNumber,e.message||e.description),l}function o(r,o){var i,s=void 0===o?0:+o;try{if(i=function(e){var t=e.stacktrace;if(t){for(var r,n=/ line (\d+).*script (?:in )?(\S+)(?:: in function (\S+))?$/i,o=/ line (\d+), column (\d+)\s*(?:in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\))? in (.*):\s*$/i,i=t.split("\n"),s=[],a=0;a<i.length;a+=2){var u;n.exec(i[a])?u={args:[],column:void 0,func:(r=n.exec(i[a]))[3],line:+r[1],url:r[2]}:o.exec(i[a])&&(u={args:(r=o.exec(i[a]))[5]?r[5].split(","):[],column:+r[2],func:r[3]||r[4],line:+r[1],url:r[6]}),u&&(!u.func&&u.line&&(u.func=ie),u.context=[i[a+1]],s.push(u))}if(s.length)return{stack:s,message:le(e),name:e.name}}}(r))return i}catch(t){e}try{if(i=t(r))return i}catch(t){e}try{if(i=function(e){var t=e.message.split("\n");if(!(t.length<4)){var r,n=/^\s*Line (\d+) of linked script ((?:file|https?|blob)\S+)(?:: in function (\S+))?\s*$/i,o=/^\s*Line (\d+) of inline#(\d+) script in ((?:file|https?|blob)\S+)(?:: in function (\S+))?\s*$/i,i=/^\s*Line (\d+) of function script\s*$/i,s=[],a=window&&window.document&&window.document.getElementsByTagName("script"),u=[];for(var c in a)se(a,c)&&!a[c].src&&u.push(a[c]);for(var f=2;f<t.length;f+=2){var l;n.exec(t[f])?l={args:[],column:void 0,func:(r=n.exec(t[f]))[3],line:+r[1],url:r[2]}:o.exec(t[f])?l={args:[],column:void 0,func:(r=o.exec(t[f]))[4],line:+r[1],url:r[3]}:i.exec(t[f])&&(r=i.exec(t[f]),l={url:window.location.href.replace(/#.*$/,""),args:[],column:void 0,func:"",line:+r[1]}),l&&(l.func||(l.func=ie),l.context=[t[f+1]],s.push(l))}if(s.length)return{stack:s,message:t[0],name:e.name}}}(r))return i}catch(t){e}try{if(i=n(r,s+1))return i}catch(t){e}return{message:le(r),name:r.name,stack:[]}}return o.augmentStackTraceWithInitialElement=r,o.computeStackTraceFromStackProp=t,o.ofCaller=function(e){var t=1+(void 0===e?0:+e);try{throw new Error}catch(e){return ce(e,t+1)}},o}(),fe=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/;function le(e){const t=e&&e.message;return t?t.error&&"string"==typeof t.error.message?t.error.message:t:"No error message"}class pe{constructor(){this.observers=[]}subscribe(e){this.observers.push(e)}notify(e){this.observers.forEach((function(t){t(e)}))}}var de,he,me=[],ve=[];function ge(){return ae||(de=oe.request,oe.request=function(){var e=this,t={method:arguments[0].method||"GET",startTime:0,url:arguments[0].url,type:f,responseType:arguments[0].responseType||"text"};t.startTime=M();var r=arguments[0].success;arguments[0].success=function(){i(arguments[0]),r&&r.apply(e,arguments)};var n=arguments[0].fail;arguments[0].fail=function(){i(arguments[0]),n&&n.apply(e,arguments)};var o=!1,i=function(e){o||(o=!0,t.duration=M()-t.startTime,t.response=JSON.stringify(e.data),t.header=e.header||{},t.profile=e.profile,t.status=e.statusCode||e.status||0,ve.forEach((function(e){e(t)})))};return me.forEach((function(e){e(t)})),de.apply(this,arguments)},ae={beforeSend:function(e){me.push(e)},onRequestComplete:function(e){ve.push(e)}}),ae}var _e,ye,Ee,Te,be=[],Se=[];function Ce(){return he||(_e=oe.downloadFile,oe.downloadFile=function(){var e=this,t={method:"GET",startTime:0,url:arguments[0].url,type:l,responseType:"file"};t.startTime=M();var r=arguments[0].success;arguments[0].success=function(){i(arguments[0]),r&&r.apply(e,arguments)};var n=arguments[0].fail;arguments[0].fail=function(){i(arguments[0]),n&&n.apply(e,arguments)};var o=!1,i=function(e){o||(o=!0,t.duration=M()-t.startTime,t.response=JSON.stringify({filePath:e.filePath,tempFilePath:e.tempFilePath}),t.header=e.header||{},t.profile=e.profile,t.status=e.statusCode||e.status||0,Se.forEach((function(e){e(t)})))};return be.forEach((function(e){e(t)})),_e.apply(this,arguments)},he={beforeSend:function(e){be.push(e)},onRequestComplete:function(e){Se.push(e)}}),he}function Ae(e){return"string"==typeof e?e:e instanceof Error?re(ce(e)):JSON.stringify(e,void 0,2)}function Oe(e){Ee=function(t,r,n){var o=function(e,t,r){return e&&(void 0!==e.message||t instanceof Error)?{message:e.message||"Empty message",stack:re(e),type:e.name}:{message:r+""+JSON.stringify(t),stack:"No stack, consider using an instance of Error",type:e&&e.name}}(t,n,"Uncaught");e.notify({message:o.message,stack:o.stack,type:o.type,source:te,startTime:M()})},ue.subscribe(Ee)}function De(e){if(!Te){var t=new pe;!function(e,t){function r(r,n){K(n.url,e)||!function(e){return 0===e.status&&"opaque"!==e.responseType}(n)&&!function(e){return e.status>=500}(n)||t.notify({message:ke(r)+"error"+n.method+" "+n.url,resource:{method:n.method,statusCode:n.status,url:n.url},type:ee,source:ee,stack:Pe(n.response,e)||"Failed to load",startTime:n.startTime})}ge().onRequestComplete((function(e){return r(e.type,e)})),Ce().onRequestComplete((function(e){return r(e.type,e)}))}(e,t),function(e){ye=console.error,console.error=function(){ye.apply(console,arguments);var t=A(arguments),r=[];t.concat(["console error:"]).forEach((function(e){r.push(Ae(e))})),e.notify({message:r.join(" "),source:X,startTime:M()})}}(t),Oe(t),Te=function(e,t){var n=0,o=new pe;return t.subscribe((function(t){n<e.maxErrorsByMinute?(n+=1,o.notify(t)):n===e.maxErrorsByMinute&&(n+=1,o.notify({message:"Reached max number of errors by minute: "+e.maxErrorsByMinute,source:Z,startTime:M()}))})),setInterval((function(){n=0}),r),o}(e,t)}return Te}function Pe(e,t){return e&&e.length>t.requestErrorResponseLengthLimit?e.substring(0,t.requestErrorResponseLengthLimit)+"...":e}function ke(e){return f===e?"XHR":l}function we(e,t){return function(e,t,r){r.subscribe((function(t){e.notify(J.RAW_RUM_EVENT_COLLECTED,function(e){var t=e.resource;if(t){var r=F(e.resource.url).getParse();t={method:e.resource.method,status:e.resource.statusCode,statusGroup:I(e.resource.statusCode),url:e.resource.url,urlHost:r.Host,urlPath:r.Path,urlPathGroup:R(r.Path)}}return{rawRumEvent:{date:e.startTime,error:{message:e.message,resource:t,source:e.source,stack:e.stack,type:e.type,starttime:e.startTime},type:o},startTime:e.startTime}}(t))}))}(e,0,De(t))}const Re=new class{constructor(){this.sessionId=D(),this.getDeviceInfo(),this.getNetWork()}getDeviceInfo(){try{const o=oe.getSystemInfoSync();var e=o.system.split(" "),t=e.length>1&&e[1],r=t.split(".").length&&t.split(".")[0],n="";o.host&&(n=o.host.appId),this.deviceInfo={screenSize:`${o.screenWidth}*${o.screenHeight} `,platform:o.platform,platformVersion:o.version,osVersion:t,osVersionMajor:r,os:e.length>1&&e[0],brand:o.brand,model:o.model,frameworkVersion:o.SDKVersion,pixelRatio:o.pixelRatio,deviceUuid:n}}catch(e){}}getClientID(){var e=oe.getStorageSync(n);return e||(e=D(),oe.setStorageSync(n,e)),e}getNetWork(){oe.getNetworkType({success:e=>{this.deviceInfo.network=e.networkType?e.networkType:"unknown"}}),oe.onNetworkStatusChange((e=>{this.deviceInfo.network=e.networkType?e.networkType:"unknown"}))}getSessionId(){return this.sessionId}};function Ie(e){return 0!==(t=e.sampleRate)&&100*Math.random()<=t;var t}function Le(e){var t,r,n=[],o=[];e.subscribe(J.VIEW_CREATED,(function(e){t=e})),e.subscribe(J.VIEW_UPDATED,(function(e){t&&t.id===e.id&&(t=e)})),e.subscribe(J.VIEW_ENDED,(function(e){t&&(n.unshift({endTime:e.endClocks,context:a(),startTime:t.startTime}),t=void 0)})),e.subscribe(J.AUTO_ACTION_CREATED,(function(e){r=e})),e.subscribe(J.AUTO_ACTION_COMPLETED,(function(e){r&&o.unshift({context:s(),endTime:r.startClocks+e.duration,startTime:r.startClocks}),r=void 0})),e.subscribe(J.AUTO_ACTION_DISCARDED,(function(){r=void 0})),e.subscribe(J.SESSION_RENEWED,(function(){n=[],o=[],t=void 0,r=void 0}));var i=setInterval((function(){!function(e,t){var r=M()-t;for(;e.length>0&&e[e.length-1].startTime<r;)e.pop()}(n,144e5)}),6e4);function s(){return{userAction:{id:r.id}}}function a(){return{page:{id:t.id,referer:n.length&&n[n.length-1].context.page.route||void 0,route:t.route}}}function u(e,t,r,n){if(void 0===n)return r?e():void 0;if(r&&n>=r.startTime)return e();var o=void 0;return E(t,(function(e){return!(n>e.endTime)&&(n>=e.startTime?(o=e.context,!1):void 0)})),o}return{findView:function(e){return u(a,n,t,e)},findAction:function(e){return u(s,o,r,e)},stop:function(){clearInterval(i)}}}var Ne={sdk_name:"_dd.sdk_name",sdk_version:"_dd.sdk_version",app_id:"application.id",env:"_dd.env",version:"_dd.version",userid:"user.user_id",session_id:"session.id",is_signin:"user.is_signin",device:"device.brand",model:"device.model",device_uuid:"device.device_uuid",os:"device.os",os_version:"device.os_version",os_version_major:"device.os_version_major",screen_size:"device.screen_size",network_type:"device.network_type",platform:"device.platform",platform_version:"device.platform_version",app_framework_version:"device.framework_version",view_id:"page.id",view_name:"page.route",view_referer:"page.referer"},xe={view:{type:s,tags:{view_apdex_level:"page.apdex_level",is_active:"page.is_active"},fields:{page_fmp:"page.fmp",first_paint_time:"page.fpt",loading_time:"page.loading_time",onload_to_onshow:"page.onload2onshow",onshow_to_onready:"page.onshow2onready",time_spent:"page.time_spent",view_error_count:"page.error.count",view_resource_count:"page.error.count",view_long_task_count:"page.long_task.count",view_action_count:"page.action.count",view_setdata_count:"page.setdata.count"}},resource:{type:a,tags:{resource_type:"resource.type",resource_status:"resource.status",resource_status_group:"resource.status_group",resource_method:"resource.method",resource_url:"resource.url",resource_url_host:"resource.url_host",resource_url_path:"resource.url_path",resource_url_path_group:"resource.url_path_group",resource_url_query:"resource.url_query"},fields:{resource_size:"resource.size",resource_load:"resource.load",resource_dns:"resource.dns",resource_tcp:"resource.tcp",resource_ssl:"resource.ssl",resource_ttfb:"resource.ttfb",resource_trans:"resource.trans",resource_first_byte:"resource.firstbyte",duration:"resource.duration"}},error:{type:o,tags:{error_source:"error.source",error_type:"error.type",resource_url:"error.resource.url",resource_url_host:"error.resource.url_host",resource_url_path:"error.resource.url_path",resource_url_path_group:"error.resource.url_path_group",resource_status:"error.resource.status",resource_status_group:"error.resource.status_group",resource_method:"error.resource.method"},fields:{error_message:["string","error.message"],error_stack:["string","error.stack"]}},long_task:{type:i,tags:{},fields:{duration:"long_task.duration"}},action:{type:c,tags:{action_id:"action.id",action_name:"action.target.name",action_type:"action.type"},fields:{duration:"action.loading_time"}}},Ue=/[^\u0000-\u007F]/;var Me=function(e,t){this.endpointUrl=e,this.bytesLimit=t};Me.prototype={send:function(e){var t=function(e){return e?e+(-1===e.indexOf("?")?"?":"&")+"precision=ms":e}(this.endpointUrl);oe.request({method:"POST",header:{"content-type":"text/plain;charset=UTF-8"},url:t,data:e})}};var je=Me;function Be(e,t,r,n,o,i){this.request=e,this.maxSize=t,this.bytesLimit=r,this.maxMessageSize=n,this.flushTimeout=o,this.lifeCycle=i,this.flushOnVisibilityHidden(),this.flushPeriodically()}Be.prototype={pushOnlyBuffer:[],upsertBuffer:{},bufferBytesSize:0,bufferMessageCount:0,add:function(e){this.addOrUpdate(e)},upsert:function(e,t){this.addOrUpdate(e,t)},flush:function(){if(0!==this.bufferMessageCount){var e=this.pushOnlyBuffer.concat(T(this.upsertBuffer));this.request.send(e.join("\n"),this.bufferBytesSize),this.pushOnlyBuffer=[],this.upsertBuffer={},this.bufferBytesSize=0,this.bufferMessageCount=0}},processSendData:function(e){if(!e||!e.type)return"";var t="",r=!1;return E(xe,(function(n,o){if(n.type===e.type){t+=o+",";var i=[],s=N({},Ne,n.tags);E(s,(function(t,r){var n=V(e,t);(n||C(n))&&i.push(W(r)+"="+W(n))})),e.tags.length&&E(e.tags,(function(e,t){(e||C(e))&&i.push(W(t)+"="+W(e))}));var a=[];E(n.fields,(function(t,r){if(Array.isArray(t)&&2===t.length){var n=t[0],o=t[1];((i=V(e,o))||C(i))&&(i="string"===n?'"'+String(i).replace(/[\\]*"/g,'"').replace(/"/g,'\\"')+'"':W(i),a.push(W(r)+"="+i))}else if(S(t)){var i;((i=V(e,t))||C(i))&&(i=W(i),a.push(W(r)+"="+i))}})),i.length&&(t+=i.join(",")),a.length&&(t+=" ",t+=a.join(","),r=!0),t=t+" "+e.date}})),r?t:""},sizeInBytes:function(e){if(!Ue.test(e))return e.length;for(var t,r=0,n=0,o=e.length;n<o;n++)r+=(t=e.charCodeAt(n))<=127?1:t<=2047?2:t<=65535?3:4;return r},addOrUpdate:function(e,t){var r=this.process(e);r.processedMessage&&""!==r.processedMessage&&(r.messageBytesSize>=this.maxMessageSize||(this.hasMessageFor(t)&&this.remove(t),this.willReachedBytesLimitWith(r.messageBytesSize)&&this.flush(),this.push(r.processedMessage,r.messageBytesSize,t),this.isFull()&&this.flush()))},process:function(e){var t=this.processSendData(e);return{processedMessage:t,messageBytesSize:this.sizeInBytes(t)}},push:function(e,t,r){this.bufferMessageCount>0&&(this.bufferBytesSize+=1),void 0!==r?this.upsertBuffer[r]=e:this.pushOnlyBuffer.push(e),this.bufferBytesSize+=t,this.bufferMessageCount+=1},remove:function(e){var t=this.upsertBuffer[e];delete this.upsertBuffer[e];var r=this.sizeInBytes(t);this.bufferBytesSize-=r,this.bufferMessageCount-=1,this.bufferMessageCount>0&&(this.bufferBytesSize-=1)},hasMessageFor:function(e){return void 0!==e&&void 0!==this.upsertBuffer[e]},willReachedBytesLimitWith:function(e){return this.bufferBytesSize+e+1>=this.bytesLimit},isFull:function(){return this.bufferMessageCount===this.maxSize||this.bufferBytesSize>=this.bytesLimit},flushPeriodically:function(){var e=this;setTimeout((function(){e.flush(),e.flushPeriodically()}),e.flushTimeout)},flushOnVisibilityHidden:function(){var e=this;this.lifeCycle.subscribe(J.APP_HIDE,(function(){e.flush()}))}};var Ve=Be;function qe(e,t){var r=function(e,t){var r=n(e.datakitUrl,t);function n(t,r){return new Ve(new je(t,e.batchBytesLimit),e.maxBatchSize,e.batchBytesLimit,e.maxMessageSize,e.flushTimeout,r)}var o=!1;return{add:function(e){o||r.add(e)},stop:function(){o=!0},upsert:function(e,t){o||r.upsert(e,t)}}}(e,t);return t.subscribe(J.RUM_EVENT_COLLECTED,(function(e){e.type===s?r.upsert(e,e.page.id):r.add(e)})),{stop:function(){r.stop()}}}function ze(e,t){void 0===t&&(t=B);var r={errorCount:0,resourceCount:0,longTaskCount:0,userActionCount:0},n=e.subscribe(J.RAW_RUM_EVENT_COLLECTED,(function(e){switch(e.rawRumEvent.type){case o:r.errorCount+=1,t(r);break;case a:r.resourceCount+=1,t(r);break;case c:r.userActionCount+=1,t(r)}}));return{stop:function(){n.unsubscribe()},eventCounts:r}}function We(e,t){return e.subscribe(J.VIEW_UPDATED,(function(t){e.notify(J.RAW_RUM_EVENT_COLLECTED,function(e){var t;e.fmp&&(t=(t=parseInt(Number(e.fmp)/1e3))>9?9:t);return{rawRumEvent:{_dd:{documentVersion:e.documentVersion},date:e.startTime,type:s,page:{action:{count:e.eventCounts.userActionCount},error:{count:e.eventCounts.errorCount},setdata:{count:e.setdataCount},setdata_duration:b(e.setdataDuration),loadingTime:b(e.loadingTime),stayTime:b(e.stayTime),onload2onshow:b(e.onload2onshowTime),onshow2onready:b(e.onshow2onready),fpt:b(e.fpt),fmp:b(e.fmp),isActive:e.isActive,apdexLevel:t,resource:{count:e.eventCounts.resourceCount},timeSpent:b(e.duration)}},startTime:e.startTime}}(t))})),function(e,t){const r=Page;Page=function(e){return M(),r(e)}}()}function Fe(){for(var e=A(arguments),t=1;t<e.length;t+=1)if(e[t-1]>e[t])return!1;return!0}function He(e){if(e.startTime<e.responseEnd)return b(e.responseEnd-e.startTime)}function Ge(e){var t=function(e){if(!Fe(e.startTime,e.fetchStart,e.domainLookupStart,e.domainLookupEnd,e.connectStart,e.connectEnd,e.requestStart,e.responseStart,e.responseEnd))return;if(!Qe(e))return e;var t=e.redirectStart,r=e.redirectEnd;t<e.startTime&&(t=e.startTime);r<e.startTime&&(r=e.fetchStart);if(!Fe(e.startTime,t,r,e.fetchStart))return;return N({},e,{redirectEnd:r,redirectStart:t})}(e);if(t){var r=t.startTime,n=t.fetchStart,o=t.redirectStart,i=t.redirectEnd,s=t.domainLookupStart||t.domainLookUpStart,a=t.domainLookupEnd||t.domainLookUpEnd,u=t.connectStart,c=t.SSLconnectionStart,f=t.SSLconnectionEnd,l=t.connectEnd,p=t.requestStart,d=t.responseStart,h=t.responseEnd,m={firstbyte:$e(r,s,d),trans:$e(r,d,h),ttfb:$e(r,p,d)};return l!==n&&(m.tcp=$e(r,u,l),Fe(u,c,f)&&(m.ssl=$e(r,c,f))),a!==n&&(m.dns=$e(r,s,a)),Qe(e)&&(m.redirect=$e(r,o,i)),m}}function Qe(e){return e.fetchStart!==e.startTime}function $e(e,t,r){return b(r-t)}function Je(e){if(e.startTime<e.responseStart)return e.receivedBytedCount}function Ye(e,t){return t&&!K(t,e)}var Ke=1;function Ze(e,t){!function(e,t){var r=ge();r.beforeSend((function(r){Ye(t,r.url)&&(r.requestIndex=Xe(),e.notify(J.REQUEST_STARTED,{requestIndex:r.requestIndex}))})),r.onRequestComplete((function(r){Ye(t,r.url)&&e.notify(J.REQUEST_COMPLETED,{duration:r.duration,method:r.method,requestIndex:r.requestIndex,performance:r.profile,response:r.response,startTime:r.startTime,status:r.status,type:r.type,url:r.url})}))}(e,t),function(e,t){var r=Ce();r.beforeSend((function(r){Ye(t,r.url)&&(r.requestIndex=Xe(),e.notify(J.REQUEST_STARTED,{requestIndex:r.requestIndex}))})),r.onRequestComplete((function(r){Ye(t,r.url)&&e.notify(J.REQUEST_COMPLETED,{duration:r.duration,method:r.method,requestIndex:r.requestIndex,performance:r.profile,response:r.response,startTime:r.startTime,status:r.status,type:r.type,url:r.url})}))}(e,t)}function Xe(){var e=Ke;return Ke+=1,e}function et(e,t){e.subscribe(J.REQUEST_COMPLETED,(function(t){e.notify(J.RAW_RUM_EVENT_COLLECTED,function(e){var t=e.type,r=e.performance,n=r?function(e){return{resource:x({},{load:He(e),size:Je(e)},Ge(e))}}(r):void 0,o=F(e.url).getParse(),i=e.startTime,s=x({date:i,resource:{type:t,duration:b(e.duration),method:e.method,status:e.status,statusGroup:I(e.status),url:e.url,urlHost:o.Host,urlPath:o.Path,urlPathGroup:R(o.Path),urlQuery:P(L(e.url))},type:a},n);return{startTime:i,rawRumEvent:s}}(t))}))}const tt="cold",rt="hot";function nt(e,t){const r=App;var n,o={isStartUp:!1};App=function(e){return n=M(),["onLaunch","onShow","onHide"].forEach((r=>{const n=e[r];e[r]=function(e){return"onLaunch"===r?(o.isStartUp=!0,o.isHide=!1,o.startupType=tt):"onShow"===r?o.isStartUp&&o.isHide&&(o.startupType=rt,i()):"onHide"===r&&(t.notify(J.APP_HIDE),o.isHide=!0),n&&n.call(this,e)}})),r(e)},function(e,t){e.subscribe(J.PERFORMANCE_ENTRY_COLLECTED,(function(e){var r,n,o;const i=e.find((e=>"navigation"===e.entryType&&"appLaunch"===e.navigationType));void 0!==i&&(r=i.duration);const s=e.find((e=>"script"===e.entryType&&"evaluateScript"===e.name));void 0!==s&&(n=s.duration);const a=e.find((e=>"render"===e.entryType&&"firstRender"===e.name));if(a&&s&&i){if(!O(a.duration,i.duration)||!O(s.duration,i.duration))return;o=i.duration-a.duration-s.duration}t({startupDuration:r,scriptLoadDuration:n,codeDownloadDuration:o})})).unsubscribe}(t,(function(e){o={...o,...e},i()}));j(i,3e3,{leading:!1});function i(){t.notify(J.APP_UPDATE,{startupDuration:o.startupDuration,scriptLoadDuration:o.scriptLoadDuration,codeDownloadDuration:o.codeDownloadDuration,startupType:o.startupType,startTime:n,duration:M()-n})}}function ot(e,t){return e.subscribe(J.APP_UPDATE,(function(t){e.notify(J.RAW_RUM_EVENT_COLLECTED,function(e){return{rawRumEvent:{date:e.startTime,type:u,app:{startupDuration:b(e.startupDuration),scriptLoadDuration:b(e.scriptLoadDuration),codeDownloadDuration:b(e.codeDownloadDuration),startupType:e.startupType,timeSpent:b(e.duration)}},startTime:e.startTime}}(t))})),nt(0,e)}function it(e,t){var r=function(e){var t,r=new pe,n=[],o=0;function i(){r.notify({isBusy:o>0})}return n.push(e.subscribe(J.PAGE_SET_DATA_UPDATE,(function(){i()})),e.subscribe(J.PAGE_ALIAS_ACTION,(function(){i()}))),n.push(e.subscribe(J.REQUEST_STARTED,(function(e){void 0===t&&(t=e.requestIndex),o+=1,i()}))),n.push(e.subscribe(J.REQUEST_COMPLETED,(function(e){void 0===t||e.requestIndex<t||(o-=1,i())}))),{observable:r,stop:function(){E(n,(function(e){e.unsubscribe()}))}}}(e),n=r.observable,o=r.stop,i=function(e,t,r){var n,o=!1,i=setTimeout((function(){u({hadActivity:!1})}),100),s=setTimeout((function(){u({hadActivity:!0,endTime:M()})}),1e4);function a(){o=!0,clearTimeout(i),clearTimeout(n),clearTimeout(s),t()}function u(e){o||(a(),r(e))}return e.subscribe((function(e){var t=e.isBusy;clearTimeout(i),clearTimeout(n);var r=M();t||(n=setTimeout((function(){u({hadActivity:!0,endTime:r})}),100))})),{stop:a}}(n,o,t).stop;return{stop:function(){i(),o()}}}function st(e){var t=function(e){var t,r;return{create:function(n,o){if(!t){var i=new ut(e,n,o);t=i,r=it(e,(function(e){e.hadActivity?i.complete(e.endTime):i.discard(),t=void 0}))}},discardCurrent:function(){t&&(r.stop(),t.discard(),t=void 0)}}}(e);e.subscribe(J.VIEW_CREATED,(function(){t.discardCurrent()}));var r=Page;Page=function(n){return w(n).forEach((r=>{at(n,r,(function(e){t.create(e.type,e.name)}),e)})),r(n)};var n=Component;return Component=function(e){return w(e).forEach((r=>{at(e,r,(function(e){t.create(e.type,e.name)}))})),n(e)},{stop:function(){t.discardCurrent()}}}function at(e,t,r,n){var o=e[t];e[t]=function(){const e=o.apply(this,arguments);var i={};if(U(arguments[0])){var s=arguments[0].currentTarget||{},a=s.dataset||{},u=arguments[0].type;if(u&&p[u])i.type=u,i.name=a.name||a.content||a.type,r(i);else if("onAddToFavorites"===t)i.type="click",i.name="收藏 标题: "+e.title+(e.query?" query: "+e.query:""),r(i),n.notify(J.PAGE_ALIAS_ACTION,!0);else if("onShareAppMessage"===t)i.type="click",i.name="转发 标题: "+e.title+(e.path?" path: "+e.path:""),r(i),n.notify(J.PAGE_ALIAS_ACTION,!0);else if("onShareTimeline"===t)i.type="click",i.name="分享到朋友圈 标题: "+e.title+(e.query?" query: "+e.query:""),r(i),n.notify(J.PAGE_ALIAS_ACTION,!0);else if("onTabItemTap"===t){var c=arguments.length&&arguments[0];i.type="click",i.name="tab 名称: "+c.text+(c.pagePath?" 跳转到: "+c.pagePath:""),r(i),n.notify(J.PAGE_ALIAS_ACTION,!0)}}return e}}var ut=function(e,t,r){this.id=D(),this.startClocks=M(),this.name=r,this.type=t,this.lifeCycle=e,this.eventCountsSubscription=ze(e),this.lifeCycle.notify(J.AUTO_ACTION_CREATED,{id:this.id,startClocks:this.startClocks})};function ct(e,t){e.subscribe(J.AUTO_ACTION_COMPLETED,(function(t){e.notify(J.RAW_RUM_EVENT_COLLECTED,function(e){var t={action:{error:{count:e.counts.errorCount},id:e.id,loadingTime:b(e.duration),long_task:{count:e.counts.longTaskCount},resource:{count:e.counts.resourceCount}}};return{rawRumEvent:x({action:{target:{name:e.name},type:e.type},date:e.startClocks,type:c},t),startTime:e.startClocks}}(t))})),t.trackInteractions&&st(e)}ut.prototype={complete:function(e){var t,r,n=this.eventCountsSubscription.eventCounts;this.lifeCycle.notify(J.AUTO_ACTION_COMPLETED,{counts:{errorCount:n.errorCount,longTaskCount:n.longTaskCount,resourceCount:n.resourceCount},duration:(t=this.startClocks,r=e,r-t),id:this.id,name:this.name,startClocks:this.startClocks,type:this.type}),this.eventCountsSubscription.stop()},discard:function(){this.lifeCycle.notify(J.AUTO_ACTION_DISCARDED),this.eventCountsSubscription.stop()}};const ft=(lt=function(e){const t=function(e,t){var r,n={applicationId:e.applicationId,env:e.env||"",version:e.version||"",sdkVersion:t.sdkVersion,sdkName:t.sdkName,datakitUrl:(r=e.datakitUrl||e.datakitOrigin,r&&r.lastIndexOf("/")===r.length-1?r+"v1/write/rum":r+"/v1/write/rum"),tags:e.tags||[]};return"trackInteractions"in e&&(n.trackInteractions=!!e.trackInteractions),x(Y,n)}(e,Q),r=new $;var n=Le(r);qe(t,r),function(e,t,r,n){r.subscribe(J.RAW_RUM_EVENT_COLLECTED,(function(o){var i=o.startTime,s=o.rawRumEvent,a=n.findView(i);s.type;var u={device:Re.deviceInfo};if(Ie(t)&&(a||"app"===s.type)){var c=n.findAction(i),f={_dd:{sdkName:t.sdkName,sdkVersion:t.sdkVersion,env:t.env,version:t.version},tags:t.tags,application:{id:e},device:{},date:(new Date).getTime(),session:{id:Re.getSessionId()},user:{user_id:t.user_id||Re.getClientID(),is_signin:t.user_id?"T":"F"}},l=q(x(f,u,a,c,s));r.notify(J.RUM_EVENT_COLLECTED,l)}}))}(e.applicationId,t,r,n),ot(r),et(r),We(r),we(r,t),Ze(r,t),function(e,t){oe.getPerformance&&oe.getPerformance().createObserver((t=>{e.notify(J.PERFORMANCE_ENTRY_COLLECTED,t.getEntries())})).observe({entryTypes:["render","script","navigation"]})}(r),function(e){const t=Page,r=Component;Page=function(r){const n=r.onLoad;return r.onLoad=function(){return this.setUpdatePerformanceListener&&this.setUpdatePerformanceListener({withDataPaths:!0},(t=>{e.notify(J.PAGE_SET_DATA_UPDATE,t)})),n.apply(this,arguments)},t(r)},Component=function(t){const n=t.attached;return t.attached=function(){return this.setUpdatePerformanceListener&&this.setUpdatePerformanceListener({withDataPaths:!0},(t=>{e.notify(J.PAGE_SET_DATA_UPDATE,t)})),n.apply(this,arguments)},r(t)}}(r),ct(r,t)},pt=!1,{init:function(e){void 0===e&&(e={}),function(e){return!pt&&(!!e.applicationId&&(!!e.datakitOrigin&&!!(void 0===e.sampleRate||(t=e.sampleRate,C(t)&&t>=0&&t<=100))));var t}(e)&&(lt(e),pt=!0)}});var lt,pt;module.exports=t})();
//# sourceMappingURL=dataflux-rum-miniapp.js.map